"use strict";(self.webpackChunkMIE_TEMPLATE_NEW=self.webpackChunkMIE_TEMPLATE_NEW||[]).push([[91],{3091:(Zt,B,m)=>{m.r(B),m.d(B,{PostEventSettlementModuleModule:()=>Ct});var h=m(6895),v=m(9299),g=m(9059),e=m(4650),r=m(4006),p=m(9549),A=m(4385),E=m(3238),s=m(6492),S=m(3607),C=m(1569),y=m(4859),f=m(5140);function N(a,l){if(1&a&&(e.TgZ(0,"tbody")(1,"tr")(2,"th",12),e._uU(3),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.qZA(),e.TgZ(10,"td"),e._uU(11),e.qZA()()()),2&a){const t=l.$implicit,n=l.index;e.xp6(3),e.Oqu(n+1),e.xp6(2),e.Oqu(t["EventId/EventRequestId"]),e.xp6(2),e.Oqu(t["Event Topic"]),e.xp6(2),e.Oqu(t.EventType),e.xp6(2),e.Oqu(t.EventDate)}}function L(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",15)(1,"mat-label"),e._uU(2,"Upload Photos"),e.TgZ(3,"span",16),e._uU(4,"*"),e.qZA()(),e._UZ(5,"br"),e.TgZ(6,"input",20),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw(2);return e.KtG(o.onFileSelected(i,"other","uploadPhotos"))}),e.qZA(),e._UZ(7,"br"),e.TgZ(8,"span",18)(9,"small"),e._uU(10,"Allowed File Types (.png, .jpg)"),e.qZA()(),e._UZ(11,"br"),e.TgZ(12,"span",18)(13,"small"),e._uU(14,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()(),e._UZ(15,"br"),e.qZA()}}function k(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",15)(1,"mat-label"),e._uU(2,"Upload Attendence"),e.TgZ(3,"span",16),e._uU(4,"*"),e.qZA()(),e._UZ(5,"br"),e.TgZ(6,"input",21),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw(2);return e.KtG(o.onFileSelected(i,"other","uploadAttendence"))}),e.qZA(),e._UZ(7,"br"),e.TgZ(8,"span",18)(9,"small"),e._uU(10,"Allowed File Types (.png, .jpg)"),e.qZA()(),e._UZ(11,"br"),e.TgZ(12,"span",18)(13,"small"),e._uU(14,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()(),e._UZ(15,"br"),e.qZA()}}function H(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",13)(1,"form",14)(2,"div",15)(3,"mat-label")(4,"b"),e._uU(5,"Upload Deviation"),e.TgZ(6,"span",16),e._uU(7,"*"),e.qZA()()(),e._UZ(8,"br"),e.TgZ(9,"input",17),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw();return e.KtG(o.onFileSelected(i,"deviation","thirtyDaysUpload"))}),e.qZA(),e._UZ(10,"br"),e.TgZ(11,"span",18)(12,"small"),e._uU(13,"Allowed File Types (.png, .jpg, .txt , .doc)"),e.qZA()(),e._UZ(14,"br"),e.TgZ(15,"span",18)(16,"small"),e._uU(17,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()()(),e.YNc(18,L,16,0,"div",19),e.YNc(19,k,16,0,"div",19),e.qZA()()}if(2&a){const t=e.oxw();e.xp6(1),e.Q6J("formGroup",t.deviationForm),e.xp6(8),e.Q6J("accept",t.allowedTypesForHTML),e.xp6(9),e.Q6J("ngIf",t.showPostEventContent),e.xp6(1),e.Q6J("ngIf",t.showPostEventContent)}}function K(a,l){if(1&a&&(e.TgZ(0,"mat-option",25),e._uU(1),e.qZA()),2&a){const t=l.$implicit;e.s9C("value",t["EventId/EventRequestId"]),e.xp6(1),e.Oqu(t["EventId/EventRequestId"])}}const q=function(){return{standalone:!0}};function Y(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"mat-form-field",22)(1,"mat-label"),e._uU(2,"Select Event ID"),e.qZA(),e.TgZ(3,"mat-select",23),e.NdJ("ngModelChange",function(i){e.CHM(t);const o=e.oxw();return e.KtG(o.onEventSelect(i))})("ngModelChange",function(i){e.CHM(t);const o=e.oxw();return e.KtG(o.selectedEvent=i)}),e.YNc(4,K,2,2,"mat-option",24),e.qZA()()}if(2&a){const t=e.oxw();e.xp6(3),e.Q6J("ngModelOptions",e.DdM(3,q))("ngModel",t.selectedEvent),e.xp6(1),e.Q6J("ngForOf",t.after30DaysList)}}function J(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"tr")(1,"th",12),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td")(12,"div")(13,"input",32),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw(2);return e.KtG(o.onFileSelected(i,"other","InvoiceUpload"))}),e.qZA(),e._UZ(14,"br"),e.TgZ(15,"span",18)(16,"small"),e._uU(17,"Allowed File Types (.png, .jpg, .txt , .doc)"),e.qZA()(),e._UZ(18,"br"),e.TgZ(19,"span",18)(20,"small"),e._uU(21,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()()()()()}if(2&a){const t=l.$implicit,n=l.index,i=e.oxw(2);e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(t.Expense),e.xp6(2),e.Oqu(t.Amount),e.xp6(2),e.Oqu(t.BtcorBte),e.xp6(2),e.hij(" ","Yes"==t["AmountExcludingTax?"]?"No":"Yes"," "),e.xp6(3),e.s9C("id",n+1),e.Q6J("accept",i.allowedTypesForHTML)}}function G(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"tr")(1,"th",12),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td")(8,"input",36),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw(3);return e.KtG(o.onFileSelected(i,"other","btcInvoice"))})("ngModelChange",function(i){const d=e.CHM(t).$implicit;return e.KtG(d.invoiceFile=i)}),e.qZA(),e._UZ(9,"br"),e.TgZ(10,"span",18)(11,"small"),e._uU(12,"Allowed File Types (.png, .jpg, .txt , .doc)"),e.qZA()(),e._UZ(13,"br"),e.TgZ(14,"span",18)(15,"small"),e._uU(16,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()()()()}if(2&a){const t=l.$implicit,n=l.index,i=e.oxw(3);e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(t.expense),e.xp6(2),e.Oqu(t.amount),e.xp6(2),e.Q6J("accept",i.allowedTypesForHTML)("ngModelOptions",e.DdM(6,q))("ngModel",t.invoiceFile)}}function Q(a,l){if(1&a&&(e.TgZ(0,"div",4)(1,"div",33)(2,"h4")(3,"b"),e._uU(4,"Expense Summary"),e.qZA()()(),e.TgZ(5,"h5"),e._uU(6,"Expense Summary BTC"),e.qZA(),e.TgZ(7,"table",34)(8,"thead")(9,"tr")(10,"th")(11,"b")(12,"small"),e._uU(13,"S.no"),e.qZA()()(),e.TgZ(14,"th")(15,"b")(16,"small"),e._uU(17,"Expense Type"),e.qZA()()(),e.TgZ(18,"th")(19,"b")(20,"small"),e._uU(21,"BTC Amount"),e.qZA()()(),e.TgZ(22,"th")(23,"b")(24,"small"),e._uU(25,"Upload Invoice"),e.qZA()()()()(),e.TgZ(26,"tbody"),e.YNc(27,G,17,7,"tr",6),e.qZA(),e.TgZ(28,"tfoot")(29,"tr")(30,"td",35)(31,"b")(32,"small"),e._uU(33,"Total BTC Amount"),e.qZA()()(),e.TgZ(34,"td"),e._uU(35),e.qZA()()()()()),2&a){const t=e.oxw(2);e.xp6(27),e.Q6J("ngForOf",t.BTCSummary),e.xp6(8),e.Oqu(t.BTCSummaryTotal)}}function z(a,l){if(1&a&&(e.TgZ(0,"tr")(1,"th",12),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA()()),2&a){const t=l.$implicit,n=l.index;e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(t.expense),e.xp6(2),e.Oqu(t.amount)}}function $(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",4)(1,"h5"),e._uU(2,"Expense Summary BTE"),e.qZA(),e.TgZ(3,"table",34)(4,"thead")(5,"tr")(6,"th")(7,"b")(8,"small"),e._uU(9,"S.no"),e.qZA()()(),e.TgZ(10,"th")(11,"b")(12,"small"),e._uU(13,"Expense Type"),e.qZA()()(),e.TgZ(14,"th")(15,"b")(16,"small"),e._uU(17,"BTE Amount"),e.qZA()()()()(),e.TgZ(18,"tbody"),e.YNc(19,z,7,3,"tr",6),e._UZ(20,"tr"),e.qZA(),e.TgZ(21,"tfoot")(22,"tr")(23,"td",35)(24,"b")(25,"small"),e._uU(26,"Total BTE Amount"),e.qZA()()(),e.TgZ(27,"td"),e._uU(28),e.qZA()()()(),e.TgZ(29,"div")(30,"mat-label"),e._uU(31,"Invoice Upload"),e.TgZ(32,"span",16),e._uU(33,"*"),e.qZA()(),e._UZ(34,"br"),e.TgZ(35,"input",37),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw(2);return e.KtG(o.onFileSelected(i,"other","bteInvoice"))}),e.qZA(),e._UZ(36,"br"),e.TgZ(37,"span",18)(38,"small"),e._uU(39,"Allowed File Types (.png, .jpg, .txt , .doc)"),e.qZA()(),e._UZ(40,"br"),e.TgZ(41,"span",18)(42,"small"),e._uU(43,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()()()()}if(2&a){const t=e.oxw(2);e.xp6(19),e.Q6J("ngForOf",t.BTESummary),e.xp6(9),e.Oqu(t.BTESummaryTotal),e.xp6(7),e.Q6J("accept",t.allowedTypesForHTML)}}function V(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",26)(1,"div",4)(2,"div",27)(3,"h4")(4,"b"),e._uU(5,"Expense Details"),e.qZA()()(),e.TgZ(6,"table",5)(7,"thead")(8,"tr")(9,"th")(10,"b")(11,"small"),e._uU(12,"S.no"),e.qZA()()(),e.TgZ(13,"th")(14,"b")(15,"small"),e._uU(16,"Expense"),e.qZA()()(),e.TgZ(17,"th")(18,"b")(19,"small"),e._uU(20,"Expense Amount"),e.qZA()()(),e.TgZ(21,"th")(22,"b")(23,"small"),e._uU(24,"Actual Amount"),e.qZA()()(),e.TgZ(25,"th")(26,"b")(27,"small"),e._uU(28,"BTE/BTC"),e.qZA()()(),e.TgZ(29,"th")(30,"b")(31,"small"),e._uU(32,"Including GST"),e.qZA()()()()(),e.TgZ(33,"tbody"),e.YNc(34,J,22,7,"tr",6),e.qZA()(),e.YNc(35,Q,36,2,"div",28),e.YNc(36,$,44,3,"div",28),e.TgZ(37,"div",4)(38,"div",27)(39,"h4")(40,"b"),e._uU(41,"Total Expense Details"),e.qZA()()(),e.TgZ(42,"table",5)(43,"thead")(44,"tr")(45,"th")(46,"small"),e._uU(47,"Event ID"),e.qZA()(),e.TgZ(48,"th")(49,"small"),e._uU(50,"Total Budget amount For the Event"),e.qZA()(),e.TgZ(51,"th")(52,"small"),e._uU(53,"Actual Budget amount For the Event"),e.qZA()()()(),e.TgZ(54,"tbody")(55,"tr")(56,"th"),e._uU(57),e.qZA(),e.TgZ(58,"td"),e._uU(59),e.qZA(),e.TgZ(60,"td"),e._uU(61),e.qZA()()()()(),e.TgZ(62,"div",4)(63,"div",27)(64,"h4")(65,"b"),e._uU(66,"Advance Details"),e.qZA()()(),e.TgZ(67,"table",5)(68,"thead")(69,"tr")(70,"th")(71,"small"),e._uU(72,"Event ID"),e.qZA()(),e.TgZ(73,"th")(74,"small"),e._uU(75,"Advance Provided"),e.qZA()(),e.TgZ(76,"th")(77,"small"),e._uU(78,"Advance utilized for event"),e.qZA()(),e.TgZ(79,"th")(80,"small"),e._uU(81,"Pay back amount to Company"),e.qZA()(),e.TgZ(82,"th")(83,"small"),e._uU(84,"Additional Amount needed to pay for Initiator"),e.qZA()()()(),e.TgZ(85,"tbody")(86,"tr")(87,"th"),e._uU(88),e.qZA(),e.TgZ(89,"td"),e._uU(90),e.qZA(),e.TgZ(91,"td"),e._uU(92),e.qZA(),e.TgZ(93,"td"),e._uU(94),e.qZA(),e.TgZ(95,"td"),e._uU(96),e.qZA()()()()(),e.TgZ(97,"div",29)(98,"button",30),e._uU(99,"Reset"),e.qZA(),e._uU(100," \xa0\xa0\xa0\xa0 "),e.TgZ(101,"button",31),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.postEventSubmit())}),e._uU(102," Submit "),e.qZA()()()()}if(2&a){const t=e.oxw();e.xp6(34),e.Q6J("ngForOf",t.expenseTabelDetails),e.xp6(1),e.Q6J("ngIf",t.BTCSummary.length>0),e.xp6(1),e.Q6J("ngIf",t.BTESummary.length>0),e.xp6(21),e.Oqu(t.selectedEvent),e.xp6(2),e.Oqu(t.amountTableFinalAmount),e.xp6(2),e.Oqu(t.amountTableFinalAmount),e.xp6(27),e.Oqu(t.selectedEvent),e.xp6(2),e.Oqu(t.amountTableFinalAmount),e.xp6(2),e.Oqu(t.advancedUtilized),e.xp6(2),e.Oqu(t.amountToPayForCompany),e.xp6(2),e.Oqu(t.amountToPayForInitiator)}}let j=(()=>{class a{constructor(t,n,i,o,d){this.utilityService=t,this.activatedRoute=n,this._snackBarService=i,this._router=o,this._authService=d,this.after30DaysList=[],this.show30DaysUpload=!1,this.loadingIndicator=!1,this.showEventSelect=!1,this.expenseTabelDetails=[],this.showPostEventContent=!1,this.amountTableFinalAmount=0,this.advancedUtilized=0,this.amountToPayForInitiator=0,this.amountToPayForCompany=0,this.deviationFiles=[],this.otherFiles=[],this.expenseTableActualAmountInput=[],this._btcInvoiceFiles=[],this.BTESummary=[],this.BTCSummary=[],this.BTESummaryTotal=0,this.BTCSummaryTotal=0}ngOnInit(){this._authService.getUserDetails$.subscribe(t=>this._userDetails=t),this.showEventSelect=!0,this.deviationForm=new r.cw({thirtyDaysUpload:new r.NI(""),uploadPhotos:new r.NI(""),uploadAttendence:new r.NI("")}),this.geteventtype(),this.getExpense(),this._allowedTypes=s.D.FILE.ALLOWED,this._allowedTypes.forEach(t=>{this.allowedTypesForHTML+="."+t+", "})}geteventtype(){this.loadingIndicator=!0,this.utilityService.getEventListFromProcess().subscribe(t=>{this.loadingIndicator=!1,this.allEventList=t,this.after30Days(this.allEventList)})}getExpense(){this.utilityService.getPostEventExpense().subscribe(t=>{this.expense=t})}getTotalExpenseFinalAmount(t){this.utilityService.getTotalExpenseFinalAmount(t).subscribe(n=>{Boolean(n)&&(this.expenseFinalAmount=n,this.amountTableFinalAmount+=n,this.advancedUtilized+=n)},n=>{this.expenseFinalAmount=0,this.amountTableFinalAmount+=0,this.advancedUtilized+=0})}after30Days(t){Boolean(t)&&t.forEach(n=>{if("Stall Fabrication"==n.EventType&&n["Initiator Email"]==this._userDetails.email&&("Approved"==n["Event Request Status"]||"Advance Approved"==n["Event Request Status"])&&Boolean(n.EventDate)){let i=new Date,d=new Date(n.EventDate).getTime()-i.getTime();Math.round(d/864e5),this.after30DaysList.push(n)}}),this.show30DaysUpload=this.after30Days.length>0}onEventSelect(t){this.getTotalExpenseFinalAmount(t),this.showPostEventContent=!0,this.expenseTabelDetails=[],this.selectedEventDetails=this.allEventList.find(n=>n["EventId/EventRequestId"]==t),this.expense.forEach(n=>{if(n["EventId/EventRequestID"]==t){const i={Amount:n.Amount.toString(),Expense:n.Expense,AmountExcludingTax:n["AmountExcludingTax?"]||" ",BtcorBte:n["BTC/BTE"],EventId:" ",BtcAmount:" ",BteAmount:" ",BudgetAmount:" "};this.expenseTabelDetails.push(i)}}),this._filterBTEBTE(this.expenseTabelDetails)}onExpenseActualAmountChanges(t,n){Boolean(t)&&(this.advancedUtilized=this.amountTableFinalAmount,this.advancedUtilized-=this.expenseTabelDetails[n].Amount,this.advancedUtilized+=t,this.calculateAdvanceTableDetails())}calculateAdvanceTableDetails(){this.amountTableFinalAmount<this.advancedUtilized&&(this.amountToPayForCompany=0,this.amountToPayForInitiator=this.advancedUtilized-this.amountTableFinalAmount),this.amountTableFinalAmount>this.advancedUtilized&&(this.amountToPayForInitiator=0,this.amountToPayForCompany=this.amountTableFinalAmount-this.advancedUtilized),this.amountTableFinalAmount==this.advancedUtilized&&(this.amountToPayForCompany=0,this.amountToPayForInitiator=0)}onFileSelected(t,n,i){const o=t.target.files[0];if(t.target.files.length>0)if(o.size>=s.D.FILE.MIN_SIZE&&o.size<s.D.FILE.MAX_SIZE){const d=o.name.split(".")[1],c=new FileReader;this._allowedTypes.indexOf(d)>-1?(c.readAsDataURL(o),c.onloadend=()=>{const u=c.result;"deviation"==n&&"thirtyDaysUpload"==i&&(this.thirtyDaysUploadFile=o.name+":"+u.split(",")[1]),"other"==n&&("uploadPhotos"==i&&(this.photosFiles=o.name+":"+u.split(",")[1]),"uploadAttendence"==i&&(this.attendenceFiles=o.name+":"+u.split(",")[1]),"InvoiceUpload"==i&&(this.InvoiceFiles=o.name+":"+u.split(",")[1]),"btcInvoice"==i&&this._btcInvoiceFiles.push(o.name+":"+u.split(",")[1]),"bteInvoice"==i&&(this._bteInvoiceFile=o.name+":"+u.split(",")[1]))}):(this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_TYPE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),this._resetControl(i))}else this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_SIZE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),this._resetControl(i)}_resetControl(t){switch(t){case"thirtyDaysUpload":this.deviationForm.controls.thirtyDaysUpload.reset();break;case"uploadPhotos":this.deviationForm.controls.uploadPhotos.reset();break;case"uploadAttendence":this.deviationForm.controls.uploadAttendence.reset()}}postEventSubmit(){let t=0;if((this.show30DaysUpload&&!Boolean(this.deviationForm.value.thirtyDaysUpload)||!Boolean(this.deviationForm.value.uploadAttendence))&&(t++,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_UPLOAD,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)),0==t){this.loadingIndicator=!0,Boolean(this.thirtyDaysUploadFile)&&this.deviationFiles.push(this.thirtyDaysUploadFile),Boolean(this.photosFiles)&&this.otherFiles.push(this.photosFiles),Boolean(this.attendenceFiles)&&this.otherFiles.push(this.attendenceFiles);let n=this._authService.decodeToken();const i={Invitee:[{IinviteeName:" ",MisCode:" ",LocalConveyance:" ",btcorBte:" ",lcAmount:" "}],ExpenseSheets:this.expenseTabelDetails,EventId:this.selectedEventDetails["EventId/EventRequestId"],EventTopic:this.selectedEventDetails["Event Topic"],EventType:this.selectedEventDetails.EventType,EventDate:this.selectedEventDetails.EventDate,StartTime:this.selectedEventDetails.StartTime||" ",InitiatorName:this.selectedEventDetails.InitiatorName||n.unique_name,EndTime:this.selectedEventDetails.EndTime||" ",VenueName:" ",State:" ",City:" ",Attended:" ",InviteesParticipated:" ",ExpenseParticipated:" ",TotalExpense:` Total Expense :${this.expenseFinalAmount} | Total Budget For The Event : ${this.amountTableFinalAmount}`,Advance:`Advance Provided : ${this.amountTableFinalAmount} | Advance Utilized For Event : ${this.advancedUtilized} | Pay Back Amount To Company  : ${this.amountToPayForCompany} | Additional Amount Needed To Pay For Initiator : ${this.amountToPayForInitiator}`,Brands:this.selectedEventDetails.Brands,SlideKits:" ",Panalists:" ",InitiatorEmail:n.email||" ",RbMorBM:n.RBM_BM||" ",SalesHead:n.SalesHead||" ",MarkeringHead:n.MarketingHead||" ",Compliance:"sabri.s@vsaasglobal.com",FinanceAccounts:n.FinanceAccounts||" ",FinanceTreasury:n.FinanceTreasury||" ",MedicalAffairsHead:n.MedicalAffairsHead||"sabri.s@vsaasglobal.com",FinanceHead:n.FinanceAccounts||"sabri.s@vsaasglobal.com",EventOpen30Days:this.show30DaysUpload?"Yes":"No",EventLessThan5Days:"Yes",PostEventSubmitted:"Yes",IsAdvanceRequired:this.selectedEventDetails.IsAdvanceRequired||"No",TotalInvitees:"0",TotalAttendees:"0",TotalTravelAndAccomodationSpend:this.selectedEventDetails["Total Travel & Accomodation Spend"]+""||"0",TotalHonorariumSpend:this.selectedEventDetails["Total Honorarium Spend"]+""||"0",TotalSpend:this.selectedEventDetails["Total Spend"]+""||"0",TotalLocalConveyance:this.selectedEventDetails["Total Local Conveyance"]+""||"0",TotalTravelSpend:this.selectedEventDetails["Total Travel Spend"]+""||"0",TotalAccomodationSpend:this.selectedEventDetails["Total Accomodation Spend"]+""||"0",TotalExpenses:this.selectedEventDetails["Total Expense"]+""||"0",IsDeviationUpload:"Yes",DeviationFiles:this.deviationFiles,Files:this.otherFiles,TotalActuals:this.amountTableFinalAmount+"",AdvanceUtilizedForEvents:this.advancedUtilized+"",PayBackAmountToCompany:this.amountToPayForCompany+"",AdditionalAmountNeededToPayForInitiator:this.amountToPayForInitiator+"",ReportingManagerEmail:n.reportingmanager,FirstLevelEmail:n.firstLevelManager,FinanceTreasuryEmail:n.FinanceTreasury||" ",SalesCoordinatorEmail:n.SalesCoordinator,Role:n.role};console.log("apipayload",i),this.utilityService.postEventSettlementDetails(i).subscribe(o=>{"Data added successfully."==o.message&&(this.loadingIndicator=!1,this._snackBarService.showSnackBar(s.D.MESSAGE.SUCCESS.ADD_POST_SETTLEMENT,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.SUCCESS),this.showPostEventContent=!1,this._router.navigate(["view-event-list"]))},o=>{this.loadingIndicator=!1,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.SERVER_ERR,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)})}}_filterBTEBTE(t){this.BTESummary=[],this.BTCSummary=[],this.BTESummaryTotal=0,this.BTCSummaryTotal=0,console.log(t),t.length>0&&(t.forEach(n=>{if("BTC"==n.BtcorBte.trim()){let i={expense:n.Expense,amount:n.Amount,invoiceFile:""};this.BTCSummary.push(i),this.BTCSummaryTotal+=+i.amount}if("BTE"==n.BtcorBte.trim()){let i={expense:n.Expense,amount:n.Amount};this.BTESummary.push(i),this.BTESummaryTotal+=+i.amount}}),console.log(this.BTCSummary),console.log(this.BTESummary),console.log(this.BTESummaryTotal),console.log(this.BTCSummaryTotal))}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(g.t),e.Y36(v.gz),e.Y36(S.c),e.Y36(v.F0),e.Y36(C.e))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-stall-posteventsettlement"]],decls:31,vars:5,consts:[[1,"card-body"],[1,"row"],[1,"col-md-12"],[1,"card"],[1,"container","table-responsive"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],["class","col mt-2",4,"ngIf"],[1,"col-5"],["color","accent","appearance","outline",4,"ngIf"],["class","container",4,"ngIf"],[3,"isLoading"],["scope","row"],[1,"col","mt-2"],[3,"formGroup"],[1,"col","m-3"],[2,"color","red"],["type","file","id","thirtyDaysUpload","formControlName","thirtyDaysUpload",3,"accept","change"],[1,"text-danger"],["class","col m-3",4,"ngIf"],["type","file","accept",".png, .jpg","formControlName","uploadPhotos","multiple","",3,"change"],["type","file","accept",".png, .jpg","formControlName","uploadAttendence","multiple","",3,"change"],["color","accent","appearance","outline"],[3,"ngModelOptions","ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"container"],[1,"col","text-danger"],["class","container table-responsive",4,"ngIf"],[1,"col-12","d-flex","justify-content-center"],["mat-raised-button","","color","primary"],["mat-raised-button","","color","primary",3,"click"],["type","file",3,"id","accept","change"],[1,"col","d-flex","justify-content-center","text-danger"],[1,"table","text-center","table-bordered"],["colspan","2",1,"text-right"],["type","file",3,"accept","ngModelOptions","ngModel","change","ngModelChange"],["type","file",3,"accept","change"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",0)(5,"div",1)(6,"div",4)(7,"table",5)(8,"thead")(9,"tr")(10,"th")(11,"small"),e._uU(12,"S.no"),e.qZA()(),e.TgZ(13,"th")(14,"small"),e._uU(15,"Event ID"),e.qZA()(),e.TgZ(16,"th")(17,"small"),e._uU(18,"Event Name"),e.qZA()(),e.TgZ(19,"th")(20,"small"),e._uU(21,"Event Type"),e.qZA()(),e.TgZ(22,"th")(23,"small"),e._uU(24,"Event Date"),e.qZA()()()(),e.YNc(25,N,12,5,"tbody",6),e.qZA()(),e.YNc(26,H,20,4,"div",7),e.TgZ(27,"div",8),e.YNc(28,Y,5,4,"mat-form-field",9),e.qZA()(),e.YNc(29,V,103,11,"div",10),e.qZA()()()()(),e._UZ(30,"app-spinner-loader",11)),2&t&&(e.xp6(25),e.Q6J("ngForOf",n.after30DaysList),e.xp6(1),e.Q6J("ngIf",n.show30DaysUpload),e.xp6(2),e.Q6J("ngIf",n.showEventSelect),e.xp6(1),e.Q6J("ngIf",n.showPostEventContent),e.xp6(1),e.Q6J("isLoading",n.loadingIndicator))},dependencies:[h.sg,h.O5,r._Y,r.Fj,r.JJ,r.JL,r.On,r.sg,r.u,y.lW,p.KE,p.hX,A.gD,E.ey,f.r],styles:["table.table-bordered[_ngcontent-%COMP%]    > thead[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%] {\r\n    border:1px solid black;\r\n  }\r\n  table.table-bordered[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\r\n    border:1px solid rgb(209, 162, 162);\r\n  }\r\n  table.table-striped[_ngcontent-%COMP%]    > thead[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%] {\r\n    border:1px solid black;\r\n  }\r\n  table.table-striped[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\r\n    border:1px solid rgb(209, 162, 162);\r\n  }"]}),a})();function W(a,l){1&a&&e._UZ(0,"app-stall-posteventsettlement")}function X(a,l){if(1&a&&(e.TgZ(0,"mat-option",15),e._uU(1),e.qZA()),2&a){const t=l.$implicit;e.s9C("value",t.EventTypeId),e.xp6(1),e.Oqu(t.EventType)}}function ee(a,l){1&a&&(e.TgZ(0,"div"),e._uU(1," OOPS!!!! No other Event Forms yet developed "),e.qZA())}function te(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",10)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",10)(5,"div",2)(6,"div",11)(7,"mat-form-field",12)(8,"mat-label"),e._uU(9,"Select Event Type"),e.qZA(),e.TgZ(10,"mat-select",13),e.NdJ("ngModelChange",function(i){e.CHM(t);const o=e.oxw();return e.KtG(o.onEventSelect(i))})("ngModelChange",function(i){e.CHM(t);const o=e.oxw();return e.KtG(o.selectedEvent=i)}),e.YNc(11,X,2,2,"mat-option",14),e.qZA()()()(),e.YNc(12,ee,2,0,"div",7),e.qZA()()()()()}if(2&a){const t=e.oxw();e.xp6(10),e.Q6J("ngModel",t.selectedEvent),e.xp6(1),e.Q6J("ngForOf",t.eventList),e.xp6(1),e.Q6J("ngIf","select"!==t.selectedEvent&&"EVTC1"!==t.selectedEvent&&"EVTSF"!==t.selectedEvent&&"EVTWEB"!==t.selectedEvent)}}let ne=(()=>{class a{constructor(t,n){this.utility=t,this.router=n,this.loadingIndicator=!1,this.selectedEvent="select",this.loadingIndicator=!0,t.getEventTypes().subscribe(i=>{this.loadingIndicator=!1,this.eventList=i},i=>{console.log(i)})}ngOnInit(){this.utility.getPreviousEventsFast()}onEventSelect(t){console.log(t),"EVTC1"==t?this.router.navigate(["post-event-settlement/event-settlement"]):"EVTWEB"==t?this.router.navigate(["post-event-settlement/event-settlement-webinar"]):"EVTHC"==t?this.router.navigate(["post-event-settlement/event-settlement-hcp-consultants"]):"EVTMU"==t&&this.router.navigate(["post-event-settlement/event-settlement-medical-utility"])}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(g.t),e.Y36(v.F0))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-post-event-settlement"]],decls:11,vars:3,consts:[[1,"main-content"],[1,"container-fluid"],[1,"row"],[1,"col-md-12"],[1,"card"],[1,"card-header","card-header-danger"],[1,"card-title"],[4,"ngIf"],["class","card-body",4,"ngIf"],[3,"isLoading"],[1,"card-body"],[1,"col-md-6"],["color","accent","appearance","outline",1,"example-full-width"],["required","",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h4",6),e._uU(7,"Post Event Settlement Request"),e.qZA()(),e.YNc(8,W,1,0,"app-stall-posteventsettlement",7),e.YNc(9,te,13,3,"div",8),e.qZA()(),e._UZ(10,"app-spinner-loader",9),e.qZA()()()),2&t&&(e.xp6(8),e.Q6J("ngIf","EVTSF"==n.selectedEvent),e.xp6(1),e.Q6J("ngIf","select"==n.selectedEvent),e.xp6(1),e.Q6J("isLoading",n.loadingIndicator))},dependencies:[h.sg,h.O5,r.JJ,r.Q7,r.On,p.KE,p.hX,A.gD,E.ey,j,f.r],styles:["table.table-bordered[_ngcontent-%COMP%]    > thead[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%] {\r\n  border:1px solid black;\r\n}\r\ntable.table-bordered[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\r\n  border:1px solid rgb(209, 162, 162);\r\n}\r\ntable.table-striped[_ngcontent-%COMP%]    > thead[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%] {\r\n  border:1px solid black;\r\n}\r\ntable.table-striped[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\r\n  border:1px solid rgb(209, 162, 162);\r\n}"]}),a})();var T=m(5412);let M=(()=>{class a{constructor(t){this.dialogRef=t}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(T.so))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-delete-invitee-confirmation-modal"]],decls:9,vars:0,consts:[["mat-dialog-title",""],["mat-button","",1,"btn","btn-secondary",3,"click"],["mat-button","",1,"btn","btn-danger",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"h2",0),e._uU(1,"Confirm Delete"),e.qZA(),e.TgZ(2,"mat-dialog-content"),e._uU(3,"Are you sure you want to delete this invitee?"),e.qZA(),e.TgZ(4,"mat-dialog-actions")(5,"button",1),e.NdJ("click",function(){return n.dialogRef.close(!1)}),e._uU(6,"Cancel"),e.qZA(),e.TgZ(7,"button",2),e.NdJ("click",function(){return n.dialogRef.close(!0)}),e._uU(8,"Delete"),e.qZA()())},dependencies:[y.lW,T.uh,T.xY,T.H8],encapsulation:2}),a})();var I=m(4144),P=m(7957),x=m(1948);function ie(a,l){1&a&&(e.TgZ(0,"div",3)(1,"mat-form-field",4)(2,"mat-label"),e._uU(3,"HCP Name"),e.qZA(),e._UZ(4,"input",20),e.qZA(),e.TgZ(5,"mat-form-field",4)(6,"mat-label"),e._uU(7,"Speciality"),e.qZA(),e._UZ(8,"input",21),e.qZA(),e.TgZ(9,"mat-form-field",4)(10,"mat-label"),e._uU(11,"HCP Type"),e.qZA(),e.TgZ(12,"mat-select",22)(13,"mat-option",23),e._uU(14,"NGO"),e.qZA(),e.TgZ(15,"mat-option",24),e._uU(16,"GO-A"),e.qZA()()()())}function ae(a,l){if(1&a&&(e.TgZ(0,"mat-option",28),e._uU(1),e.qZA()),2&a){const t=l.$implicit;e.s9C("value",t.MisCode),e.xp6(1),e.Oqu(t.HCPName+" ("+t.MisCode+")")}}function oe(a,l){if(1&a&&(e.TgZ(0,"mat-form-field",4)(1,"mat-label"),e._uU(2,"Enter Invitee Name"),e.qZA(),e._UZ(3,"input",25),e.TgZ(4,"mat-autocomplete",null,26),e.YNc(6,ae,2,2,"mat-option",27),e.qZA()()),2&a){const t=e.MAs(5),n=e.oxw();e.xp6(3),e.Q6J("matAutocomplete",t),e.xp6(3),e.Q6J("ngForOf",n.filteredHCPMasterInvitees)}}function se(a,l){1&a&&(e.TgZ(0,"div")(1,"mat-label")(2,"b"),e._uU(3,"Is BTC / BTE?"),e.qZA()(),e.TgZ(4,"mat-radio-group",29)(5,"div",14)(6,"mat-radio-button",30),e._uU(7,"BTC"),e.qZA(),e.TgZ(8,"mat-radio-button",31),e._uU(9,"BTE"),e.qZA()()()())}function le(a,l){1&a&&(e.TgZ(0,"mat-form-field",4)(1,"mat-label"),e._uU(2,"Enter Local Conveyance Amount"),e.qZA(),e._UZ(3,"input",32),e.qZA())}let R=(()=>{class a{constructor(t,n,i,o,d,c,u){this.data=t,this.utilityService=n,this.auth=i,this.router=o,this._snackBarService=d,this._authService=c,this.dialogRef=u,this.loadingIndicator=!1,this.showinvitees=!1,this.showInviteeLocalConveyance=!1,this.filteredInviteeLength=0,this.hideInviteeMisCode=!0,this.filteredInviteeMisCodeSelect=[]}ngOnInit(){this.loadingIndicator=!0,this.eventId=this.data.eventId,this.utilityService.getEmployeesFromHCPMaster().subscribe(t=>{this.inviteesFromHCPMaster=t,console.log("Before SPlice",this.inviteesFromHCPMaster.length),this.inviteesFromHCPMaster.splice(1e3),console.log("After SPlice",this.inviteesFromHCPMaster.length),console.log(this.inviteesFromHCPMaster),this.loadingIndicator=!1}),this.inviteeSelectionForm=new r.cw({inviteesFrom:new r.NI("",r.kI.required),inviteeName:new r.NI(""),inviteeMisCode:new r.NI(""),isInviteeLocalConveyance:new r.NI("No",r.kI.required),inviteeLocalConveyanceAmount:new r.NI(0),inviteeBTC:new r.NI(""),uploadAgenda:new r.NI(""),uploadInvitation:new r.NI(""),InviteeName:new r.NI(""),inviteedFrom:new r.NI(""),Speciality:new r.NI(""),HCPType:new r.NI("")}),this.inviteeSelectionFormPrePopulate()}inviteeSelectionFormPrePopulate(){this.inviteeSelectionForm.get("inviteeMisCode").disable(),this.inviteeSelectionForm.valueChanges.subscribe(t=>{if(console.log(t),this.showInviteeLocalConveyance="Yes"==t.isInviteeLocalConveyance,t.inviteesFrom&&(this.filteredHCPMasterInvitees=null,this.filteredInviteeMisCode=""),""!=t.inviteeName&&this.inviteeSelectionForm.controls.inviteesFrom.touched&&"HCP Master"==t.inviteesFrom){this.filteredHCPMasterInvitees=this.filterHCPMasterInvitees(t.inviteeName),console.log(this.filteredHCPMasterInvitees),console.log("filterr",this.getFilteredInvitee(t.inviteeName));const n=this.getFilteredInvitee(t.inviteeName);Boolean(n)&&(console.log("filteredInvitee",n),this.inviteeSelectionForm.controls.inviteeName.setValue(n.HCPName),this.inviteeSelectionForm.controls.inviteeMisCode.setValue(n.MisCode),this.filteredInviteeMisCode=n.MisCode)}"Menarini Employees"==t.inviteesFrom&&""!=this.inviteeSelectionForm.controls.inviteeMisCode.value&&this.inviteeSelectionForm.controls.inviteeMisCode.setValue(""),this.showinvitees="Others"==t.inviteesFrom})}filterHCPMasterInvitees(t){if(console.log("nam",Boolean(t)),Boolean(t))return this.inviteesFromHCPMaster.filter(n=>{if(n.HCPName)return n.HCPName.toLowerCase().includes(t.toLowerCase())})}getFilteredInvitee(t){if(console.log("mis",Boolean(t),t),Boolean(t))return this.inviteesFromHCPMaster.find(n=>n.MisCode==t)}getHCPMasterInviteeWithName(t){if(Boolean(t)){const n=[];return this.inviteesFromHCPMaster.forEach(i=>{i.HCPName&&i.HCPName.toLowerCase()===t.toLowerCase()&&n.push(i)}),n}}addToInviteeTable(){let t=0;if(this.inviteeSelectionForm.valid||(this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILL_ALL,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),t++),this.showInviteeLocalConveyance&&(0==this.inviteeSelectionForm.value.inviteeLocalConveyanceAmount||!Boolean(this.inviteeSelectionForm.value.inviteeLocalConveyanceAmount))&&(this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILL_LOCAL_CONVEYANCE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),t++),this.showInviteeLocalConveyance&&!Boolean(this.inviteeSelectionForm.value.inviteeBTC)&&(this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILL_LOCAL_CONVEYANCE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),t++),!this.hideInviteeMisCode&&!Boolean(this.inviteeSelectionForm.value.inviteeMisCode)&&(this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILL_MIS,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),t++),0==t){const n={eventIdOrEventRequestId:this.eventId,misCode:Boolean(this.inviteeSelectionForm.get("inviteeMisCode").value)?this.inviteeSelectionForm.get("inviteeMisCode").value+"":" ",inviteeName:this.inviteeSelectionForm.value.inviteeName||this.inviteeSelectionForm.value.InviteeName,localConveyance:this.inviteeSelectionForm.value.isInviteeLocalConveyance,btcorBte:Boolean(this.inviteeSelectionForm.value.inviteeBTC)?this.inviteeSelectionForm.value.inviteeBTC:"NIL",lcAmount:this.showInviteeLocalConveyance?this.inviteeSelectionForm.value.inviteeLocalConveyanceAmount+"":"0",inviteedFrom:this.inviteeSelectionForm.value.inviteesFrom||" ",speciality:this.inviteeSelectionForm.value.Speciality||" ",hcpType:this.inviteeSelectionForm.value.HCPType};console.log(n),this.loadingIndicator=!0,this.utilityService.postAddNewInviteesRequest([n]).subscribe(i=>{console.log(i),"Data added successfully."==i.message&&(this.loadingIndicator=!1,this._snackBarService.showSnackBar(s.D.MESSAGE.SUCCESS.ADD_INVITEE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.SUCCESS),this.dialogRef.close())},i=>{this.loadingIndicator=!1,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.ADD_INVITEE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)})}}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(T.WI),e.Y36(g.t),e.Y36(C.e),e.Y36(v.F0),e.Y36(S.c),e.Y36(C.e),e.Y36(T.so))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-add-invitee-modal"]],decls:39,vars:7,consts:[["mat-dialog-title",""],[3,"formGroup"],[1,"row"],[1,"col"],["color","accent","appearance","outline"],["formControlName","inviteesFrom"],["value","HCP Master"],["value","Menarini Employees"],["value","Others"],["class","col",4,"ngIf"],["color","accent","appearance","outline",4,"ngIf"],[4,"ngIf"],["matInput","","type","text","disabled","","formControlName","inviteeMisCode"],["value","No","formControlName","isInviteeLocalConveyance"],[1,"mt-2"],["value","Yes"],["value","No",1,"m-1"],["mat-button","",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary","btn-sm",3,"disabled","click"],[3,"isLoading"],["matInput","","type","text","formControlName","InviteeName"],["matInput","","type","text","formControlName","Speciality"],["formControlName","HCPType"],["value","NGO"],["value","GO-A"],["matInput","","type","text","placeholder","Mention Invitee Name","formControlName","inviteeName",3,"matAutocomplete"],["autoInvitee","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["formControlName","inviteeBTC"],["value","BTC"],["value","BTE",1,"m-1"],["matInput","","type","number","formControlName","inviteeLocalConveyanceAmount"]],template:function(t,n){1&t&&(e.TgZ(0,"h2",0),e._uU(1,"Add Invitee"),e.qZA(),e.TgZ(2,"form",1)(3,"div",2)(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),e._uU(7,"Invitees From"),e.qZA(),e.TgZ(8,"mat-select",5)(9,"mat-option",6),e._uU(10,"from HCP master"),e.qZA(),e.TgZ(11,"mat-option",7),e._uU(12,"from Menarini"),e.qZA(),e.TgZ(13,"mat-option",8),e._uU(14,"Other"),e.qZA()()(),e.YNc(15,ie,17,0,"div",9),e.YNc(16,oe,7,2,"mat-form-field",10),e.YNc(17,se,10,0,"div",11),e.qZA(),e.TgZ(18,"div",3)(19,"mat-form-field",4)(20,"mat-label"),e._uU(21,"Enter Invitee MIS Code"),e.qZA(),e._UZ(22,"input",12),e.qZA(),e.TgZ(23,"mat-label")(24,"b"),e._uU(25,"Is Local Conveyance applicable?"),e.qZA()(),e.TgZ(26,"mat-radio-group",13)(27,"div",14)(28,"mat-radio-button",15),e._uU(29,"Yes"),e.qZA(),e.TgZ(30,"mat-radio-button",16),e._uU(31,"No"),e.qZA()()(),e.YNc(32,le,4,0,"mat-form-field",10),e.qZA()(),e.TgZ(33,"mat-dialog-actions")(34,"button",17),e.NdJ("click",function(){return n.dialogRef.close(!1)}),e._uU(35,"Cancel"),e.qZA(),e.TgZ(36,"button",18),e.NdJ("click",function(){return n.addToInviteeTable()}),e._uU(37,"Add New"),e.qZA()(),e._UZ(38,"app-spinner-loader",19),e.qZA()),2&t&&(e.xp6(2),e.Q6J("formGroup",n.inviteeSelectionForm),e.xp6(13),e.Q6J("ngIf",1==n.showinvitees),e.xp6(1),e.Q6J("ngIf",!n.showinvitees),e.xp6(1),e.Q6J("ngIf",n.showInviteeLocalConveyance),e.xp6(15),e.Q6J("ngIf",n.showInviteeLocalConveyance),e.xp6(4),e.Q6J("disabled",n.inviteeSelectionForm.invalid),e.xp6(2),e.Q6J("isLoading",n.loadingIndicator))},dependencies:[h.sg,h.O5,r._Y,r.Fj,r.wV,r.JJ,r.JL,r.sg,r.u,y.lW,p.KE,p.hX,I.Nt,A.gD,E.ey,T.uh,T.H8,P.XC,P.ZL,x.VQ,x.U0,f.r],encapsulation:2}),a})();var D=m(7579),_=m(2722),re=m(1481);const b=function(){return{standalone:!0}};function de(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td")(4,"input",14),e.NdJ("ngModelChange",function(i){e.CHM(t);const o=e.oxw(2);return e.KtG(o.onAttendanceCheckBoxChange(i))})("ngModelChange",function(i){const d=e.CHM(t).$implicit;return e.KtG(d.isPresent=i)}),e.qZA()(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td"),e._uU(14),e.qZA(),e.TgZ(15,"td")(16,"input",15),e.NdJ("ngModelChange",function(i){const o=e.CHM(t),d=o.$implicit,c=o.index,u=e.oxw(2);return e.KtG(u.onHcpInviteesActualAmountChanges(i,d,c))})("ngModelChange",function(i){const d=e.CHM(t).$implicit;return e.KtG(d.actualExpense=i)}),e.qZA()()()}if(2&a){const t=l.$implicit,n=l.index;e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Q6J("ngModelOptions",e.DdM(10,b))("ngModel",t.isPresent),e.xp6(2),e.Oqu(t.InviteeName),e.xp6(2),e.Oqu(t.MISCode||"N/A"),e.xp6(2),e.Oqu(t.LocalConveyance),e.xp6(2),e.Oqu(t.BtcorBte||"N/A"),e.xp6(2),e.Oqu(t.LcAmount),e.xp6(2),e.Q6J("ngModelOptions",e.DdM(11,b))("ngModel",t.actualExpense)}}function ce(a,l){if(1&a&&(e.TgZ(0,"div",10)(1,"div",11)(2,"h4")(3,"b"),e._uU(4,"HCP Invitees"),e.qZA()()(),e.TgZ(5,"table",12)(6,"thead")(7,"tr")(8,"th")(9,"small"),e._uU(10,"S.no"),e.qZA()(),e.TgZ(11,"th")(12,"small"),e._uU(13,"Is Present?"),e.qZA()(),e.TgZ(14,"th")(15,"small"),e._uU(16,"HCP Name"),e.qZA()(),e.TgZ(17,"th")(18,"small"),e._uU(19,"MIS Code"),e.qZA()(),e.TgZ(20,"th")(21,"small"),e._uU(22,"Local Conveyance Applicable"),e.qZA()(),e.TgZ(23,"th")(24,"small"),e._uU(25,"BTC/BTE"),e.qZA()(),e.TgZ(26,"th")(27,"small"),e._uU(28,"Local Conveyance Amount Including Tax"),e.qZA()(),e.TgZ(29,"th")(30,"small"),e._uU(31,"Actual Amount"),e.qZA()()()(),e.TgZ(32,"tbody"),e.YNc(33,de,17,12,"tr",13),e.qZA()()()),2&a){const t=e.oxw();e.xp6(33),e.Q6J("ngForOf",t.hcpInvitees)}}function ue(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td")(4,"input",14),e.NdJ("ngModelChange",function(i){e.CHM(t);const o=e.oxw(2);return e.KtG(o.onAttendanceCheckBoxChange(i))})("ngModelChange",function(i){const d=e.CHM(t).$implicit;return e.KtG(d.isPresent=i)}),e.qZA()(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td"),e._uU(14),e.qZA(),e.TgZ(15,"td")(16,"input",15),e.NdJ("ngModelChange",function(i){const o=e.CHM(t),d=o.$implicit,c=o.index,u=e.oxw(2);return e.KtG(u.onMenariniInviteesActualAmountChanges(i,d,c))})("ngModelChange",function(i){const d=e.CHM(t).$implicit;return e.KtG(d.actualExpense=i)}),e.qZA()()()}if(2&a){const t=l.$implicit,n=l.index;e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Q6J("ngModelOptions",e.DdM(10,b))("ngModel",t.isPresent),e.xp6(2),e.Oqu(t.InviteeName),e.xp6(2),e.Oqu(t.MISCode||"N/A"),e.xp6(2),e.Oqu(t.LocalConveyance),e.xp6(2),e.Oqu(t.BtcorBte||"N/A"),e.xp6(2),e.Oqu(t.LcAmount),e.xp6(2),e.Q6J("ngModelOptions",e.DdM(11,b))("ngModel",t.actualExpense)}}function me(a,l){if(1&a&&(e.TgZ(0,"div",10)(1,"div",11)(2,"h4")(3,"b"),e._uU(4,"Menarini Employees Invitees"),e.qZA()()(),e.TgZ(5,"table",12)(6,"thead")(7,"tr")(8,"th")(9,"small"),e._uU(10,"S.no"),e.qZA()(),e.TgZ(11,"th")(12,"small"),e._uU(13,"Is Present?"),e.qZA()(),e.TgZ(14,"th")(15,"small"),e._uU(16,"Employee Name"),e.qZA()(),e.TgZ(17,"th")(18,"small"),e._uU(19,"Employee Code"),e.qZA()(),e.TgZ(20,"th")(21,"small"),e._uU(22,"Local Conveyance Applicable"),e.qZA()(),e.TgZ(23,"th")(24,"small"),e._uU(25,"BTC/BTE"),e.qZA()(),e.TgZ(26,"th")(27,"small"),e._uU(28,"Local Conveyance Amount Including Tax"),e.qZA()(),e.TgZ(29,"th")(30,"small"),e._uU(31,"Actual Amount"),e.qZA()()()(),e.TgZ(32,"tbody"),e.YNc(33,ue,17,12,"tr",13),e.qZA()()()),2&a){const t=e.oxw();e.xp6(33),e.Q6J("ngForOf",t.menariniInvitees)}}function he(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td")(4,"input",14),e.NdJ("ngModelChange",function(i){e.CHM(t);const o=e.oxw(2);return e.KtG(o.onAttendanceCheckBoxChange(i))})("ngModelChange",function(i){const d=e.CHM(t).$implicit;return e.KtG(d.isPresent=i)}),e.qZA()(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td"),e._uU(14),e.qZA(),e.TgZ(15,"td"),e._uU(16),e.qZA(),e.TgZ(17,"td")(18,"input",15),e.NdJ("ngModelChange",function(i){const o=e.CHM(t),d=o.$implicit,c=o.index,u=e.oxw(2);return e.KtG(u.onOtherHcpInviteesActualAmountChanges(i,d,c))})("ngModelChange",function(i){const d=e.CHM(t).$implicit;return e.KtG(d.actualExpense=i)}),e.qZA()()()}if(2&a){const t=l.$implicit,n=l.index;e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Q6J("ngModelOptions",e.DdM(11,b))("ngModel",t.isPresent),e.xp6(2),e.Oqu(t.InviteeName),e.xp6(2),e.Oqu(t.speciality||"N/A"),e.xp6(2),e.Oqu(t.hcpType||"N/A"),e.xp6(2),e.Oqu(t.LocalConveyance),e.xp6(2),e.Oqu(t.BtcorBte||"N/A"),e.xp6(2),e.Oqu(t.LcAmount),e.xp6(2),e.Q6J("ngModelOptions",e.DdM(12,b))("ngModel",t.actualExpense)}}function pe(a,l){if(1&a&&(e.TgZ(0,"div",10)(1,"div",11)(2,"h4")(3,"b"),e._uU(4,"Non HCP Invitees"),e.qZA()()(),e.TgZ(5,"table",12)(6,"thead")(7,"tr")(8,"th")(9,"small"),e._uU(10,"S.no"),e.qZA()(),e.TgZ(11,"th")(12,"small"),e._uU(13,"Is Present?"),e.qZA()(),e.TgZ(14,"th")(15,"small"),e._uU(16,"HCP Name"),e.qZA()(),e.TgZ(17,"th")(18,"small"),e._uU(19,"Specicality"),e.qZA()(),e.TgZ(20,"th")(21,"small"),e._uU(22,"HCP Type"),e.qZA()(),e.TgZ(23,"th")(24,"small"),e._uU(25,"Local Conveyance Applicable"),e.qZA()(),e.TgZ(26,"th")(27,"small"),e._uU(28,"BTC/BTE"),e.qZA()(),e.TgZ(29,"th")(30,"small"),e._uU(31,"Local Conveyance Amount Including Tax"),e.qZA()(),e.TgZ(32,"th")(33,"small"),e._uU(34,"Actual Amount"),e.qZA()()()(),e.TgZ(35,"tbody"),e.YNc(36,he,19,13,"tr",13),e.qZA()()()),2&a){const t=e.oxw();e.xp6(36),e.Q6J("ngForOf",t.otherInvitees)}}function _e(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",16)(1,"mat-label")(2,"b"),e._uU(3,"Less than 5 attendees excluding speaker"),e.TgZ(4,"span",17),e._uU(5,"*"),e.qZA()()(),e._UZ(6,"br"),e.TgZ(7,"div",18)(8,"input",19),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw();return e.KtG(o.onFileSelected(i,"deviation","inviteeDeviation"))}),e.qZA(),e._UZ(9,"br"),e.TgZ(10,"span",20)(11,"small"),e._uU(12,"Allowed File Types (.png, .jpg, .txt , .doc)"),e.qZA()(),e._UZ(13,"br"),e.TgZ(14,"span",20)(15,"small"),e._uU(16,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()()()()}if(2&a){const t=e.oxw();e.xp6(8),e.Q6J("accept",t.allowedTypesForHTML)}}function ve(a,l){if(1&a&&(e.TgZ(0,"div")(1,"mat-label"),e._uU(2,"Attendance Sheet"),e.qZA(),e._UZ(3,"iframe",21),e.qZA()),2&a){const t=e.oxw();e.xp6(3),e.Q6J("src",t.attendancePdfIframeUrl,e.uOi)}}let O=(()=>{class a{constructor(t,n,i){this._utilityService=t,this._snackBarService=n,this._sanitizer=i,this.loadingIndicator=!1,this._ngUnSubscribe=new D.x,this.menariniInvitees=[],this.hcpInvitees=[],this.otherInvitees=[],this.totalAttendance=0,this._totalInviteeAmount=0,this.showAttendanceDeviation=!1,this.showAttendancePdf=!1,this._totalHcpInviteeActualAmount=0,this._totalMenariniInviteeActualAmount=0,this._totalOtherHcpInviteeActualAmount=0}ngOnInit(){this._getInvitees(),this.inviteeForm=new r.cw({totalInvitees:new r.NI({value:0,disabled:!0}),inviteeDeviation:new r.NI("")}),this._allowedTypes=s.D.FILE.ALLOWED,this._allowedTypes.forEach(t=>{this.allowedTypesForHTML+="."+t+", "})}_getInvitees(){this._utilityService.data.pipe((0,_.R)(this._ngUnSubscribe.asObservable())).subscribe(t=>{"eventSettlementInvitees"==t.from&&(this._getAttendancePdf(t.eventId),this._filterIviteesBasedOnSource(t.data))})}_getAttendancePdf(t){this.loadingIndicator=!0,this._utilityService.getPostEventAttendancePdf(t).pipe((0,_.R)(this._ngUnSubscribe.asObservable())).subscribe(n=>{if(this.loadingIndicator=!1,n.data.includes("AttendenceSheet")){let i=n.data.split(":");this.showAttendancePdf=!0,this.attendancePdfIframeUrl=this._sanitizeUrl(i[0],i[1])}},n=>{this.loadingIndicator=!1})}_sanitizeUrl(t,n){if("pdf"==t.split(".")[1])return this._sanitizer.bypassSecurityTrustResourceUrl("data:application/pdf;base64,"+n)}_filterIviteesBasedOnSource(t){this.menariniInvitees=[],this.hcpInvitees=[],this.otherInvitees=[],this.totalAttendance=0,this._totalInviteeAmount=0,this._totalHcpInviteeActualAmount=0,this._totalMenariniInviteeActualAmount=0,this._totalOtherHcpInviteeActualAmount=0,t.forEach(n=>{if(Boolean(n.inviteeSource)){let i=n.inviteeSource.trim().split(" ").join();i.toLowerCase().includes("other")?this.otherInvitees.push(n):i.toLowerCase().includes("hcp")?this.hcpInvitees.push(n):this.menariniInvitees.push(n)}})}onAttendanceCheckBoxChange(t){t?this.totalAttendance++:this.totalAttendance--,this.showAttendanceDeviation=this.totalAttendance>0&&this.totalAttendance<5,this._sendPayloadData()}onHcpInviteesActualAmountChanges(t,n,i){this._totalHcpInviteeActualAmount=0,n.actualExpense=t,this._calculateInviteeFinalAmount()}onMenariniInviteesActualAmountChanges(t,n,i){this._totalMenariniInviteeActualAmount=0,n.actualExpense=t,this._calculateInviteeFinalAmount()}onOtherHcpInviteesActualAmountChanges(t,n,i){this._totalOtherHcpInviteeActualAmount=0,n.actualExpense=t,this._calculateInviteeFinalAmount()}onFileSelected(t,n,i){const o=t.target.files[0];if(t.target.files.length>0)if(o.size>=s.D.FILE.MIN_SIZE&&o.size<s.D.FILE.MAX_SIZE){const d=o.name.split(".")[1],c=new FileReader;this._allowedTypes.indexOf(d)>-1?(c.readAsDataURL(o),c.onloadend=()=>{"deviation"==n&&"inviteeDeviation"==i&&(this._inviteeDeviationFile="Lessthan5InviteesDeviationFile"+d+":"+c.result.split(",")[1],this._sendPayloadData())}):(this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_TYPE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),this._resetControl(i))}else this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_SIZE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),this._resetControl(i)}_resetControl(t){"inviteeDeviation"===t&&this.inviteeForm.controls.inviteeDeviation.reset()}_calculateInviteeFinalAmount(){this._totalHcpInviteeActualAmount=0,this._totalMenariniInviteeActualAmount=0,this._totalOtherHcpInviteeActualAmount=0,this.hcpInvitees.forEach(t=>this._totalHcpInviteeActualAmount+=+t.actualExpense),this.menariniInvitees.forEach(t=>this._totalMenariniInviteeActualAmount+=+t.actualExpense),this.otherInvitees.forEach(t=>this._totalOtherHcpInviteeActualAmount+=+t.actualExpense),this._sendAmount()}_sendAmount(){this._utilityService.sendAdvanceData({actualInviteeAmount:this._totalHcpInviteeActualAmount+this._totalMenariniInviteeActualAmount+this._totalOtherHcpInviteeActualAmount,for:"actualCalculation",from:"inviteeSummary"})}_sendPayloadData(){this._utilityService.sendData({from:"inviteeSummary",for:"apiPayload",attendedInviteesCount:this.totalAttendance,attendanceDeviation:this._inviteeDeviationFile})}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(g.t),e.Y36(S.c),e.Y36(re.H7))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-post-event-settlement-invitees-summary"]],decls:15,vars:8,consts:[["class","container table-responsive",4,"ngIf"],[1,"container"],[3,"formGroup"],[1,"row","m-2"],[1,"col-md-6","m-1"],["color","accent","appearance","outline"],["type","number","matInput","","placeholder","Enter Expense amount","formControlName","totalInvitees",3,"value"],["class","col",4,"ngIf"],[4,"ngIf"],[3,"isLoading"],[1,"container","table-responsive"],[1,"col","d-flex","justify-content-center","text-danger"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],["type","checkbox",3,"ngModelOptions","ngModel","ngModelChange"],["type","number",3,"ngModelOptions","ngModel","ngModelChange"],[1,"col"],[2,"color","red"],[1,"m-2"],["type","file","formControlName","inviteeDeviation",3,"accept","change"],[1,"text-danger"],["width","100%","height","200","frameBorder","0",2,"border","1px solid red",3,"src"]],template:function(t,n){1&t&&(e.YNc(0,ce,34,1,"div",0),e.YNc(1,me,34,1,"div",0),e.YNc(2,pe,37,1,"div",0),e.TgZ(3,"div",1)(4,"form",2)(5,"div",3)(6,"div",4)(7,"mat-form-field",5)(8,"mat-label")(9,"b"),e._uU(10,"Total Attendance"),e.qZA()(),e._UZ(11,"input",6),e.qZA()(),e.YNc(12,_e,17,1,"div",7),e.qZA()(),e.YNc(13,ve,4,1,"div",8),e.qZA(),e._UZ(14,"app-spinner-loader",9)),2&t&&(e.Q6J("ngIf",n.hcpInvitees.length>0),e.xp6(1),e.Q6J("ngIf",n.menariniInvitees.length>0),e.xp6(1),e.Q6J("ngIf",n.otherInvitees.length>0),e.xp6(2),e.Q6J("formGroup",n.inviteeForm),e.xp6(7),e.Q6J("value",n.totalAttendance),e.xp6(1),e.Q6J("ngIf",n.showAttendanceDeviation),e.xp6(1),e.Q6J("ngIf",n.showAttendancePdf),e.xp6(1),e.Q6J("isLoading",n.loadingIndicator))},dependencies:[h.sg,h.O5,r._Y,r.Fj,r.wV,r.Wl,r.JJ,r.JL,r.On,r.sg,r.u,p.KE,p.hX,I.Nt,f.r],styles:["table.table-bordered[_ngcontent-%COMP%]    > thead[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%] {\r\n    border:1px solid black;\r\n  }\r\n  table.table-bordered[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\r\n    border:1px solid rgb(209, 162, 162);\r\n  }\r\n  table.table-striped[_ngcontent-%COMP%]    > thead[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%] {\r\n    border:1px solid black;\r\n  }\r\n  table.table-striped[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\r\n    border:1px solid rgb(209, 162, 162);\r\n  }"]}),a})();function ge(a,l){if(1&a&&(e.TgZ(0,"mat-option",21),e._uU(1),e.qZA()),2&a){const t=l.$implicit;e.Q6J("value",t["Deviation Type"]),e.xp6(1),e.Oqu(t["Deviation Type"])}}function Te(a,l){1&a&&(e.TgZ(0,"mat-form-field",11)(1,"mat-label"),e._uU(2,"Enter Deviation Type"),e.qZA(),e._UZ(3,"input",22),e.qZA())}function Ae(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"form",3)(1,"div",10)(2,"mat-form-field",11)(3,"mat-label"),e._uU(4,"Deviation Types"),e.qZA(),e.TgZ(5,"mat-select",12),e.YNc(6,ge,2,2,"mat-option",13),e.qZA()()(),e.TgZ(7,"div",10),e.YNc(8,Te,4,0,"mat-form-field",14),e.qZA(),e.TgZ(9,"div",10)(10,"div",15)(11,"mat-label")(12,"b"),e._uU(13,"Upload Deviation"),e.qZA(),e.TgZ(14,"span",16),e._uU(15,"*"),e.qZA()(),e._UZ(16,"br"),e.TgZ(17,"input",17),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw();return e.KtG(o.onFileSelected(i,"other","deviationUpload"))}),e.qZA(),e._UZ(18,"br"),e.TgZ(19,"span",18)(20,"small"),e._uU(21,"Allowed File Types (.png, .jpg, .txt , .doc)"),e.qZA()(),e._UZ(22,"br"),e.TgZ(23,"span",18)(24,"small"),e._uU(25,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()()()(),e.TgZ(26,"div",19)(27,"button",20),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.addDeviation())}),e._uU(28,"Add Deviation"),e.qZA()()()}if(2&a){const t=e.oxw();e.Q6J("formGroup",t.deviationForm),e.xp6(6),e.Q6J("ngForOf",t.DeviationTypes),e.xp6(2),e.Q6J("ngIf",t.showOtherDeviationField),e.xp6(9),e.Q6J("accept",t.allowedTypesForHTML)}}function Ee(a,l){if(1&a&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA()()),2&a){const t=l.$implicit,n=l.index;e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(t.deviationType),e.xp6(2),e.Oqu(t.deviationFile)}}function Se(a,l){if(1&a&&(e.TgZ(0,"div",23)(1,"table",24)(2,"thead")(3,"tr")(4,"th")(5,"b")(6,"small"),e._uU(7,"S.no"),e.qZA()()(),e.TgZ(8,"th")(9,"b")(10,"small"),e._uU(11,"Deviation Type"),e.qZA()()(),e.TgZ(12,"th")(13,"b")(14,"small"),e._uU(15,"Deviation Files"),e.qZA()()()()(),e.TgZ(16,"tbody"),e.YNc(17,Ee,7,3,"tr",25),e.qZA()()()),2&a){const t=e.oxw();e.xp6(17),e.Q6J("ngForOf",t.deviationTableDetails)}}let fe=(()=>{class a{constructor(t,n){this._snackBarService=t,this._utilityService=n,this.showDeviationForm=!1,this.showOtherDeviationField=!1,this._ngUnSubscribe=new D.x,this.DeviationTypes=[],this.deviationUploadFile=[],this.deviationTableDetails=[]}ngOnInit(){this.otherDeviationForm=new r.cw({needDeviation:new r.NI("",[r.kI.required])}),this.deviationForm=new r.cw({deviationType:new r.NI("",[r.kI.required]),otherDeviationField:new r.NI({value:"",disabled:!1}),deviationUpload:new r.NI("",[r.kI.required])}),this._allowedTypes=s.D.FILE.ALLOWED,this._allowedTypes.forEach(t=>{this.allowedTypesForHTML+="."+t+", "}),this._otherFormDeviationPopulate(),this._deviationFormPopulate(),this._utilityService.otherDeviationTypes().pipe((0,_.R)(this._ngUnSubscribe.asObservable())).subscribe(t=>{this.DeviationTypes=t})}ngOnDestroy(){this._ngUnSubscribe.next(),this._ngUnSubscribe.complete()}_otherFormDeviationPopulate(){this.otherDeviationForm.valueChanges.subscribe(t=>{this.showDeviationForm="Yes"==t.needDeviation})}_deviationFormPopulate(){this.deviationForm.valueChanges.subscribe(t=>{this.showOtherDeviationField="Others"==t.deviationType})}onFileSelected(t,n,i){const o=t.target.files[0];if(t.target.files.length>0)if(o.size>=s.D.FILE.MIN_SIZE&&o.size<s.D.FILE.MAX_SIZE){const d=o.name.split(".")[1],c=new FileReader;this._allowedTypes.indexOf(d)>-1?(c.readAsDataURL(o),c.onloadend=()=>{"deviation"==n&&"deviationUpload"==i&&this.deviationUploadFile.push(c.result.split(",")[1])}):(this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_TYPE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),this._resetControl(i))}else this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_SIZE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),this._resetControl(i)}_resetControl(t){"deviationUpload"===t&&this.otherDeviationForm.controls.deviationUpload.reset()}addDeviation(){let t=0;if(this.deviationForm.valid||(t++,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.OTHER_DEVIATION_ERROR,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)),this.showDeviationForm&&!this.otherDeviationForm.valid&&(t++,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.OTHER_DEVIATION_ERROR,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)),0==t){const n={deviationType:this.deviationForm.value.deviationType,deviationFile:this.deviationForm.value.deviationUpload.split("\\").pop()};this.deviationTableDetails.push(n),this.deviationForm.reset(),this.otherDeviationForm.reset()}}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(S.c),e.Y36(g.t))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-post-event-settlement-other-deviation"]],decls:17,vars:3,consts:[[1,"container"],[1,"d-flex","justify-content-center"],[1,"row"],[3,"formGroup"],["value","No","formControlName","needDeviation"],[1,"mt-2"],["value","Yes"],["value","No",1,"m-1"],[3,"formGroup",4,"ngIf"],["class","container table-responsive",4,"ngIf"],[1,"col"],["color","accent","appearance","outline"],["formControlName","deviationType"],[3,"value",4,"ngFor","ngForOf"],["color","accent","appearance","outline",4,"ngIf"],[1,"p-2","m-1"],[2,"color","red"],["type","file","formControlName","deviationUpload",3,"accept","change"],[1,"text-danger"],[1,"col-12","d-flex","justify-content-center"],["type","button",1,"btn","btn-primary","btn-sm",3,"click"],[3,"value"],["matInput","","type","text","formControlName","otherDeviationField"],[1,"container","table-responsive"],[1,"table","text-center","table-bordered"],[4,"ngFor","ngForOf"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"h4",1),e._uU(2,"Other Deviations"),e.qZA(),e.TgZ(3,"div",2)(4,"form",3)(5,"mat-label")(6,"b"),e._uU(7,"Need any other deviations?"),e.qZA()(),e.TgZ(8,"mat-radio-group",4)(9,"div",5)(10,"mat-radio-button",6),e._uU(11,"Yes"),e.qZA(),e.TgZ(12,"mat-radio-button",7),e._uU(13,"No"),e.qZA()()()()(),e.TgZ(14,"div",2),e.YNc(15,Ae,29,4,"form",8),e.qZA(),e.YNc(16,Se,18,1,"div",9),e.qZA()),2&t&&(e.xp6(4),e.Q6J("formGroup",n.otherDeviationForm),e.xp6(11),e.Q6J("ngIf",n.showDeviationForm),e.xp6(1),e.Q6J("ngIf",n.deviationTableDetails.length>0))},dependencies:[h.sg,h.O5,r._Y,r.Fj,r.JJ,r.JL,r.sg,r.u,p.KE,p.hX,I.Nt,A.gD,E.ey,x.VQ,x.U0],styles:["table.table-bordered[_ngcontent-%COMP%]    > thead[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%] {\r\n    border:1px solid black;\r\n  }\r\n  table.table-bordered[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\r\n    border:1px solid rgb(209, 162, 162);\r\n  }\r\n  table.table-striped[_ngcontent-%COMP%]    > thead[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%] {\r\n    border:1px solid black;\r\n  }\r\n  table.table-striped[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\r\n    border:1px solid rgb(209, 162, 162);\r\n  }"]}),a})();const F=function(){return{standalone:!0}};function Ce(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"tr")(1,"th",13),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td")(10,"input",14),e.NdJ("ngModelChange",function(i){const d=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.onExpenseAmountActualAmountChanges(i,d))})("ngModelChange",function(i){const d=e.CHM(t).$implicit;return e.KtG(d.actualExpense=i)}),e.qZA()()()}if(2&a){const t=l.$implicit,n=l.index;e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(t.Expense),e.xp6(2),e.Oqu(t.BtcorBte),e.xp6(2),e.Oqu(t.Amount),e.xp6(2),e.Q6J("ngModelOptions",e.DdM(6,F))("ngModel",t.actualExpense)}}function Ze(a,l){if(1&a&&(e.TgZ(0,"mat-option",27),e._uU(1),e.qZA()),2&a){const t=l.$implicit;e.s9C("value",t.ExpenseType),e.xp6(1),e.Oqu(t.ExpenseType)}}function xe(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",4)(1,"div",5)(2,"mat-label")(3,"b"),e._uU(4,"Food And Beverages Exceeds 1500 per person"),e.TgZ(5,"span",28),e._uU(6,"*"),e.qZA()()(),e._UZ(7,"br"),e.TgZ(8,"div",29)(9,"input",30),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw(2);return e.KtG(o.onFileSelected(i,"deviation","expenseDeviation"))}),e.qZA(),e._UZ(10,"br"),e.TgZ(11,"span",31)(12,"small"),e._uU(13,"Allowed File Types (.png, .jpg, .txt , .doc)"),e.qZA()(),e._UZ(14,"br"),e.TgZ(15,"span",31)(16,"small"),e._uU(17,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()()()()()}if(2&a){const t=e.oxw(2);e.xp6(9),e.Q6J("accept",t.allowedTypesForHTML)}}function be(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"form",15)(1,"div",4)(2,"div",5)(3,"mat-form-field",16)(4,"mat-label"),e._uU(5,"Expense"),e.qZA(),e.TgZ(6,"mat-select",17),e.YNc(7,Ze,2,2,"mat-option",18),e.qZA()(),e.TgZ(8,"mat-form-field",16)(9,"mat-label"),e._uU(10,"Expense amount without Tax"),e.qZA(),e.TgZ(11,"input",19),e.NdJ("input",function(i){e.CHM(t);const o=e.oxw();return e.KtG(o.onExpenseAmountChanges(i))}),e.qZA()()(),e.TgZ(12,"div",5)(13,"div")(14,"mat-label")(15,"b"),e._uU(16,"Is BTC / BTE ?"),e.qZA()(),e.TgZ(17,"mat-radio-group",20)(18,"div")(19,"mat-radio-button",21)(20,"small"),e._uU(21,"BTC"),e.qZA()(),e.TgZ(22,"mat-radio-button",22)(23,"small"),e._uU(24,"BTE"),e.qZA()()()()(),e.TgZ(25,"mat-form-field",16)(26,"mat-label"),e._uU(27,"Enter Expense amount without Tax"),e.qZA(),e._UZ(28,"input",23),e.qZA()()(),e.YNc(29,xe,18,1,"div",24),e.TgZ(30,"div",4)(31,"div",25)(32,"button",26),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.addToExpenseTable())}),e._uU(33,"AddNew"),e.qZA()()()()}if(2&a){const t=e.oxw();e.Q6J("formGroup",t.expenseForm),e.xp6(7),e.Q6J("ngForOf",t.expenseType),e.xp6(22),e.Q6J("ngIf",t.showExpenseDeviation)}}function ye(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"tr")(1,"th",13),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td")(8,"input",35),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw(2);return e.KtG(o.onFileSelected(i,"other","btcInvoice"))})("ngModelChange",function(i){const d=e.CHM(t).$implicit;return e.KtG(d.invoiceFile=i)}),e.qZA(),e._UZ(9,"br"),e.TgZ(10,"span",31)(11,"small"),e._uU(12,"Allowed File Types (.png, .jpg, .txt , .doc)"),e.qZA()(),e._UZ(13,"br"),e.TgZ(14,"span",31)(15,"small"),e._uU(16,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()()()()}if(2&a){const t=l.$implicit,n=l.index,i=e.oxw(2);e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(t.expense),e.xp6(2),e.Oqu(t.amount),e.xp6(2),e.Q6J("accept",i.allowedTypesForHTML)("ngModelOptions",e.DdM(6,F))("ngModel",t.invoiceFile)}}function De(a,l){if(1&a&&(e.TgZ(0,"div",0)(1,"div",32)(2,"h4")(3,"b"),e._uU(4,"Expense Summary"),e.qZA()()(),e.TgZ(5,"h5"),e._uU(6,"Expense Summary BTC"),e.qZA(),e.TgZ(7,"table",33)(8,"thead")(9,"tr")(10,"th")(11,"b")(12,"small"),e._uU(13,"S.no"),e.qZA()()(),e.TgZ(14,"th")(15,"b")(16,"small"),e._uU(17,"Expense Type"),e.qZA()()(),e.TgZ(18,"th")(19,"b")(20,"small"),e._uU(21,"BTC Amount"),e.qZA()()(),e.TgZ(22,"th")(23,"b")(24,"small"),e._uU(25,"Upload Invoice"),e.qZA()()()()(),e.TgZ(26,"tbody"),e.YNc(27,ye,17,7,"tr",2),e.qZA(),e.TgZ(28,"tfoot")(29,"tr")(30,"td",34)(31,"b")(32,"small"),e._uU(33,"Total BTC Amount"),e.qZA()()(),e.TgZ(34,"td"),e._uU(35),e.qZA()()()()()),2&a){const t=e.oxw();e.xp6(27),e.Q6J("ngForOf",t.BTCSummary),e.xp6(8),e.Oqu(t.BTCSummaryTotal)}}function Ie(a,l){if(1&a&&(e.TgZ(0,"tr")(1,"th",13),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA()()),2&a){const t=l.$implicit,n=l.index;e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(t.expense),e.xp6(2),e.Oqu(t.amount)}}function Fe(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",0)(1,"h5"),e._uU(2,"Expense Summary BTE"),e.qZA(),e.TgZ(3,"table",33)(4,"thead")(5,"tr")(6,"th")(7,"b")(8,"small"),e._uU(9,"S.no"),e.qZA()()(),e.TgZ(10,"th")(11,"b")(12,"small"),e._uU(13,"Expense Type"),e.qZA()()(),e.TgZ(14,"th")(15,"b")(16,"small"),e._uU(17,"BTE Amount"),e.qZA()()()()(),e.TgZ(18,"tbody"),e.YNc(19,Ie,7,3,"tr",2),e._UZ(20,"tr"),e.qZA(),e.TgZ(21,"tfoot")(22,"tr")(23,"td",34)(24,"b")(25,"small"),e._uU(26,"Total BTE Amount"),e.qZA()()(),e.TgZ(27,"td"),e._uU(28),e.qZA()()()(),e.TgZ(29,"div")(30,"mat-label"),e._uU(31,"Invoice Upload"),e.TgZ(32,"span",28),e._uU(33,"*"),e.qZA()(),e._UZ(34,"br"),e.TgZ(35,"input",36),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw();return e.KtG(o.onFileSelected(i,"other","bteInvoice"))}),e.qZA(),e._UZ(36,"br"),e.TgZ(37,"span",31)(38,"small"),e._uU(39,"Allowed File Types (.png, .jpg, .txt , .doc)"),e.qZA()(),e._UZ(40,"br"),e.TgZ(41,"span",31)(42,"small"),e._uU(43,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()()()()}if(2&a){const t=e.oxw();e.xp6(19),e.Q6J("ngForOf",t.BTESummary),e.xp6(9),e.Oqu(t.BTESummaryTotal),e.xp6(7),e.Q6J("accept",t.allowedTypesForHTML)}}let w=(()=>{class a{constructor(t,n){this._utilityService=t,this._snackBarService=n,this.loadingIndicator=!1,this._ngUnSubscribe=new D.x,this.expenseTabelDetails=[],this.showExpenseForm=!1,this.totalInviteesCount=0,this.showExpenseDeviation=!1,this._totalExpenseActualAmount=0,this._btcInvoiceFiles=[],this.panelSelectionFinalAmount=0,this.inviteesFinalAmount=0,this.expenseFinalAmount=0,this.totalBudget=0,this.advancedUtilized=0,this.advanceProvided=0,this.amountToPayForCompany=0,this.amountToPayForInitiator=0,this._inviteesActualAmount=0,this.BTESummary=[],this.BTCSummary=[],this.BTCSummaryTotal=0,this.BTESummaryTotal=0}ngOnInit(){this._getExpenseTypesForDropdown(),this._getExpense(),this._getInviteesExpenseData(),this.expenseForm=new r.cw({expenseType:new r.NI("",r.kI.required),expenseBTC:new r.NI("",r.kI.required),amountExcludingTax:new r.NI(0,r.kI.required),amountIncludingTax:new r.NI(0,r.kI.required),expenseDeviation:new r.NI("")}),this._allowedTypes=s.D.FILE.ALLOWED,this._allowedTypes.forEach(t=>{this.allowedTypesForHTML+="."+t+", "})}_getExpenseTypesForDropdown(){this._utilityService.getExpenseType().pipe((0,_.R)(this._ngUnSubscribe.asObservable())).subscribe(t=>this.expenseType=t)}_getExpense(){this._utilityService.expenseData.pipe((0,_.R)(this._ngUnSubscribe.asObservable())).subscribe(t=>{"eventSettlementExpense"==t.from&&(this.expenseTabelDetails=t.data,this.totalInviteesCount=t.totalInviteesCount,this._inviteeList=t.invitees,this.selectedEventId=t.eventId,this._filterBTEBTC(this.expenseTabelDetails,t.invitees),this._calculateOtherExpenseTotal())})}onAddExpenseRadioChange(t){this.showExpenseForm="Yes"==t}onExpenseAmountChanges(t){this.expenseForm.value.expenseType.toLowerCase().includes("food & beverages")&&(this.showExpenseDeviation=+(this.expenseForm.value.amountExcludingTax/this.totalInviteesCount).toFixed(2)>1500)}addToExpenseTable(){let t=0;this.expenseForm.value.amountExcludingTax>this.expenseForm.value.amountIncludingTax&&(this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.AMOUNT_INCLUDING_TAX,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),t++),this.expenseForm.invalid&&(this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILL_ALL,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),t++),this.showExpenseDeviation&&!Boolean(this._expenseDeviationFile)&&(this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_UPLOAD,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),t++),0==t&&(this.expenseTabelDetails.push({Amount:this.expenseForm.value.amountIncludingTax+"",Expense:this.expenseForm.value.expenseType+"",AmountExcludingTax:this.expenseForm.value.amountExcludingTax>0?"Yes":"No",BtcorBte:this.expenseForm.value.expenseBTC,actualExpense:this.expenseForm.value.amountIncludingTax,EventId:" ",BtcAmount:" ",BteAmount:" ",BudgetAmount:" "}),this._calculateTotalExpense(),this.expenseForm.reset(),this.showExpenseDeviation=!1,this.showExpenseForm=!1)}_calculateTotalExpense(){this._totalExpenseActualAmount=0,this.expenseTabelDetails.forEach(t=>this._totalExpenseActualAmount+=+t.actualExpense),this._calculateAdvanceTableDetails()}onExpenseAmountActualAmountChanges(t,n){this._totalExpenseActualAmount=0,n.actualExpense=t,this._calculateTotalExpense()}onFileSelected(t,n,i){const o=t.target.files[0];if(t.target.files.length>0)if(o.size>=s.D.FILE.MIN_SIZE&&o.size<s.D.FILE.MAX_SIZE){const d=o.name.split(".")[1],c=new FileReader;this._allowedTypes.indexOf(d)>-1?(c.readAsDataURL(o),c.onloadend=()=>{const u=c.result;"deviation"==n&&"expenseDeviation"==i&&(this._expenseDeviationFile=o.name+":"+u.split(",")[1]),"other"==n&&("btcInvoice"==i&&(this._btcInvoiceFiles.push(o.name+":"+u.split(",")[1]),this._sendPayloadData()),"bteInvoice"==i&&(this._bteInvoiceFile=o.name+":"+u.split(",")[1],this._sendPayloadData()))}):(this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_TYPE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),this._resetControl(i))}else this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_SIZE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),this._resetControl(i)}_resetControl(t){"expenseDeviation"===t&&this.expenseForm.controls.expenseDeviation.reset()}_calculateOtherExpenseTotal(){this.totalBudget=0,this.advancedUtilized=0,this.panelSelectionFinalAmount=0,this.inviteesFinalAmount=0,this.expenseFinalAmount=0,this.loadingIndicator=!0,this._utilityService.getPanelSelectionFinalAmount(this.selectedEventId).pipe((0,_.R)(this._ngUnSubscribe.asObservable())).subscribe(t=>{this.loadingIndicator=!1,Boolean(t)&&(this.panelSelectionFinalAmount=+t,this.totalBudget+=this.panelSelectionFinalAmount,this.advancedUtilized+=this.panelSelectionFinalAmount)},t=>{this.loadingIndicator=!1,this.panelSelectionFinalAmount=0,this.totalBudget+=this.panelSelectionFinalAmount,this.advancedUtilized+=this.panelSelectionFinalAmount,this._calculateTotalExpense()}),this.expenseTabelDetails.forEach(t=>this.expenseFinalAmount+=+t.Amount),this._inviteeList.forEach(t=>this.inviteesFinalAmount+=+t.LcAmount),this.totalBudget=this.inviteesFinalAmount+this.expenseFinalAmount,this.advancedUtilized=this.inviteesFinalAmount+this.expenseFinalAmount,this._inviteesActualAmount=this.inviteesFinalAmount}_getInviteesExpenseData(){this._utilityService.advanceData.subscribe(t=>{"actualCalculation"==t.for&&"inviteeSummary"==t.from&&(this._inviteesActualAmount=t.actualInviteeAmount,this._calculateTotalExpense())})}_calculateAdvanceTableDetails(){this.advancedUtilized=this._totalExpenseActualAmount+this._inviteesActualAmount+this.panelSelectionFinalAmount,this.totalBudget<this.advancedUtilized&&(this.amountToPayForCompany=0,this.amountToPayForInitiator=this.advancedUtilized-this.totalBudget),this.totalBudget>this.advancedUtilized&&(this.amountToPayForInitiator=0,this.amountToPayForCompany=this.totalBudget-this.advancedUtilized),this.totalBudget==this.advancedUtilized&&(this.amountToPayForCompany=0,this.amountToPayForInitiator=0),this._sendPayloadData()}_filterBTEBTC(t,n){this.BTESummary=[],this.BTCSummary=[],this.BTCSummaryTotal=0,this.BTESummaryTotal=0,t.forEach(i=>{if("BTC"==i.BtcorBte){let o={expense:i.Expense,amount:+i.Amount,invoiceFile:""};this.BTCSummaryTotal+=o.amount,this.BTCSummary.push(o)}else if("BTE"==i.BtcorBte){let o={expense:i.Expense,amount:+i.Amount};this.BTESummaryTotal+=o.amount,this.BTESummary.push(o)}}),n.forEach(i=>{if("BTC"==i.BtcorBte.trim()){let o={expense:"Local Conveyance",amount:+i.LcAmount,invoiceFile:""};this.BTCSummaryTotal+=o.amount,this.BTCSummary.push(o)}else if("BTE"==i.BtcorBte.trim()){let o={expense:"Local Conveyance",amount:+i.LcAmount};this.BTESummaryTotal+=o.amount,this.BTESummary.push(o)}})}_sendPayloadData(){this._utilityService.sendData({from:"expenseSummary",for:"apiPayload",expenseDetails:this.expenseTabelDetails,totalExpenseCount:this.expenseTabelDetails.length,panelTotalAmount:this.panelSelectionFinalAmount,inviteeTotalAmount:this.inviteesFinalAmount,expenseTotalAmount:this.expenseFinalAmount,advanceProvided:this.BTESummaryTotal,advanceUtilized:this.advancedUtilized,paybackToCompany:this.amountToPayForCompany,paybackToInitiator:this.amountToPayForInitiator,btcSummaryCount:this.BTCSummary.length,btcInvoiceFiles:this._btcInvoiceFiles,bteInvoiceFile:this._bteInvoiceFile,bteSummaryCount:this.BTESummary.length})}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(g.t),e.Y36(S.c))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-post-event-settlement-expense-summary"]],decls:115,vars:18,consts:[[1,"container","table-responsive"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"contianer"],[1,"row"],[1,"col"],[3,"ngModelOptions","ngModel","ngModelChange"],["value","Yes",1,"m-2"],["value","No",1,"m-2"],[3,"formGroup",4,"ngIf"],["class","container table-responsive",4,"ngIf"],[1,"col","text-danger"],[3,"isLoading"],["scope","row"],["type","number",3,"ngModelOptions","ngModel","ngModelChange"],[3,"formGroup"],["color","accent","appearance","outline"],["formControlName","expenseType"],[3,"value",4,"ngFor","ngForOf"],["type","number","matInput","","placeholder","Enter Expense amount","formControlName","amountExcludingTax",3,"input"],["formControlName","expenseBTC"],["value","BTC",1,"m-2"],["value","BTE",1,"m-2"],["type","number","matInput","","placeholder","Enter Expense amount","formControlName","amountIncludingTax"],["class","row",4,"ngIf"],[1,"col-12","d-flex","justify-content-center","align-items-center"],["type","button",1,"btn","btn-primary","btn-sm",3,"click"],[3,"value"],[2,"color","red"],[1,"m-2"],["type","file","formControlName","expenseDeviation",3,"accept","change"],[1,"text-danger"],[1,"col","d-flex","justify-content-center","text-danger"],[1,"table","text-center","table-bordered"],["colspan","2",1,"text-right"],["type","file",3,"accept","ngModelOptions","ngModel","change","ngModelChange"],["type","file",3,"accept","change"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"table",1)(2,"thead")(3,"tr")(4,"th")(5,"b")(6,"small"),e._uU(7,"S.no"),e.qZA()()(),e.TgZ(8,"th")(9,"b")(10,"small"),e._uU(11,"Expense Type"),e.qZA()()(),e.TgZ(12,"th")(13,"b")(14,"small"),e._uU(15,"BTE/BTC"),e.qZA()()(),e.TgZ(16,"th")(17,"b")(18,"small"),e._uU(19,"Budget Amount Including Tax"),e.qZA()()(),e.TgZ(20,"th")(21,"b")(22,"small"),e._uU(23,"Actual Amount"),e.qZA()()()()(),e.TgZ(24,"tbody"),e.YNc(25,Ce,11,7,"tr",2),e.qZA()()(),e.TgZ(26,"div",3)(27,"div",4)(28,"div",5)(29,"mat-label")(30,"b"),e._uU(31,"Do you want to add new Expense?"),e.qZA()(),e.TgZ(32,"mat-radio-group",6),e.NdJ("ngModelChange",function(o){return n.onAddExpenseRadioChange(o)})("ngModelChange",function(o){return n.addExpenseRadio=o}),e.TgZ(33,"div")(34,"mat-radio-button",7)(35,"small"),e._uU(36,"Yes"),e.qZA()(),e.TgZ(37,"mat-radio-button",8)(38,"small"),e._uU(39,"No"),e.qZA()()()()()(),e.YNc(40,be,34,3,"form",9),e.qZA(),e.YNc(41,De,36,2,"div",10),e.YNc(42,Fe,44,3,"div",10),e._UZ(43,"app-post-event-settlement-other-deviation"),e.TgZ(44,"div",0)(45,"div",11)(46,"h4")(47,"b"),e._uU(48,"Total Expense Details"),e.qZA()()(),e.TgZ(49,"table",1)(50,"thead")(51,"tr")(52,"th")(53,"small"),e._uU(54,"Event ID"),e.qZA()(),e.TgZ(55,"th")(56,"small"),e._uU(57,"Total Honorarium"),e.qZA()(),e.TgZ(58,"th")(59,"small"),e._uU(60,"Total Invitees Local Conveyance Amount"),e.qZA()(),e.TgZ(61,"th")(62,"small"),e._uU(63,"Other Expense"),e.qZA()(),e.TgZ(64,"th")(65,"small"),e._uU(66,"Total Budget For the Event"),e.qZA()()()(),e.TgZ(67,"tbody")(68,"tr")(69,"th"),e._uU(70),e.qZA(),e.TgZ(71,"td"),e._uU(72),e.qZA(),e.TgZ(73,"td"),e._uU(74),e.qZA(),e.TgZ(75,"td"),e._uU(76),e.qZA(),e.TgZ(77,"td"),e._uU(78),e.qZA()()()()(),e.TgZ(79,"div",0)(80,"div",11)(81,"h4")(82,"b"),e._uU(83,"Advance Details"),e.qZA()()(),e.TgZ(84,"table",1)(85,"thead")(86,"tr")(87,"th")(88,"small"),e._uU(89,"Event ID"),e.qZA()(),e.TgZ(90,"th")(91,"small"),e._uU(92,"Advance Provided"),e.qZA()(),e.TgZ(93,"th")(94,"small"),e._uU(95,"Actual Expense"),e.qZA()(),e.TgZ(96,"th")(97,"small"),e._uU(98,"Pay back amount to Company"),e.qZA()(),e.TgZ(99,"th")(100,"small"),e._uU(101,"Additional Amount needed to pay for Initiator"),e.qZA()()()(),e.TgZ(102,"tbody")(103,"tr")(104,"th"),e._uU(105),e.qZA(),e.TgZ(106,"td"),e._uU(107),e.qZA(),e.TgZ(108,"td"),e._uU(109),e.qZA(),e.TgZ(110,"td"),e._uU(111),e.qZA(),e.TgZ(112,"td"),e._uU(113),e.qZA()()()()(),e._UZ(114,"app-spinner-loader",12)),2&t&&(e.xp6(25),e.Q6J("ngForOf",n.expenseTabelDetails),e.xp6(7),e.Q6J("ngModelOptions",e.DdM(17,F))("ngModel",n.addExpenseRadio),e.xp6(8),e.Q6J("ngIf",n.showExpenseForm),e.xp6(1),e.Q6J("ngIf",n.BTCSummary.length>0),e.xp6(1),e.Q6J("ngIf",n.BTESummary.length>0),e.xp6(28),e.Oqu(n.selectedEventId),e.xp6(2),e.Oqu(n.panelSelectionFinalAmount),e.xp6(2),e.Oqu(n.inviteesFinalAmount),e.xp6(2),e.Oqu(n.expenseFinalAmount),e.xp6(2),e.Oqu(n.totalBudget),e.xp6(27),e.Oqu(n.selectedEventId),e.xp6(2),e.Oqu(n.BTESummaryTotal),e.xp6(2),e.Oqu(n.advancedUtilized),e.xp6(2),e.Oqu(n.amountToPayForCompany),e.xp6(2),e.Oqu(n.amountToPayForInitiator),e.xp6(1),e.Q6J("isLoading",n.loadingIndicator))},dependencies:[h.sg,h.O5,r._Y,r.Fj,r.wV,r.JJ,r.JL,r.On,r.sg,r.u,p.KE,p.hX,I.Nt,A.gD,E.ey,x.VQ,x.U0,f.r,fe],styles:["table.table-bordered[_ngcontent-%COMP%]    > thead[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%] {\r\n    border:1px solid black;\r\n  }\r\n  table.table-bordered[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\r\n    border:1px solid rgb(209, 162, 162);\r\n  }\r\n  table.table-striped[_ngcontent-%COMP%]    > thead[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%] {\r\n    border:1px solid black;\r\n  }\r\n  table.table-striped[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\r\n    border:1px solid rgb(209, 162, 162);\r\n  }"]}),a})();function Ue(a,l){if(1&a&&(e.TgZ(0,"tbody")(1,"tr")(2,"th",17),e._uU(3),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.qZA(),e.TgZ(10,"td"),e._uU(11),e.qZA(),e.TgZ(12,"td"),e._uU(13),e.qZA()()()),2&a){const t=l.$implicit,n=l.index;e.xp6(3),e.Oqu(n+1),e.xp6(2),e.Oqu(t["EventId/EventRequestId"]),e.xp6(2),e.Oqu(t["Event Topic"]),e.xp6(2),e.Oqu(t.EventType),e.xp6(2),e.Oqu(t.VenueName),e.xp6(2),e.Oqu(t.EventDate)}}function Be(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",18)(1,"form",19)(2,"mat-label")(3,"b"),e._uU(4,"Upload Deviation"),e.TgZ(5,"span",20),e._uU(6,"*"),e.qZA()()(),e._UZ(7,"br"),e.TgZ(8,"div",21)(9,"input",22),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw(2);return e.KtG(o.onFileSelected(i,"deviation","thirtyDaysUpload"))}),e.qZA(),e._UZ(10,"br"),e.TgZ(11,"span",23)(12,"small"),e._uU(13,"Allowed File Types (.png, .jpg, .txt , .doc)"),e.qZA()(),e._UZ(14,"br"),e.TgZ(15,"span",23)(16,"small"),e._uU(17,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()()()()()}if(2&a){const t=e.oxw(2);e.xp6(1),e.Q6J("formGroup",t.deviationForm),e.xp6(8),e.Q6J("accept",t.allowedTypesForHTML)}}function qe(a,l){if(1&a&&(e.TgZ(0,"mat-option",27),e._uU(1),e.qZA()),2&a){const t=l.$implicit;e.s9C("value",t["EventId/EventRequestId"]),e.xp6(1),e.Oqu(t["EventId/EventRequestId"])}}const Me=function(){return{standalone:!0}};function Pe(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"mat-form-field",24)(1,"mat-label"),e._uU(2,"Select Event ID"),e.qZA(),e.TgZ(3,"mat-select",25),e.NdJ("ngModelChange",function(i){e.CHM(t);const o=e.oxw(2);return e.KtG(o.onEventSelect(i))})("ngModelChange",function(i){e.CHM(t);const o=e.oxw(2);return e.KtG(o.selectedEvent=i)}),e.YNc(4,qe,2,2,"mat-option",26),e.qZA()()}if(2&a){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModelOptions",e.DdM(3,Me))("ngModel",t.selectedEvent),e.xp6(1),e.Q6J("ngForOf",t.after30DaysList)}}function Re(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",28)(1,"div",29)(2,"h4")(3,"b"),e._uU(4,"Invitees Participation"),e.qZA(),e._uU(5," ("),e.TgZ(6,"button",30),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.openAddInviteeModal())}),e._uU(7,"Add Invitee"),e.qZA(),e._uU(8,")"),e.qZA()(),e._UZ(9,"app-post-event-settlement-invitees-summary"),e.TgZ(10,"div",29)(11,"h4")(12,"b"),e._uU(13,"Expense Details"),e.qZA()()(),e._UZ(14,"app-post-event-settlement-expense-summary"),e.TgZ(15,"div",31)(16,"button",32),e._uU(17,"Reset"),e.qZA(),e.TgZ(18,"button",33),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.postEventSubmit())}),e._uU(19,"Submit"),e.qZA()()()}}function Oe(a,l){if(1&a&&(e.TgZ(0,"div",9)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",9)(5,"div",2)(6,"div",10)(7,"table",11)(8,"thead")(9,"tr")(10,"th")(11,"small"),e._uU(12,"S.no"),e.qZA()(),e.TgZ(13,"th")(14,"small"),e._uU(15,"Event ID"),e.qZA()(),e.TgZ(16,"th")(17,"small"),e._uU(18,"Event Name"),e.qZA()(),e.TgZ(19,"th")(20,"small"),e._uU(21,"Event Type"),e.qZA()(),e.TgZ(22,"th")(23,"small"),e._uU(24,"Venue"),e.qZA()(),e.TgZ(25,"th")(26,"small"),e._uU(27,"Event Date"),e.qZA()()()(),e.YNc(28,Ue,14,6,"tbody",12),e.qZA()(),e.YNc(29,Be,18,2,"div",13),e.TgZ(30,"div",14),e.YNc(31,Pe,5,4,"mat-form-field",15),e.qZA(),e.YNc(32,Re,20,0,"div",16),e.qZA()()()()()()),2&a){const t=e.oxw();e.xp6(28),e.Q6J("ngForOf",t.after30DaysList),e.xp6(1),e.Q6J("ngIf",t.show30DaysUpload),e.xp6(2),e.Q6J("ngIf",t.showEventSelect),e.xp6(1),e.Q6J("ngIf",t.showPostEventContent)}}function we(a,l){1&a&&(e.TgZ(0,"div",9)(1,"span",23),e._uU(2,"Sorry, this event type has no events for Event Settlement submission"),e.qZA()())}let Ne=(()=>{class a{constructor(t,n,i,o,d,c){this.utilityService=t,this.activatedRoute=n,this._dialog=i,this._snackBarService=o,this._router=d,this._authService=c,this.loadingIndicator=!1,this.isUploadShows=!1,this.isUploadGST=!1,this.show30DaysUpload=!1,this.inviteeTableIsPresentCheckBox=[],this.totalAttendance=0,this.showInviteeDeviation=!1,this.showEventSelect=!1,this.showPostEventContent=!1,this.inviteeTableDetails=[],this.expenseTabelDetails=[],this.expenseTableDetailCopy=[],this.inviteeTableDetailsCopy=[],this.amountTableFinalAmount=0,this.advancedUtilized=0,this.amountToPayForInitiator=0,this.amountToPayForCompany=0,this.showGstTextBox=!1,this.showNoData=!1,this.expenseTableActualAmountInput=[],this.changedExpenseActualAmount=0,this.changesExpenseTableExpenses=[],this.changedInviteeLC=0,this.changedInviteeExpenses=[],this.showAddExpense=!1,this.expenseTabelDetails2=[],this.after30DaysList=[],this.deviationFiles=[],this.otherFiles=[],this._otherFiles=[],this.totalExpenseCount=0,this._btcSummaryCount=0,this._bteSummaryCount=0,this._btcInvoiceFiles=[]}ngOnInit(){this._authService.getUserDetails$.subscribe(t=>this._userDetails=t),this._getPayloadData(),this.utilityService.getInviteesFast().subscribe(t=>{this.invitees=t}),this.utilityService.getExpenseType().subscribe(t=>this.expenseType=t),this.utilityService.getPostEventExpense().subscribe(t=>{this.expense=t}),this.activatedRoute.queryParams.subscribe(t=>{t.eventId&&t.eventType?(this.loadingIndicator=!0,this.utilityService.getInviteesFast().subscribe(n=>{this.invitees=n,this.utilityService.getPostEventExpense().subscribe(i=>{this.expense=i,this.utilityService.getEventListFromProcess().subscribe(o=>{this.allEventList=o,this.after30DaysList.push(o.find(d=>d["EventId/EventRequestId"]==t.eventId)),this.show30DaysUpload=this.isAfter30Days(this.after30DaysList[0].EventDate),this.loadingIndicator=!1,this.onEventSelect(t.eventId)})})})):(this.showEventSelect=!0,this.loadingIndicator=!0,this.utilityService.getEventListFromProcess().subscribe(n=>{this.loadingIndicator=!1,this.allEventList=n,this.after30Days(this.allEventList)}))}),this.uploadForm=new r.cw({attendanceUpload:new r.NI(""),inviteeDeviation:new r.NI("")}),this.deviationForm=new r.cw({thirtyDaysUpload:new r.NI("")}),this.addExpenseForm=new r.cw({expenseType:new r.NI("",r.kI.required),expenseAmountWithoutGST:new r.NI(0),gstAmount:new r.NI(0),expenseBTC:new r.NI("",r.kI.required)}),this.addExpenseFormPrePopulate(),this._allowedTypes=s.D.FILE.ALLOWED,this._allowedTypes.forEach(t=>{this.allowedTypesForHTML+="."+t+", "})}inviteePresent(t){t?this.totalAttendance++:this.totalAttendance--,this.showInviteeDeviation=this.totalAttendance<5}onExpenseActualAmountChanges(t,n){this.advancedUtilized=0!==this.changedInviteeLC?this.changedInviteeLC:this.amountTableFinalAmount;let i=this.changesExpenseTableExpenses.find(o=>o.index==n);i?i.amount=t:this.changesExpenseTableExpenses.push({index:n,amount:t});for(let o=0;o<this.changesExpenseTableExpenses.length;o++)this.advancedUtilized-=this.expenseTabelDetails[o].Amount,this.advancedUtilized+=this.changesExpenseTableExpenses[o].amount;this.changedExpenseActualAmount=this.advancedUtilized,this.calculateAdvanceTableDetails()}onInviteeLcAmountChanges(t,n){this.advancedUtilized=0!==this.changedExpenseActualAmount?this.changedExpenseActualAmount:this.amountTableFinalAmount;let i=this.changedInviteeExpenses.find(o=>o.index==n);i?i.amount=t:this.changedInviteeExpenses.push({index:n,amount:t});for(let o=0;o<this.changedInviteeExpenses.length;o++)this.advancedUtilized-=this.inviteeTableDetails[o].LcAmount,this.advancedUtilized+=this.changedInviteeExpenses[o].amount;this.changedInviteeLC=this.advancedUtilized,this.calculateAdvanceTableDetails()}onEventSelect(t){this.selectedEventId=t,this.inviteeTableDetails=[],this.expenseTabelDetails=[],this.inviteeTableDetailsCopy=[],this.expenseTableDetailCopy=[],this.amountTableFinalAmount=0,this.advancedUtilized=0,this.amountToPayForCompany=0,this.amountToPayForInitiator=0,this.panelSelectionFinalAmount=0,this.expenseFinalAmount=0,this.inviteesFinalAmount=0,this.selectedEventDetails=this.allEventList.find(n=>n["EventId/EventRequestId"]==t),Boolean(this.invitees)&&this.invitees.forEach(n=>{n["EventId/EventRequestId"]==t&&this.inviteeTableDetails.push({EventIdOrEventRequestId:n["EventId/EventRequestId"],INV:n.INV||" ",InviteeName:n.HCPName||" ",MisCode:n.MISCode+" ",LocalConveyance:n.LocalConveyance||"0",BtcorBte:n["BTC/BTE"]+" "||0,LcAmount:n.LcAmount+" "||0,actualExpense:n.LcAmount,inviteeSource:n["Invitee Source"],isPresent:!1,speciality:n.Speciality||" ",hcpType:n["HCP Type"]||" "})}),Boolean(this.expense)&&this.expense.forEach(n=>{n["EventId/EventRequestID"]==t&&this.expenseTabelDetails.push({Amount:n.Amount+"",Expense:n.Expense+"",AmountExcludingTax:n["AmountExcludingTax?"],BtcorBte:n["BTC/BTE"],actualExpense:n.Amount,EventId:" ",BtcAmount:" ",BteAmount:" ",BudgetAmount:" "})}),this.inviteeTableDetails.length>0||this.expenseTabelDetails.length>0?(this.showPostEventContent=!0,this._sendExpense(this.expenseTabelDetails),this._sendInvitees(this.inviteeTableDetails)):(this.showPostEventContent=!1,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.NO_DATA,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR))}onAddExpenseRadioChange(t){this.showAddExpense="Yes"==t}addExpenseFormPrePopulate(){this.addExpenseForm.valueChanges.subscribe(t=>{Boolean(t.expenseType)&&(this.showGstTextBox=t.expenseType.indexOf("Food & Beverages")>-1||"Honorarium"==t.expenseType)})}addToExpenseTable(){if(this.addExpenseForm.valid&&this.addExpenseForm.value.expenseAmountWithoutGST>0){const t={Amount:this.addExpenseForm.value.expenseAmountWithoutGST+this.addExpenseForm.value.gstAmount+" ",Expense:this.addExpenseForm.value.expenseType||" ",AmountExcludingTax:this.addExpenseForm.value.gstAmount>0?"No":"Yes",BtcorBte:this.addExpenseForm.value.expenseBTC||" ",actualExpense:this.addExpenseForm.value.expenseAmountWithoutGST+this.addExpenseForm.value.gstAmount+0,EventId:" ",BtcAmount:" ",BteAmount:" ",BudgetAmount:" "};this.amountTableFinalAmount+=+t.Amount,this.advancedUtilized+=t.actualExpense,this.expenseTabelDetails2.push(t),this.calculateAdvanceTableDetails(),this.addExpenseForm.reset(),this.addExpenseForm.controls.expenseAmountWithoutGST.setValue(0),this.addExpenseForm.controls.gstAmount.setValue(0)}else this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILL_ALL,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)}after30Days(t){Boolean(t)&&t.forEach(n=>{"Class I"==n.EventType&&n["Initiator Email"]==this._userDetails.email&&"Honorarium approved"==n["Honorarium Request Status"]&&Boolean(n.EventDate)&&(this.after30DaysList.push(n),this.show30DaysUpload=this.isAfter30Days(n.EventDate))}),this.after30DaysList.length>0||(this.show30DaysUpload=!1,this.showNoData=!0,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.NO_DATA,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR))}isAfter30Days(t){let n=new Date,o=new Date(t).getTime()-n.getTime();return Math.round(o/864e5)<-30}calculateAdvanceIfNoChange(){this.advancedUtilized=this.amountTableFinalAmount,this.amountToPayForCompany=0,this.amountToPayForInitiator=0}calculateAdvanceTableDetails(){this.amountTableFinalAmount<this.advancedUtilized&&(this.amountToPayForCompany=0,this.amountToPayForInitiator=this.advancedUtilized-this.amountTableFinalAmount),this.amountTableFinalAmount>this.advancedUtilized&&(this.amountToPayForInitiator=0,this.amountToPayForCompany=this.amountTableFinalAmount-this.advancedUtilized),this.amountTableFinalAmount==this.advancedUtilized&&(this.amountToPayForCompany=0,this.amountToPayForInitiator=0)}onFileSelected(t,n,i){const o=t.target.files[0];if(t.target.files.length>0)if(o.size>=s.D.FILE.MIN_SIZE&&o.size<s.D.FILE.MAX_SIZE){const d=o.name.split(".")[1],c=new FileReader;this._allowedTypes.indexOf(d)>-1?(c.readAsDataURL(o),c.onloadend=()=>{const u=c.result;"deviation"==n&&("thirtyDaysUpload"==i&&(this.thirtyDaysUploadFile="30DaysDeviationFile"+d+":"+u.split(",")[1]),"inviteeDeviation"==i&&(this.inviteeDeviationFile=u.split(",")[1])),"other"==n&&("attendanceUpload"==i&&(this.attendanceUploadFile=u.split(",")[1]),"invoiceUpload"==i&&(this.invoiceUploadFile=u.split(",")[1]))}):(this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_TYPE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),this._resetControl(i))}else this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_SIZE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),this._resetControl(i)}_resetControl(t){switch(t){case"thirtyDaysUpload":this.deviationForm.controls.thirtyDaysUpload.reset();break;case"attendanceUpload":this.uploadForm.controls.attendanceUpload.reset();break;case"inviteeDeviation":this.uploadForm.controls.inviteeDeviation.reset()}}postEventSubmit(){let t=0;if(this.show30DaysUpload&&!Boolean(this.deviationForm.value.thirtyDaysUpload)&&(t++,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_UPLOAD,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)),this.totalAttendance>0&&this.totalAttendance<5&&!Boolean(this.inviteeDeviationFile)&&(t++,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_UPLOAD,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)),this._btcInvoiceFiles.length<this._btcSummaryCount&&(t++,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_UPLOAD,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)),this._bteSummaryCount>0&&!Boolean(this._bteInvoiceFile)&&(t++,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_UPLOAD,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)),0==t){this.loadingIndicator=!0,Boolean(this.thirtyDaysUploadFile)&&this.deviationFiles.push(this.thirtyDaysUploadFile),Boolean(this.inviteeDeviationFile)&&this.deviationFiles.push(this.inviteeDeviationFile),this._btcInvoiceFiles.length>0&&this._btcInvoiceFiles.forEach(o=>this._otherFiles.push(o)),Boolean(this._bteInvoiceFile)&&this._otherFiles.push(this._bteInvoiceFile);let n=this._authService.decodeToken();const i={Invitee:this.inviteeTableDetails,ExpenseSheets:this.expenseTabelDetails,EventId:this.selectedEventDetails["EventId/EventRequestId"],EventTopic:this.selectedEventDetails["Event Topic"],EventType:this.selectedEventDetails.EventType,EventDate:this.selectedEventDetails.EventDate,StartTime:this.selectedEventDetails.StartTime,InitiatorName:this.selectedEventDetails.InitiatorName||n.unique_name,EndTime:this.selectedEventDetails.EndTime,VenueName:this.selectedEventDetails.VenueName||" ",State:this.selectedEventDetails.State||" ",City:this.selectedEventDetails.City||" ",Attended:this.totalAttendance+"",InviteesParticipated:this.inviteeTableDetails.length+"",ExpenseParticipated:this.expenseTabelDetails.length+"",TotalExpense:`Total Panel Selection Final Amount: ${this.panelSelectionFinalAmount} | Total Invitees Final Amount : ${this.inviteesFinalAmount} | Total Expense :${this.expenseFinalAmount} | Total Budget For The Event : ${this.amountTableFinalAmount}`,Advance:`Advance Provided : ${this.amountTableFinalAmount} | Advance Utilized For Event : ${this.advancedUtilized} | Pay Back Amount To Company  : ${this.amountToPayForCompany} | Additional Amount Needed To Pay For Initiator : ${this.amountToPayForInitiator}`,Brands:this.selectedEventDetails.Brands,SlideKits:this.selectedEventDetails.SlideKits,Panalists:this.selectedEventDetails.Panelists,InitiatorEmail:n.email||" ",RbMorBM:n.RBM_BM||" ",SalesHead:n.SalesHead||" ",MarkeringHead:n.MarketingHead||" ",Compliance:n.ComplianceHead||"sabri.s@vsaasglobal.com",FinanceAccounts:n.FinanceAccounts||" ",FinanceTreasury:n.FinanceTreasury||" ",MedicalAffairsHead:n.MedicalAffairsHead||"sabri.s@vsaasglobal.com",FinanceHead:n.FinanceAccounts||"sabri.s@vsaasglobal.com",EventOpen30Days:this.show30DaysUpload?"Yes":"No",EventLessThan5Days:this.showInviteeDeviation?"Yes":"No",PostEventSubmitted:"Yes",IsAdvanceRequired:this.selectedEventDetails.IsAdvanceRequired||"No",TotalInvitees:this.inviteeTableDetails.length+""||"0",TotalAttendees:this.totalAttendance+""||"0",TotalTravelAndAccomodationSpend:this.selectedEventDetails["Total Travel & Accommodation Amount"]+""||"0",TotalHonorariumSpend:this.selectedEventDetails["Total Honorarium Amount"]+""||"0",TotalSpend:this.selectedEventDetails["Total Budget"]+""||"0",TotalLocalConveyance:this.selectedEventDetails["Total Local Conveyance"]+""||"0",TotalTravelSpend:this.selectedEventDetails["Total Travel Amount"]+""||"0",TotalAccomodationSpend:this.selectedEventDetails["Total Accomodation Amount"]+""||"0",TotalExpenses:this.selectedEventDetails["Total Expense"]+""||"0",TotalActuals:this.advancedUtilized+"",AdvanceUtilizedForEvents:this.advancedUtilized+"",PayBackAmountToCompany:this.amountToPayForCompany+"",AdditionalAmountNeededToPayForInitiator:this.amountToPayForInitiator+"",IsDeviationUpload:Boolean(this.inviteeDeviationFile)?"Yes":"No",DeviationFiles:this.deviationFiles,Files:this._otherFiles,MedicalAffairsEmail:n.MedicalAffairsHead,ReportingManagerEmail:n.reportingmanager,FirstLevelEmail:n.firstLevelManager,ComplianceEmail:n.ComplianceHead,FinanceAccountsEmail:n.FinanceAccounts,SalesCoordinatorEmail:n.SalesCoordinator,Role:n.role};this.utilityService.postEventSettlementDetails(i).subscribe(o=>{"Data added successfully."==o.message&&(this.loadingIndicator=!1,this._snackBarService.showSnackBar(s.D.MESSAGE.SUCCESS.ADD_POST_SETTLEMENT,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.SUCCESS),this.showPostEventContent=!1,this._router.navigate(["view-event-list"]))},o=>{this.loadingIndicator=!1,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.SERVER_ERR,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)}),console.log(i)}}openAddInviteeModal(){this._dialog.open(R,{width:"80%",data:{eventId:this.selectedEventDetails["EventId/EventRequestId"]}}).afterClosed().subscribe(n=>{this.reloadInvitees()})}openDeleteInviteeConfirmationModal(t){this._dialog.open(M,{width:"300px"}).afterClosed().subscribe(i=>{i&&this.deleteInvitee(t)})}deleteInvitee(t){this.loadingIndicator=!0,this.utilityService.deleteInvitees(t.INV).subscribe(n=>{this.loadingIndicator=!1,this._snackBarService.showSnackBar(s.D.MESSAGE.SUCCESS.DELETE_INVITEE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.SUCCESS),this.reloadInvitees()})}reloadInvitees(){this.loadingIndicator=!0,this.utilityService.getInviteesFast().subscribe(t=>{this.invitees=t,this.onEventSelect(this.selectedEventDetails["EventId/EventRequestId"]),this.loadingIndicator=!1})}_sendInvitees(t){this.utilityService.sendData({from:"eventSettlementInvitees",data:t,eventId:this.selectedEventId})}_sendExpense(t){this.utilityService.sendExpenseData({from:"eventSettlementExpense",data:t,invitees:this.inviteeTableDetails,eventId:this.selectedEventId,eventType:this.selectedEventDetails.EventType,totalInviteesCount:this.inviteeTableDetails.length})}_getPayloadData(){this.utilityService.data.subscribe(t=>{"inviteeSummary"==t.from&&"apiPayload"==t.for&&(this.totalAttendance=t.attendedInviteesCount,Boolean(t.attendanceDeviation)&&(this.inviteeDeviationFile=t.attendanceDeviation)),"expenseSummary"==t.from&&"apiPayload"==t.for&&(this.expenseTabelDetails=t.expenseDetails,this.panelSelectionFinalAmount=t.panelTotalAmount,this.inviteesFinalAmount=t.inviteeTotalAmount,this.expenseFinalAmount=t.expenseTotalAmount,this.amountTableFinalAmount=t.advanceProvided,this.advancedUtilized=t.advanceUtilized,this.amountToPayForInitiator=t.paybackToInitiator,this.amountToPayForCompany=t.paybackToCompany,this._btcSummaryCount=t.btcSummaryCount,this._btcInvoiceFiles=t.btcInvoiceFiles,this._bteInvoiceFile=t.bteInvoiceFile,this._bteSummaryCount=t.bteSummaryCount)})}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(g.t),e.Y36(v.gz),e.Y36(T.uw),e.Y36(S.c),e.Y36(v.F0),e.Y36(C.e))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-class1-post-event-settlement"]],decls:11,vars:3,consts:[[1,"main-content"],[1,"container-fluid"],[1,"row"],[1,"col-md-12"],[1,"card"],[1,"card-header","card-header-danger"],[1,"card-title"],["class","card-body",4,"ngIf"],[3,"isLoading"],[1,"card-body"],[1,"container","table-responsive"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],["class","col mt-2",4,"ngIf"],[1,"col-6"],["color","accent","appearance","outline",4,"ngIf"],["class","container",4,"ngIf"],["scope","row"],[1,"col","mt-2"],[3,"formGroup"],[2,"color","red"],[1,"m-2"],["type","file","id","thirtyDaysUpload","formControlName","thirtyDaysUpload",3,"accept","change"],[1,"text-danger"],["color","accent","appearance","outline"],[3,"ngModelOptions","ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"container"],[1,"col","text-danger"],["mat-button","",3,"click"],[1,"col-12","d-flex","justify-content-center"],[1,"btn","btn-primary","btn-sm"],[1,"btn","btn-success","btn-sm",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h4",6),e._uU(7,"Post Event Settlement request"),e.qZA()(),e.YNc(8,Oe,33,4,"div",7),e.YNc(9,we,3,0,"div",7),e.qZA()()()()(),e._UZ(10,"app-spinner-loader",8)),2&t&&(e.xp6(8),e.Q6J("ngIf",!n.showNoData),e.xp6(1),e.Q6J("ngIf",n.showNoData),e.xp6(1),e.Q6J("isLoading",n.loadingIndicator))},dependencies:[h.sg,h.O5,r._Y,r.Fj,r.JJ,r.JL,r.On,r.sg,r.u,y.lW,p.KE,p.hX,A.gD,E.ey,f.r,O,w]}),a})();function Le(a,l){if(1&a&&(e.TgZ(0,"tr")(1,"td",17),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA()()),2&a){const t=l.$implicit,n=l.index;e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(t["EventId/EventRequestId"]),e.xp6(2),e.Oqu(t["Event Topic"]),e.xp6(2),e.Oqu(t.EventType),e.xp6(2),e.Oqu(t.VenueName||"NA"),e.xp6(2),e.Oqu(t.EventDate)}}function ke(a,l){if(1&a&&(e.TgZ(0,"mat-option",21),e._uU(1),e.qZA()),2&a){const t=l.$implicit;e.s9C("value",t["EventId/EventRequestId"]),e.xp6(1),e.hij("",t["EventId/EventRequestId"]," ")}}const Z=function(){return{standalone:!0}};function He(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"mat-form-field",18)(1,"mat-label"),e._uU(2,"Select Event ID"),e.qZA(),e.TgZ(3,"mat-select",19),e.NdJ("ngModelChange",function(i){e.CHM(t);const o=e.oxw(2);return e.KtG(o.onEventSelect(i))})("ngModelChange",function(i){e.CHM(t);const o=e.oxw(2);return e.KtG(o.selectedEvent=i)}),e.YNc(4,ke,2,2,"mat-option",20),e.qZA()()}if(2&a){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModelOptions",e.DdM(3,Z))("ngModel",t.selectedEvent),e.xp6(1),e.Q6J("ngForOf",t.eventTableDetails)}}function Ke(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e._UZ(11,"br"),e.TgZ(12,"input",29),e.NdJ("ngModelChange",function(i){const o=e.CHM(t),d=o.index,c=o.$implicit,u=e.oxw(3);return e.KtG(u.onActualsChanges(i,d,c,"Travel"))})("ngModelChange",function(i){const d=e.CHM(t).$implicit;return e.KtG(d.actualTravel=i)}),e.qZA()(),e.TgZ(13,"td"),e._uU(14),e._UZ(15,"br"),e.TgZ(16,"input",29),e.NdJ("ngModelChange",function(i){const o=e.CHM(t),d=o.index,c=o.$implicit,u=e.oxw(3);return e.KtG(u.onActualsChanges(i,d,c,"Accomodation"))})("ngModelChange",function(i){const d=e.CHM(t).$implicit;return e.KtG(d.actualAccomodation=i)}),e.qZA()(),e.TgZ(17,"td"),e._uU(18),e._UZ(19,"br"),e.TgZ(20,"input",29),e.NdJ("ngModelChange",function(i){const o=e.CHM(t),d=o.index,c=o.$implicit,u=e.oxw(3);return e.KtG(u.onActualsChanges(i,d,c,"Local"))})("ngModelChange",function(i){const d=e.CHM(t).$implicit;return e.KtG(d.actualLocal=i)}),e.qZA()(),e.TgZ(21,"td"),e._uU(22),e._UZ(23,"br"),e.TgZ(24,"input",29),e.NdJ("ngModelChange",function(i){const o=e.CHM(t),d=o.index,c=o.$implicit,u=e.oxw(3);return e.KtG(u.onActualsChanges(i,d,c,"Registration"))})("ngModelChange",function(i){const d=e.CHM(t).$implicit;return e.KtG(d.actualRegistartion=i)}),e.qZA()(),e.TgZ(25,"td"),e._uU(26),e.qZA(),e.TgZ(27,"td")(28,"input",30),e.NdJ("ngModelChange",function(i){const d=e.CHM(t).index,c=e.oxw(3);return e.KtG(c.onExpenseActualAmountChanges(i,d))})("ngModelChange",function(i){const d=e.CHM(t).$implicit;return e.KtG(d.actualTotal=i)}),e.qZA()(),e.TgZ(29,"td")(30,"input",31),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw(3);return e.KtG(o.onFileSelected(i,"other","signedAgreement"))}),e.qZA(),e._UZ(31,"br"),e.TgZ(32,"span",32)(33,"small"),e._uU(34,"Allowed File Types (.png, .jpg, .txt , .doc)"),e.qZA()(),e._UZ(35,"br"),e.TgZ(36,"span",32)(37,"small"),e._uU(38,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()()()()}if(2&a){const t=l.$implicit,n=l.index,i=e.oxw(3);e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(t.HCPName),e.xp6(2),e.Oqu(t.MISCode),e.xp6(2),e.Oqu(t["HCP Type"]),e.xp6(2),e.hij("",t.Travel||0," "),e.xp6(2),e.Q6J("ngModelOptions",e.DdM(20,Z))("ngModel",t.actualTravel),e.xp6(2),e.hij("",t.Accomodation||0," "),e.xp6(2),e.Q6J("ngModelOptions",e.DdM(21,Z))("ngModel",t.actualAccomodation),e.xp6(2),e.hij("",t.LocalConveyance||0," "),e.xp6(2),e.Q6J("ngModelOptions",e.DdM(22,Z))("ngModel",t.actualLocal),e.xp6(2),e.hij("",t["Registration Amount"]||0," "),e.xp6(2),e.Q6J("ngModelOptions",e.DdM(23,Z))("ngModel",t.actualRegistartion),e.xp6(2),e.Oqu(t.TotalSpend||0),e.xp6(2),e.Q6J("ngModelOptions",e.DdM(24,Z))("ngModel",t.actualTotal),e.xp6(2),e.Q6J("accept",i.allowedTypesForHTML)}}function Ye(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",33)(1,"mat-label"),e._uU(2,"Upload Deviation"),e.TgZ(3,"span",34),e._uU(4,"(HCP Aggregate Spend Exceeds 500000)*"),e.qZA()(),e._UZ(5,"br"),e.TgZ(6,"input",35),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw(3);return e.KtG(o.onFileSelected(i,"deviation","aggregateDeviation"))}),e.qZA(),e._UZ(7,"br"),e.TgZ(8,"span",32)(9,"small"),e._uU(10,"Allowed File Types (.png, .jpg,.txt , .doc)"),e.qZA()(),e._UZ(11,"br"),e.TgZ(12,"span",32)(13,"small"),e._uU(14,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()()()}if(2&a){const t=e.oxw(3);e.xp6(6),e.Q6J("accept",t.allowedTypesForHTML)}}function Je(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",33)(1,"mat-label"),e._uU(2,"Upload Deviation"),e.TgZ(3,"span",34),e._uU(4,"(Exceeded 50% of approved budget)*"),e.qZA()(),e._UZ(5,"br"),e.TgZ(6,"input",36),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw(3);return e.KtG(o.onFileSelected(i,"deviation","fiftyPercentDeviation"))}),e.qZA(),e._UZ(7,"br"),e.TgZ(8,"span",32)(9,"small"),e._uU(10,"Allowed File Types (.png, .jpg,.txt , .doc)"),e.qZA()(),e._UZ(11,"br"),e.TgZ(12,"span",32)(13,"small"),e._uU(14,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()()()}if(2&a){const t=e.oxw(3);e.xp6(6),e.Q6J("accept",t.allowedTypesForHTML)}}function Ge(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"tr")(1,"th",17),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td")(8,"input",40),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw(4);return e.KtG(o.onFileSelected(i,"other","btcInvoice"))})("ngModelChange",function(i){const d=e.CHM(t).$implicit;return e.KtG(d.invoiceFile=i)}),e.qZA(),e._UZ(9,"br"),e.TgZ(10,"span",32)(11,"small"),e._uU(12,"Allowed File Types (.png, .jpg, .txt , .doc)"),e.qZA()(),e._UZ(13,"br"),e.TgZ(14,"span",32)(15,"small"),e._uU(16,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()()()()}if(2&a){const t=l.$implicit,n=l.index,i=e.oxw(4);e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(t.expense),e.xp6(2),e.Oqu(t.amount),e.xp6(2),e.Q6J("accept",i.allowedTypesForHTML)("ngModelOptions",e.DdM(6,Z))("ngModel",t.invoiceFile)}}function Qe(a,l){if(1&a&&(e.TgZ(0,"div",10)(1,"div",37)(2,"h4")(3,"b"),e._uU(4,"Expense Summary"),e.qZA()()(),e.TgZ(5,"h5"),e._uU(6,"Expense Summary BTC"),e.qZA(),e.TgZ(7,"table",38)(8,"thead")(9,"tr")(10,"th")(11,"b")(12,"small"),e._uU(13,"S.no"),e.qZA()()(),e.TgZ(14,"th")(15,"b")(16,"small"),e._uU(17,"Expense Type"),e.qZA()()(),e.TgZ(18,"th")(19,"b")(20,"small"),e._uU(21,"BTC Amount"),e.qZA()()(),e.TgZ(22,"th")(23,"b")(24,"small"),e._uU(25,"Upload Invoice"),e.qZA()()()()(),e.TgZ(26,"tbody"),e.YNc(27,Ge,17,7,"tr",12),e.qZA(),e.TgZ(28,"tfoot")(29,"tr")(30,"td",39)(31,"b")(32,"small"),e._uU(33,"Total BTC Amount"),e.qZA()()(),e.TgZ(34,"td"),e._uU(35),e.qZA()()()()()),2&a){const t=e.oxw(3);e.xp6(27),e.Q6J("ngForOf",t.BTCSummary),e.xp6(8),e.Oqu(t.BTCSummaryTotal)}}function ze(a,l){if(1&a&&(e.TgZ(0,"tr")(1,"th",17),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA()()),2&a){const t=l.$implicit,n=l.index;e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(t.expense),e.xp6(2),e.Oqu(t.amount)}}function $e(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",10)(1,"h5"),e._uU(2,"Expense Summary BTE"),e.qZA(),e.TgZ(3,"table",38)(4,"thead")(5,"tr")(6,"th")(7,"b")(8,"small"),e._uU(9,"S.no"),e.qZA()()(),e.TgZ(10,"th")(11,"b")(12,"small"),e._uU(13,"Expense Type"),e.qZA()()(),e.TgZ(14,"th")(15,"b")(16,"small"),e._uU(17,"BTE Amount"),e.qZA()()()()(),e.TgZ(18,"tbody"),e.YNc(19,ze,7,3,"tr",12),e._UZ(20,"tr"),e.qZA(),e.TgZ(21,"tfoot")(22,"tr")(23,"td",39)(24,"b")(25,"small"),e._uU(26,"Total BTE Amount"),e.qZA()()(),e.TgZ(27,"td"),e._uU(28),e.qZA()()()(),e.TgZ(29,"div")(30,"mat-label"),e._uU(31,"Invoice Upload"),e.TgZ(32,"span",34),e._uU(33,"*"),e.qZA()(),e._UZ(34,"br"),e.TgZ(35,"input",31),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw(3);return e.KtG(o.onFileSelected(i,"other","bteInvoice"))}),e.qZA(),e._UZ(36,"br"),e.TgZ(37,"span",32)(38,"small"),e._uU(39,"Allowed File Types (.png, .jpg, .txt , .doc)"),e.qZA()(),e._UZ(40,"br"),e.TgZ(41,"span",32)(42,"small"),e._uU(43,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()()()()}if(2&a){const t=e.oxw(3);e.xp6(19),e.Q6J("ngForOf",t.BTESummary),e.xp6(9),e.Oqu(t.BTESummaryTotal),e.xp6(7),e.Q6J("accept",t.allowedTypesForHTML)}}function Ve(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",2)(1,"div",10)(2,"span",22)(3,"h4")(4,"b"),e._uU(5,"Expense Details:"),e.qZA()()(),e.TgZ(6,"table",11)(7,"thead")(8,"tr")(9,"th")(10,"small"),e._uU(11,"S.No"),e.qZA()(),e.TgZ(12,"th")(13,"small"),e._uU(14,"HCP Name"),e.qZA()(),e.TgZ(15,"th")(16,"small"),e._uU(17,"MIS Code"),e.qZA()(),e.TgZ(18,"th")(19,"small"),e._uU(20,"HCP Type"),e.qZA()(),e.TgZ(21,"th")(22,"small"),e._uU(23,"Travel Amount"),e.qZA()(),e.TgZ(24,"th")(25,"small"),e._uU(26,"Accomodation Amount"),e.qZA()(),e.TgZ(27,"th")(28,"small"),e._uU(29,"Local Conveyance Amount"),e.qZA()(),e.TgZ(30,"th")(31,"small"),e._uU(32,"Registration Amount"),e.qZA()(),e.TgZ(33,"th")(34,"small"),e._uU(35,"Budget Amount"),e.qZA()(),e.TgZ(36,"th")(37,"small"),e._uU(38,"Actual Amount"),e.qZA()(),e.TgZ(39,"th")(40,"small"),e._uU(41,"Signed Agreement Upload"),e.qZA()()()(),e.TgZ(42,"tbody"),e.YNc(43,Ke,39,25,"tr",12),e.qZA()()(),e.TgZ(44,"div",23)(45,"div",2),e.YNc(46,Ye,15,1,"div",24),e.YNc(47,Je,15,1,"div",24),e.qZA()(),e.YNc(48,Qe,36,2,"div",25),e.YNc(49,$e,44,3,"div",25),e.TgZ(50,"div",10)(51,"span",22)(52,"h4")(53,"b"),e._uU(54,"Total Expense Details:"),e.qZA()()(),e.TgZ(55,"table",11)(56,"thead")(57,"tr")(58,"th")(59,"small"),e._uU(60,"Event ID"),e.qZA()(),e.TgZ(61,"th")(62,"small"),e._uU(63,"Total Budget Amount For The Event"),e.qZA()(),e.TgZ(64,"th")(65,"small"),e._uU(66,"Actual Budget Amount For The Event"),e.qZA()()()(),e.TgZ(67,"tbody")(68,"tr")(69,"td"),e._uU(70),e.qZA(),e.TgZ(71,"td"),e._uU(72),e.qZA(),e.TgZ(73,"td"),e._uU(74),e.qZA()()()()(),e.TgZ(75,"div",10)(76,"span",22)(77,"h4")(78,"b"),e._uU(79,"Advance Details:"),e.qZA()()(),e.TgZ(80,"table",11)(81,"thead")(82,"tr")(83,"th")(84,"small"),e._uU(85,"Event Id"),e.qZA()(),e.TgZ(86,"th")(87,"small"),e._uU(88,"Advance Provided"),e.qZA()(),e.TgZ(89,"th")(90,"small"),e._uU(91,"Advance Utilized For The Event"),e.qZA()(),e.TgZ(92,"th")(93,"small"),e._uU(94,"Pay Back Amount to company"),e.qZA()(),e.TgZ(95,"th")(96,"small"),e._uU(97,"Additional Amount Needed To Pay For Initator"),e.qZA()()()(),e.TgZ(98,"tbody")(99,"tr")(100,"td"),e._uU(101),e.qZA(),e.TgZ(102,"td"),e._uU(103),e.qZA(),e.TgZ(104,"td"),e._uU(105),e.qZA(),e.TgZ(106,"td"),e._uU(107),e.qZA(),e.TgZ(108,"td"),e._uU(109),e.qZA()()()()(),e.TgZ(110,"div",26)(111,"button",27),e._uU(112," Reset "),e.qZA(),e.TgZ(113,"button",28),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.onSubmit())}),e._uU(114," Submit "),e.qZA()()()}if(2&a){const t=e.oxw(2);e.xp6(43),e.Q6J("ngForOf",t.expenseTableDetails),e.xp6(3),e.Q6J("ngIf",t.showAggregateSpendDeviation),e.xp6(1),e.Q6J("ngIf",t.showFiftyPercentUploadDeviation),e.xp6(1),e.Q6J("ngIf",t.BTCSummary.length>0),e.xp6(1),e.Q6J("ngIf",t.BTESummary.length>0),e.xp6(21),e.Oqu(t.selectedEvendId),e.xp6(2),e.Oqu(t.totalBudget),e.xp6(2),e.Oqu(t.totalBudget),e.xp6(27),e.Oqu(t.selectedEvendId),e.xp6(2),e.Oqu(t.totalBudget),e.xp6(2),e.Oqu(t.actualBudget),e.xp6(2),e.Oqu(t.payBackToCompany),e.xp6(2),e.Oqu(t.amountToPayForInitiator)}}function je(a,l){if(1&a&&(e.TgZ(0,"div",7)(1,"div",2)(2,"div",10)(3,"table",11)(4,"thead")(5,"tr")(6,"th")(7,"small"),e._uU(8,"S No."),e.qZA()(),e.TgZ(9,"th")(10,"small"),e._uU(11,"Event Id"),e.qZA()(),e.TgZ(12,"th")(13,"small"),e._uU(14,"Event Name"),e.qZA()(),e.TgZ(15,"th")(16,"small"),e._uU(17,"Event Type"),e.qZA()(),e.TgZ(18,"th")(19,"small"),e._uU(20,"Venue"),e.qZA()(),e.TgZ(21,"th")(22,"small"),e._uU(23,"Event Date"),e.qZA()()()(),e.TgZ(24,"tbody"),e.YNc(25,Le,13,6,"tr",12),e.qZA()()()(),e.TgZ(26,"div",2)(27,"div",13),e.YNc(28,He,5,4,"mat-form-field",14),e.qZA()(),e.TgZ(29,"form",15),e.YNc(30,Ve,115,13,"div",16),e.qZA()()),2&a){const t=e.oxw();e.xp6(25),e.Q6J("ngForOf",t.eventTableDetails),e.xp6(3),e.Q6J("ngIf",t.showEventSelectDropdown),e.xp6(1),e.Q6J("formGroup",t.deviationForm),e.xp6(1),e.Q6J("ngIf",t.showEventSettlementContent)}}function We(a,l){1&a&&(e.TgZ(0,"div",7)(1,"span",32),e._uU(2,"Sorry, this event type has no events for Event Settlement submission"),e.qZA()())}let Xe=(()=>{class a{constructor(t,n,i,o,d){this._utilityService=t,this._activatedRoute=n,this._snackBarService=i,this._authService=o,this._router=d,this.loadingIndicator=!1,this._isPanelDetailsLoaded=!1,this._ngUnSubscribe=new D.x,this.eventTableDetails=[],this.selectedEventDetail=[],this.expenseTableDetails=[],this.expenseTableActualAmountInput=[],this.changedActualAmount=[],this.totalBudget=0,this.actualBudget=0,this.payBackToCompany=0,this.amountToPayForInitiator=0,this.showNoData=!1,this.showEventSettlementContent=!1,this.showAggregateSpendDeviation=!1,this.showEventSelectDropdown=!1,this.showFiftyPercentUploadDeviation=!1,this.signedAgreementFile=[],this.invoiceFile=[],this._btcInvoiceFiles=[],this.BTESummary=[],this.BTCSummary=[],this.BTESummaryTotal=0,this.BTCSummaryTotal=0}ngOnInit(){this._authService.getUserDetails$.subscribe(t=>this._userDetails=t),this._getExpenseData(),this.deviationForm=new r.cw({aggregateDeviation:new r.NI(""),fiftyPercentDeviation:new r.NI("")}),this._activatedRoute.queryParams.subscribe(t=>{t.eventId&&t.eventType?(this.loadingIndicator=!0,this._utilityService.honorariumDetails().pipe((0,_.R)(this._ngUnSubscribe.asObservable())).subscribe(n=>{this.panelDetails=n,this._utilityService.getEventListFromProcess().pipe((0,_.R)(this._ngUnSubscribe.asObservable())).subscribe(i=>{this.showEventSelectDropdown=!1,this.allEventDetails=i,i.forEach(o=>{o["EventId/EventRequestId"]==t.eventId&&(this.eventTableDetails.push(o),this.loadingIndicator=!1)}),this.onEventSelect(t.eventId)})})):(this.showEventSelectDropdown=!0,this._loadEventData())}),this._allowedTypes=s.D.FILE.ALLOWED,this._generateAllowedFileAcceptAttribute()}ngOnDestroy(){this._ngUnSubscribe.next(),this._ngUnSubscribe.complete()}_loadEventData(){this.loadingIndicator=!0,this._utilityService.getEventListFromProcess().pipe((0,_.R)(this._ngUnSubscribe.asObservable())).subscribe(t=>{this.loadingIndicator=!1,this.allEventDetails=t,t.forEach(n=>{"HCP Consultants"==n.EventType&&n["Initiator Email"]==this._userDetails.email&&("Approved"==n["Event Request Status"]||"Advance Approved"==n["Event Request Status"])&&this.eventTableDetails.push(n)}),this.eventTableDetails.length<1?(this.showNoData=!0,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.NO_DATA,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)):this.showNoData=!1})}_getExpenseData(){this._utilityService.honorariumDetails().pipe((0,_.R)(this._ngUnSubscribe.asObservable())).subscribe(n=>{this._isPanelDetailsLoaded=!0,this.panelDetails=n,console.log(this.panelDetails)}),this._utilityService.getExpensesData().pipe((0,_.R)(this._ngUnSubscribe.asObservable())).subscribe(n=>{this._expenseDetails=n})}onEventSelect(t){this.BTCSummary=[],this.BTCSummary=[],this.BTESummaryTotal=0,this.BTCSummaryTotal=0,this.expenseTableDetails=[],this.selectedEventDetails=this.allEventDetails.find(i=>i["EventId/EventRequestId"]==t),console.log(this.selectedEventDetails),this.selectedEvendId=t,this.panelDetails.forEach(i=>{i["EventId/EventRequestId"]==t&&(i.actualTravel=+i.Travel,i.actualAccomodation=+i.Accomodation,i.actualLocal=+i.LocalConveyance,i.actualRegistartion=+i["Registration Amount"],i.actualTotal=i.actualTravel+i.actualAccomodation+i.actualLocal+i.actualRegistartion,i.TotalSpend=+i.Travel+ +i.Accomodation+ +i.LocalConveyance+ +i["Registration Amount"],this.totalBudget+=i.TotalSpend,this.expenseTableDetails.push(i))});let n=[];if(this._expenseDetails.forEach(i=>{i["EventId/EventRequestID"]==t&&n.push(i)}),n.length>0&&this._filterBTCBTE(n),this.actualBudget=this.totalBudget,this.expenseTableDetails.length>0){this.showEventSettlementContent=!0,this._checkAggregateDeviation();for(let i=0;i<this.expenseTableDetails.length;i++)this.expenseTableActualAmountInput.push(i)}else this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.NO_DATA,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),this.showEventSettlementContent=!1}_checkAggregateDeviation(){this.showAggregateSpendDeviation=this.totalBudget>5e5||this.actualBudget>5e5}_checkBudgetExceedsDeviation(t){let n=+(this.totalBudget/2).toFixed(2);this.showFiftyPercentUploadDeviation=t>this.totalBudget+n}onActualsChanges(t,n,i,o){"Travel"==o?i.actualTravel=t:"Accomodation"==o?i.actualAccomodation=t:"Local"==o?i.actualLocal=t:i.actualRegistartion=t,i.actualTotal=i.actualTravel+i.actualAccomodation+i.actualLocal+i.actualRegistartion,this.onExpenseActualAmountChanges(i.actualTotal,n),this._checkBudgetExceedsDeviation(i.actualTotal)}onExpenseActualAmountChanges(t,n){this.actualBudget=this.totalBudget,this.actualBudget-=+this.expenseTableDetails[n].TotalSpend;let i=this.changedActualAmount.find(o=>o.index==n);i?i.amount=t:this.changedActualAmount.push({index:n,amount:t});for(let o=0;o<this.changedActualAmount.length;o++)this.actualBudget+=this.changedActualAmount[o].amount;this._calculateActualBudget()}_calculateActualBudget(){this._checkAggregateDeviation(),this.totalBudget<this.actualBudget&&(this.payBackToCompany=0,this.amountToPayForInitiator=this.actualBudget-this.totalBudget),this.totalBudget>this.actualBudget&&(this.amountToPayForInitiator=0,this.payBackToCompany=this.totalBudget-this.actualBudget),this.totalBudget==this.actualBudget&&(this.payBackToCompany=0,this.amountToPayForInitiator=0)}_generateAllowedFileAcceptAttribute(){this._allowedTypes.forEach(t=>{this.allowedTypesForHTML+="."+t+", "})}onFileSelected(t,n,i){const o=t.target.files[0];if(t.target.files.length>0)if(o.size>=s.D.FILE.MIN_SIZE&&o.size<s.D.FILE.MAX_SIZE){const d=o.name.split(".")[1],c=new FileReader;this._allowedTypes.indexOf(d)>-1?(c.readAsDataURL(o),c.onloadend=()=>{const u=c.result;"deviation"==n&&("aggregateDeviation"==i&&(this.aggregateDeviationFile=o.name+":"+u.split(",")[1]),"fiftyPercentDeviation"==i&&(this.fiftyPercentDeviationFile=o.name+":"+u.split(",")[1])),"other"==n&&("signedAgreement"==i&&(this.signedAgreementFile.push(o.name+":"+u.split(",")[1]),console.log(this.signedAgreementFile)),"btcInvoice"==i&&this._btcInvoiceFiles.push(o.name+":"+u.split(",")[1]),"bteInvoice"==i&&(this._bteInvoiceFile=o.name+":"+u.split(",")[1]))}):(this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_TYPE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),this._resetControl(i))}else this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_SIZE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),this._resetControl(i)}_resetControl(t){switch(t){case"aggregateDeviation":this.deviationForm.controls.aggregateDeviation.reset(),this.aggregateDeviationFile="",console.log(this.aggregateDeviationFile);break;case"fiftyPercentDeviation":this.deviationForm.controls.fiftyPercentDeviation.reset()}}onSubmit(){if(this.showAggregateSpendDeviation&&!Boolean(this.deviationForm.value.aggregateDeviation)||this.showFiftyPercentUploadDeviation&&!Boolean(this.deviationForm.value.fiftyPercentDeviation)||this.signedAgreementFile.length<this.expenseTableDetails.length)this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_UPLOAD,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR);else if(this._btcInvoiceFiles.length<this.BTCSummary.length||this.BTESummary.length>0&&!Boolean(this._bteInvoiceFile))this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_UPLOAD,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR);else{let t=this.invoiceFile.concat(this.signedAgreementFile);this.BTCSummary.length>0&&this._btcInvoiceFiles.forEach(o=>t.push(o)),this.BTESummary.length>0&&t.push(this._bteInvoiceFile),console.log(t),this.loadingIndicator=!0;let n=this._authService.decodeToken();console.log(this.selectedEventDetails),this._utilityService.postEventSettlementDetails({Invitee:[{EventIdOrEventRequestId:" ",InviteeName:" ",MisCode:" ",LocalConveyance:" ",BtcorBte:" ",LcAmount:" "}],ExpenseSheets:[{Amount:" ",Expense:" ",AmountExcludingTax:" ",BtcorBte:" ",EventId:" ",BtcAmount:" ",BteAmount:" ",BudgetAmount:" "}],EventId:this.selectedEvendId,EventTopic:this.selectedEventDetails["Event Topic"],EventType:this.selectedEventDetails.EventType,EventDate:this.selectedEventDetails.EventDate,StartTime:this.selectedEventDetails.StartTime,InitiatorName:this.selectedEventDetails.InitiatorName||n.unique_name,EndTime:this.selectedEventDetails.EndTime,VenueName:this.selectedEventDetails.VenueName,State:" ",City:" ",Attended:" ",InviteesParticipated:" ",ExpenseParticipated:this.eventTableDetails.length+""||" ",TotalExpense:`Total Panel Selection Final Amount: ${this.totalBudget} | Total Budget For The Event : ${this.totalBudget}`,Advance:`Advance Provided : ${this.totalBudget} | Advance Utilized For Event : ${this.actualBudget} | Pay Back Amount To Company  : ${this.payBackToCompany} | Additional Amount Needed To Pay For Initiator : ${this.amountToPayForInitiator}`,Brands:this.selectedEventDetails.Brands||" ",SlideKits:this.selectedEventDetails.SlideKits||" ",Panalists:this.selectedEventDetails.Panelists||" ",InitiatorEmail:n.email||" ",RbMorBM:n.RBM_BM||" ",SalesHead:n.SalesHead||" ",MarkeringHead:n.MarketingHead||" ",Compliance:n.ComplianceHead||"sabri.s@vsaasglobal.com",FinanceAccounts:n.FinanceAccounts||" ",FinanceTreasury:n.FinanceTreasury||" ",MedicalAffairsHead:n.MedicalAffairsHead||"sabri.s@vsaasglobal.com",FinanceHead:n.FinanceAccounts||"sabri.s@vsaasglobal.com",ReportingManagerEmail:n.reportingmanager,FirstLevelEmail:n.firstLevelManager,FinanceTreasuryEmail:n.FinanceTreasury||" ",SalesCoordinatorEmail:n.SalesCoordinator,EventOpen30Days:"No",EventLessThan5Days:"No",PostEventSubmitted:"Yes",IsAdvanceRequired:this.selectedEventDetails.IsAdvanceRequired||"No",TotalInvitees:"0",TotalAttendees:"0",TotalTravelAndAccomodationSpend:this.selectedEventDetails["Total Travel & Accomodation Spend"]+""||"0",TotalHonorariumSpend:"0",TotalSpend:this.selectedEventDetails["Total Spend"]+""||"0",TotalLocalConveyance:this.selectedEventDetails["Total Local Conveyance"]+""||"0",TotalTravelSpend:this.selectedEventDetails["Total Travel Spend"]+""||"0",TotalAccomodationSpend:this.selectedEventDetails["Total Accomodation Spend"]+""||"0",TotalExpenses:this.selectedEventDetails["Total Expense"]+""||"0",TotalActuals:this.totalBudget+"",AdvanceUtilizedForEvents:this.actualBudget+"",PayBackAmountToCompany:this.payBackToCompany+"",AdditionalAmountNeededToPayForInitiator:this.amountToPayForInitiator+"",IsDeviationUpload:"No",Role:n.role,DeviationFiles:[" "],Files:t}).pipe((0,_.R)(this._ngUnSubscribe.asObservable())).subscribe(o=>{"Data added successfully."==o.message&&(this.loadingIndicator=!1,this._snackBarService.showSnackBar(s.D.MESSAGE.SUCCESS.ADD_POST_SETTLEMENT,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.SUCCESS),this.showEventSettlementContent=!1,this._router.navigate(["view-event-list"]))},o=>{this.loadingIndicator=!1,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.SERVER_ERR,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)})}}_filterBTCBTE(t){console.log(t),this.BTESummary=[],this.BTCSummary=[],this.BTESummaryTotal=0,this.BTCSummaryTotal=0,t.forEach(n=>{if("BTC"==n["BTC/BTE"].trim()){let i={expense:n.Expense,amount:n["Registration Amount"],invoiceFile:""};this.BTCSummary.push(i),this.BTCSummaryTotal+=+i.amount}if("BTE"==n["BTC/BTE"].trim()){let i={expense:n.Expense,amount:n["Registration Amount"]};this.BTESummary.push(i),this.BTESummaryTotal+=+i.amount}}),console.log(this.BTCSummary),console.log(this.BTESummary),console.log(this.BTESummaryTotal),console.log(this.BTCSummaryTotal)}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(g.t),e.Y36(v.gz),e.Y36(S.c),e.Y36(C.e),e.Y36(v.F0))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-hcp-post-event-settlement"]],decls:15,vars:3,consts:[[1,"main-content"],[1,"container-fluid"],[1,"row"],[1,"col-md-12"],[1,"card"],[1,"card-header","card-header-danger"],[1,"card-title"],[1,"card-body"],["class","card-body",4,"ngIf"],[3,"isLoading"],[1,"container","table-responsive"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"col-6"],["color","accent","appearance","outline",4,"ngIf"],[3,"formGroup"],["class","row",4,"ngIf"],["scope","row"],["color","accent","appearance","outline"],[3,"ngModelOptions","ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"text-danger","text-secondary","m-2"],[1,"container"],["class","col",4,"ngIf"],["class","container table-responsive",4,"ngIf"],[1,"container","d-flex","justify-content-center"],["type","button",1,"btn","btn-sm","btn-primary"],["type","submit",1,"btn","btn-sm","btn-warning",3,"click"],["type","number","placeholder","Actual Amount",3,"ngModelOptions","ngModel","ngModelChange"],["type","number","disabled","",3,"ngModelOptions","ngModel","ngModelChange"],["type","file",3,"accept","change"],[1,"text-danger"],[1,"col"],[2,"color","red"],["type","file","formControlName","aggregateDeviation",3,"accept","change"],["type","file","formControlName","fiftyPercentDeviation",3,"accept","change"],[1,"col","d-flex","justify-content-center","text-danger"],[1,"table","text-center","table-bordered"],["colspan","2",1,"text-right"],["type","file",3,"accept","ngModelOptions","ngModel","change","ngModelChange"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h4",6),e._uU(7,"Post Event Settlement request"),e.qZA()(),e.TgZ(8,"div",7)(9,"div",2)(10,"div",3)(11,"div",4),e.YNc(12,je,31,4,"div",8),e.YNc(13,We,3,0,"div",8),e.qZA()()()()()()()()(),e._UZ(14,"app-spinner-loader",9)),2&t&&(e.xp6(12),e.Q6J("ngIf",!n.showNoData),e.xp6(1),e.Q6J("ngIf",n.showNoData),e.xp6(1),e.Q6J("isLoading",n.loadingIndicator))},dependencies:[h.sg,h.O5,r._Y,r.Fj,r.wV,r.JJ,r.JL,r.On,r.sg,r.u,p.KE,p.hX,A.gD,E.ey,f.r],styles:["table.table-bordered[_ngcontent-%COMP%]    > thead[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%] {\r\n    border:1px solid black;\r\n  }\r\n  table.table-bordered[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\r\n    border:1px solid rgb(209, 162, 162);\r\n  }\r\n  table.table-striped[_ngcontent-%COMP%]    > thead[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%] {\r\n    border:1px solid black;\r\n  }\r\n  table.table-striped[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\r\n    border:1px solid rgb(209, 162, 162);\r\n  }"]}),a})();function et(a,l){if(1&a&&(e.TgZ(0,"tr")(1,"td",19),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA()()),2&a){const t=l.$implicit,n=l.index;e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(t["EventId/EventRequestId"]),e.xp6(2),e.Oqu(t["Event Topic"]),e.xp6(2),e.Oqu(t.EventType),e.xp6(2),e.Oqu(t.VenueName||"NA"),e.xp6(2),e.Oqu(t.EventDate)}}function tt(a,l){if(1&a&&(e.TgZ(0,"mat-option",20),e._uU(1),e.qZA()),2&a){const t=l.$implicit;e.s9C("value",t["EventId/EventRequestId"]),e.xp6(1),e.hij("",t["EventId/EventRequestId"]," ")}}function nt(a,l){if(1&a&&(e.TgZ(0,"th")(1,"small"),e._uU(2),e.qZA()()),2&a){const t=l.$implicit;e.xp6(2),e.hij("Expense ",t+1,"")}}function it(a,l){if(1&a&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&a){const t=l.$implicit,n=e.oxw().$implicit;e.xp6(1),e.Oqu(n["Expense "+t]||"0")}}const U=function(){return{standalone:!0}};function at(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.YNc(9,it,2,1,"td",12),e.TgZ(10,"td"),e._uU(11),e.qZA(),e.TgZ(12,"td")(13,"input",26),e.NdJ("ngModelChange",function(i){const d=e.CHM(t).index,c=e.oxw(3);return e.KtG(c.calculateActualAmount(i,d))})("ngModelChange",function(i){const d=e.CHM(t).$implicit;return e.KtG(d.ActualAmount=i)}),e.qZA()(),e.TgZ(14,"td")(15,"input",27),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw(3);return e.KtG(o.onFileSelected(i,"other","hcpAgreement"))}),e.qZA(),e._UZ(16,"br"),e.TgZ(17,"span",28)(18,"small"),e._uU(19,"Allowed File Types (.png, .jpg, .txt , .doc)"),e.qZA()(),e._UZ(20,"br"),e.TgZ(21,"span",28)(22,"small"),e._uU(23,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()()(),e.TgZ(24,"td")(25,"input",27),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw(3);return e.KtG(o.onFileSelected(i,"other","hcpAcknowledgement"))}),e.qZA(),e._UZ(26,"br"),e.TgZ(27,"span",28)(28,"small"),e._uU(29,"Allowed File Types (.png, .jpg, .txt , .doc)"),e.qZA()(),e._UZ(30,"br"),e.TgZ(31,"span",28)(32,"small"),e._uU(33,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()()()()}if(2&a){const t=l.$implicit,n=l.index,i=e.oxw(3);e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(t.HCPName),e.xp6(2),e.Oqu(t.MISCode),e.xp6(2),e.Oqu(t["HCP Type"]),e.xp6(1),e.Q6J("ngForOf",i.expenseColumnGenerateCount),e.xp6(2),e.Oqu(t["Medical Utility Type"]),e.xp6(2),e.Q6J("ngModelOptions",e.DdM(12,U))("ngModel",t.ActualAmount),e.xp6(2),e.Q6J("accept",i.allowedTypesForHTML)("disabled",!t.showAgreementUpload),e.xp6(10),e.Q6J("accept",i.allowedTypesForHTML)("disabled",!t.showAcknowledgementUpload)}}function ot(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"tr")(1,"th",19),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td")(8,"input",32),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw(4);return e.KtG(o.onFileSelected(i,"other","btcInvoice"))})("ngModelChange",function(i){const d=e.CHM(t).$implicit;return e.KtG(d.invoiceFile=i)}),e.qZA(),e._UZ(9,"br"),e.TgZ(10,"span",28)(11,"small"),e._uU(12,"Allowed File Types (.png, .jpg, .txt , .doc)"),e.qZA()(),e._UZ(13,"br"),e.TgZ(14,"span",28)(15,"small"),e._uU(16,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()()()()}if(2&a){const t=l.$implicit,n=l.index,i=e.oxw(4);e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(t.expense),e.xp6(2),e.Oqu(t.amount),e.xp6(2),e.Q6J("accept",i.allowedTypesForHTML)("ngModelOptions",e.DdM(6,U))("ngModel",t.invoiceFile)}}function st(a,l){if(1&a&&(e.TgZ(0,"div",10)(1,"div",29)(2,"h4")(3,"b"),e._uU(4,"Expense Summary"),e.qZA()()(),e.TgZ(5,"h5"),e._uU(6,"Expense Summary BTC"),e.qZA(),e.TgZ(7,"table",30)(8,"thead")(9,"tr")(10,"th")(11,"b")(12,"small"),e._uU(13,"S.no"),e.qZA()()(),e.TgZ(14,"th")(15,"b")(16,"small"),e._uU(17,"Expense Type"),e.qZA()()(),e.TgZ(18,"th")(19,"b")(20,"small"),e._uU(21,"BTC Amount"),e.qZA()()(),e.TgZ(22,"th")(23,"b")(24,"small"),e._uU(25,"Upload Invoice"),e.qZA()()()()(),e.TgZ(26,"tbody"),e.YNc(27,ot,17,7,"tr",12),e.qZA(),e.TgZ(28,"tfoot")(29,"tr")(30,"td",31)(31,"b")(32,"small"),e._uU(33,"Total BTC Amount"),e.qZA()()(),e.TgZ(34,"td"),e._uU(35),e.qZA()()()()()),2&a){const t=e.oxw(3);e.xp6(27),e.Q6J("ngForOf",t.BTCSummary),e.xp6(8),e.Oqu(t.BTCSummaryTotal)}}function lt(a,l){if(1&a&&(e.TgZ(0,"tr")(1,"th",19),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA()()),2&a){const t=l.$implicit,n=l.index;e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(t.expense),e.xp6(2),e.Oqu(t.amount)}}function rt(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",10)(1,"h5"),e._uU(2,"Expense Summary BTE"),e.qZA(),e.TgZ(3,"table",30)(4,"thead")(5,"tr")(6,"th")(7,"b")(8,"small"),e._uU(9,"S.no"),e.qZA()()(),e.TgZ(10,"th")(11,"b")(12,"small"),e._uU(13,"Expense Type"),e.qZA()()(),e.TgZ(14,"th")(15,"b")(16,"small"),e._uU(17,"BTE Amount"),e.qZA()()()()(),e.TgZ(18,"tbody"),e.YNc(19,lt,7,3,"tr",12),e._UZ(20,"tr"),e.qZA(),e.TgZ(21,"tfoot")(22,"tr")(23,"td",31)(24,"b")(25,"small"),e._uU(26,"Total BTE Amount"),e.qZA()()(),e.TgZ(27,"td"),e._uU(28),e.qZA()()()(),e.TgZ(29,"div")(30,"mat-label"),e._uU(31,"Invoice Upload"),e.TgZ(32,"span",33),e._uU(33,"*"),e.qZA()(),e._UZ(34,"br"),e.TgZ(35,"input",34),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw(3);return e.KtG(o.onFileSelected(i,"other","bteInvoice"))}),e.qZA(),e._UZ(36,"br"),e.TgZ(37,"span",28)(38,"small"),e._uU(39,"Allowed File Types (.png, .jpg, .txt , .doc)"),e.qZA()(),e._UZ(40,"br"),e.TgZ(41,"span",28)(42,"small"),e._uU(43,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()()()()}if(2&a){const t=e.oxw(3);e.xp6(19),e.Q6J("ngForOf",t.BTESummary),e.xp6(9),e.Oqu(t.BTESummaryTotal),e.xp6(7),e.Q6J("accept",t.allowedTypesForHTML)}}function dt(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",2)(1,"div",10)(2,"span",21)(3,"h4")(4,"b"),e._uU(5,"Expense Details:"),e.qZA()()(),e.TgZ(6,"table",11)(7,"thead")(8,"tr")(9,"th")(10,"small"),e._uU(11,"S.No"),e.qZA()(),e.TgZ(12,"th")(13,"small"),e._uU(14,"HCP Name"),e.qZA()(),e.TgZ(15,"th")(16,"small"),e._uU(17,"MIS Code"),e.qZA()(),e.TgZ(18,"th")(19,"small"),e._uU(20,"HCP Type"),e.qZA()(),e.YNc(21,nt,3,1,"th",12),e.TgZ(22,"th")(23,"small"),e._uU(24,"Medical Utility Type"),e.qZA()(),e.TgZ(25,"th")(26,"small"),e._uU(27,"Actual Amount"),e.qZA()(),e.TgZ(28,"th")(29,"small"),e._uU(30,"HCP Agreement Upload"),e.qZA()(),e.TgZ(31,"th")(32,"small"),e._uU(33,"HCP Acknowledgement Upload"),e.qZA()()()(),e.TgZ(34,"tbody"),e.YNc(35,at,34,13,"tr",12),e.qZA()()(),e.YNc(36,st,36,2,"div",22),e.YNc(37,rt,44,3,"div",22),e.TgZ(38,"div",10)(39,"span",21)(40,"h4")(41,"b"),e._uU(42,"Total Expense Details:"),e.qZA()()(),e.TgZ(43,"table",11)(44,"thead")(45,"tr")(46,"th")(47,"small"),e._uU(48,"Event ID"),e.qZA()(),e.TgZ(49,"th")(50,"small"),e._uU(51,"Total Budget Amount For The Event"),e.qZA()(),e.TgZ(52,"th")(53,"small"),e._uU(54,"Actual Budget Amount For The Event"),e.qZA()()()(),e.TgZ(55,"tbody")(56,"tr")(57,"td"),e._uU(58),e.qZA(),e.TgZ(59,"td"),e._uU(60),e.qZA(),e.TgZ(61,"td"),e._uU(62),e.qZA()()()()(),e.TgZ(63,"div",10)(64,"span",21)(65,"h4")(66,"b"),e._uU(67,"Advance Details:"),e.qZA()()(),e.TgZ(68,"table",11)(69,"thead")(70,"tr")(71,"th")(72,"small"),e._uU(73,"Event Id"),e.qZA()(),e.TgZ(74,"th")(75,"small"),e._uU(76,"Advance Provided"),e.qZA()(),e.TgZ(77,"th")(78,"small"),e._uU(79,"Advance Utilized For The Event"),e.qZA()(),e.TgZ(80,"th")(81,"small"),e._uU(82,"Pay Back Amount to company"),e.qZA()(),e.TgZ(83,"th")(84,"small"),e._uU(85,"Additional Amount Needed To Pay For Initator"),e.qZA()()()(),e.TgZ(86,"tbody")(87,"tr")(88,"td"),e._uU(89),e.qZA(),e.TgZ(90,"td"),e._uU(91),e.qZA(),e.TgZ(92,"td"),e._uU(93),e.qZA(),e.TgZ(94,"td"),e._uU(95),e.qZA(),e.TgZ(96,"td"),e._uU(97),e.qZA()()()()(),e.TgZ(98,"div",23)(99,"button",24),e._uU(100," Reset "),e.qZA(),e.TgZ(101,"button",25),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.onSubmit())}),e._uU(102," Submit "),e.qZA()()()}if(2&a){const t=e.oxw(2);e.xp6(21),e.Q6J("ngForOf",t.expenseColumnGenerateCount),e.xp6(14),e.Q6J("ngForOf",t.expenseTableDetails),e.xp6(1),e.Q6J("ngIf",t.BTCSummary.length>0),e.xp6(1),e.Q6J("ngIf",t.BTESummary.length>0),e.xp6(21),e.Oqu(t.selectedEventDetail["EventId/EventRequestId"]),e.xp6(2),e.Oqu(t.totalBudget),e.xp6(2),e.Oqu(t.actualBudget),e.xp6(27),e.Oqu(t.selectedEventDetail["EventId/EventRequestId"]),e.xp6(2),e.Oqu(t.totalBudget),e.xp6(2),e.Oqu(t.actualBudget),e.xp6(2),e.Oqu(t.payBackToCompany),e.xp6(2),e.Oqu(t.amountToPayForInitiator)}}function ct(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",7)(1,"div",2)(2,"div",10)(3,"table",11)(4,"thead")(5,"tr")(6,"th")(7,"small"),e._uU(8,"S No."),e.qZA()(),e.TgZ(9,"th")(10,"small"),e._uU(11,"Event Id"),e.qZA()(),e.TgZ(12,"th")(13,"small"),e._uU(14,"Event Name"),e.qZA()(),e.TgZ(15,"th")(16,"small"),e._uU(17,"Event Type"),e.qZA()(),e.TgZ(18,"th")(19,"small"),e._uU(20,"Venue"),e.qZA()(),e.TgZ(21,"th")(22,"small"),e._uU(23,"Event Date"),e.qZA()()()(),e.TgZ(24,"tbody"),e.YNc(25,et,13,6,"tr",12),e.qZA()()()(),e.TgZ(26,"div",2)(27,"div",13)(28,"mat-form-field",14)(29,"mat-label"),e._uU(30,"Select Event ID"),e.qZA(),e.TgZ(31,"mat-select",15),e.NdJ("ngModelChange",function(i){e.CHM(t);const o=e.oxw();return e.KtG(o.onEventSelect(i))})("ngModelChange",function(i){e.CHM(t);const o=e.oxw();return e.KtG(o.selectedEvent=i)}),e.YNc(32,tt,2,2,"mat-option",16),e.qZA()()()(),e.TgZ(33,"form",17),e.YNc(34,dt,103,12,"div",18),e.qZA()()}if(2&a){const t=e.oxw();e.xp6(25),e.Q6J("ngForOf",t.eventTableDetails),e.xp6(6),e.Q6J("ngModelOptions",e.DdM(6,U))("ngModel",t.selectedEvent),e.xp6(1),e.Q6J("ngForOf",t.eventTableDetails),e.xp6(1),e.Q6J("formGroup",t.deviationForm),e.xp6(1),e.Q6J("ngIf",t.showEventSettlementContent)}}function ut(a,l){1&a&&(e.TgZ(0,"div",7)(1,"span",28),e._uU(2,"Sorry, this event type has no events for Event Settlement submission"),e.qZA()())}let mt=(()=>{class a{constructor(t,n,i,o){this._utilityService=t,this._activatedRoute=n,this._snackBarService=i,this._authService=o,this.loadingIndicator=!1,this._ngUnSubscribe=new D.x,this.eventTableDetails=[],this.showNoData=!1,this.showEventSettlementContent=!1,this.expenseTableDetails=[],this.expenseTableActualAmountInput=[],this.changedActualAmount=[],this.totalBudget=0,this.actualBudget=0,this.payBackToCompany=0,this.amountToPayForInitiator=0,this.misBasedExpense=[],this.expenseColumnGenerateCount=[],this.hcpAgreementLength=0,this.hcpAcknowledgementLength=0,this.hcpAcknowledgementFiles=[],this.hcpAgreementFiles=[],this._btcInvoiceFiles=[],this.BTESummary=[],this.BTCSummary=[],this.BTESummaryTotal=0,this.BTCSummaryTotal=0}ngOnInit(){this._authService.getUserDetails$.subscribe(t=>this._userDetails=t),this._getExpenseData(),this.deviationForm=new r.cw({}),this._activatedRoute.queryParams.subscribe(t=>{t.eventId&&t.eventType?(this.loadingIndicator=!0,this._utilityService.getEventListFromProcess().pipe((0,_.R)(this._ngUnSubscribe.asObservable())).subscribe(n=>{this.loadingIndicator=!1,n.forEach(i=>{i["EventId/EventRequestId"]==t.eventId&&this.eventTableDetails.push(i)})})):this._loadEventData()}),this._allowedTypes=s.D.FILE.ALLOWED,this._generateAllowedFileAcceptAttribute()}ngOnDestroy(){this._ngUnSubscribe.next(),this._ngUnSubscribe.complete()}_loadEventData(){this.loadingIndicator=!0,this._utilityService.getEventListFromProcess().pipe((0,_.R)(this._ngUnSubscribe.asObservable())).subscribe(t=>{this.loadingIndicator=!1,t.forEach(n=>{"Medical Utility"==n.EventType&&n["Initiator Email"]==this._userDetails.email&&("Approved"==n["Event Request Status"]||"Advance Approved"==n["Event Request Status"])&&this.eventTableDetails.push(n)}),this.eventTableDetails.length<1?(this.showNoData=!0,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.NO_DATA,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)):this.showNoData=!1})}_getExpenseData(){this._utilityService.honorariumDetails().pipe((0,_.R)(this._ngUnSubscribe.asObservable())).subscribe(t=>{this.panelDetails=t,console.log(this.panelDetails)}),this._utilityService.getExpensesData().pipe((0,_.R)(this._ngUnSubscribe.asObservable())).subscribe(t=>{this.allExpenseData=t})}onEventSelect(t){if(this.totalBudget=0,this.actualBudget=0,this._expenseBasedMisCode=0,this.amountToPayForInitiator=0,this.payBackToCompany=0,this.expenseTableDetails=[],this.expenseColumnGenerateCount=[],this.selectedEventId=t,this.selectedEventDetail=this.eventTableDetails.find(n=>n["EventId/EventRequestId"]==t),this.panelDetails.forEach(n=>{n["EventId/EventRequestId"]==t&&this.expenseTableDetails.push(n)}),this.expenseTableDetails.length>0){this.showNoData=!1,this.showEventSettlementContent=!0;let n=this.allExpenseData.filter(o=>o["EventId/EventRequestID"]==t);this._expenseBasedMisCode=n;let i=0;n.length>0&&(console.log(n),this.expenseTableDetails.forEach(o=>{let d=n.filter(c=>c.MisCode==o.MISCode);"Medical Book"==o["Medical Utility Type"].trim()&&(o.showAcknowledgementUpload=!0,this.hcpAcknowledgementLength++),"GO"==o["HCP Type"]&&o.ActualAmount>0&&(o.showAgreementUpload=!0,this.hcpAgreementLength++),o.ActualAmount=0;for(let c=0;c<d.length;c++)o[`Expense ${c}`]=d[c].Amount,o.ActualAmount+=d[c].Amount;if(this.totalBudget+=o.ActualAmount,this.actualBudget=this.totalBudget,d.length>i){i=d.length;for(let c=0;c<i;c++)this.expenseColumnGenerateCount.push(c)}}))}else this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.NO_DATA,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),this.showEventSettlementContent=!1;this._filterBTEBTE(this._expenseBasedMisCode)}calculateActualAmount(t,n){console.log(this._expenseBasedMisCode),this._expenseBasedMisCode.length>0&&(this.actualBudget-=this.expenseTableDetails[n].ActualAmount,this.actualBudget+=t,this._calculateActualBudget(),console.log("kll"))}_calculateActualBudget(){this.totalBudget<this.actualBudget&&(this.payBackToCompany=0,this.amountToPayForInitiator=this.actualBudget-this.totalBudget),this.totalBudget>this.actualBudget&&(this.amountToPayForInitiator=0,this.payBackToCompany=this.totalBudget-this.actualBudget),this.totalBudget==this.actualBudget&&(this.payBackToCompany=0,this.amountToPayForInitiator=0)}_generateAllowedFileAcceptAttribute(){this._allowedTypes.forEach(t=>{this.allowedTypesForHTML+="."+t+", "})}onFileSelected(t,n,i){const o=t.target.files[0];if(t.target.files.length>0)if(o.size>=s.D.FILE.MIN_SIZE&&o.size<s.D.FILE.MAX_SIZE){const d=o.name.split(".")[1],c=new FileReader;this._allowedTypes.indexOf(d)>-1?(c.readAsDataURL(o),c.onloadend=()=>{const u=c.result;"other"==n&&("hcpAcknowledgement"==i&&this.hcpAcknowledgementFiles.push(o.name+":"+u.split(",")[1]),"hcpAgreement"==i&&this.hcpAgreementFiles.push(o.name+":"+u.split(",")[1]),"btcInvoice"==i&&this._btcInvoiceFiles.push(o.name+":"+u.split(",")[1]),"bteInvoice"==i&&(this._bteInvoiceFile=o.name+":"+u.split(",")[1]))}):(this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_TYPE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),this._resetControl(i))}else this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_SIZE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),this._resetControl(i)}_resetControl(t){}onSubmit(){if(this.hcpAgreementFiles.length!==this.hcpAgreementLength||this.hcpAcknowledgementFiles.length!==this.hcpAcknowledgementLength)this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_UPLOAD,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR);else if(this._btcInvoiceFiles.length<this.BTCSummary.length)this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_UPLOAD,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR);else if(this.BTESummary.length>0&&!Boolean(this._bteInvoiceFile))this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_UPLOAD,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR);else{this.loadingIndicator=!0;let t=this._authService.decodeToken();const n={Invitee:[{EventIdOrEventRequestId:" ",InviteeName:" ",MisCode:" ",LocalConveyance:" ",BtcorBte:" ",LcAmount:" "}],ExpenseSheets:[{Amount:" ",Expense:" ",AmountExcludingTax:" ",BtcorBte:" ",EventId:" ",BtcAmount:" ",BteAmount:" ",BudgetAmount:" "}],EventId:this.selectedEventDetail["EventId/EventRequestId"],EventTopic:this.selectedEventDetail["Event Topic"],EventType:this.selectedEventDetail.EventType,EventDate:this.selectedEventDetail.EventDate||" ",StartTime:this.selectedEventDetail.StartTime||" ",InitiatorName:this.selectedEventDetail.InitiatorName||t.unique_name,EndTime:this.selectedEventDetail.EndTime||" ",VenueName:this.selectedEventDetail.VenueName||" ",State:" ",City:" ",Attended:" ",InviteesParticipated:" ",ExpenseParticipated:this.eventTableDetails.length+""||" ",TotalExpense:`Total Panel Selection Final Amount: ${this.totalBudget} | Total Budget For The Event : ${this.totalBudget}`,Advance:`Advance Provided : ${this.totalBudget} | Advance Utilized For Event : ${this.actualBudget} | Pay Back Amount To Company  : ${this.payBackToCompany} | Additional Amount Needed To Pay For Initiator : ${this.amountToPayForInitiator}`,Brands:this.selectedEventDetail.Brands||" ",SlideKits:this.selectedEventDetail.SlideKits||" ",Panalists:this.selectedEventDetail.Panelists||" ",InitiatorEmail:t.email||" ",RbMorBM:t.RBM_BM||" ",SalesHead:t.SalesHead||" ",MarkeringHead:t.MarketingHead||" ",Compliance:t.ComplianceHead||"sabri.s@vsaasglobal.com",FinanceAccounts:t.FinanceAccounts||" ",FinanceTreasury:t.FinanceTreasury||" ",MedicalAffairsHead:t.MedicalAffairsHead||"sabri.s@vsaasglobal.com",FinanceHead:t.FinanceAccounts||"sabri.s@vsaasglobal.com",EventOpen30Days:"No",EventLessThan5Days:"No",PostEventSubmitted:"Yes",IsAdvanceRequired:this.selectedEventDetail.IsAdvanceRequired||"No",TotalInvitees:"0",TotalAttendees:"0",TotalTravelAndAccomodationSpend:this.selectedEventDetail["Total Travel & Accomodation Spend"]+""||"0",TotalHonorariumSpend:"0",TotalSpend:this.selectedEventDetail["Total Spend"]+""||"0",TotalLocalConveyance:this.selectedEventDetail["Total Local Conveyance"]+""||"0",TotalTravelSpend:this.selectedEventDetail["Total Travel Spend"]+""||"0",TotalAccomodationSpend:this.selectedEventDetail["Total Accomodation Spend"]+""||"0",TotalExpenses:this.selectedEventDetail["Total Expense"]+""||"0",IsDeviationUpload:"No",DeviationFiles:[" "],Files:this.hcpAgreementFiles.concat(this.hcpAcknowledgementFiles),TotalActuals:this.totalBudget+"",AdvanceUtilizedForEvents:this.actualBudget+"",PayBackAmountToCompany:this.payBackToCompany+"",AdditionalAmountNeededToPayForInitiator:this.amountToPayForInitiator+"",ReportingManagerEmail:t.reportingmanager,FirstLevelEmail:t.firstLevelManager,FinanceTreasuryEmail:t.FinanceTreasury||" ",SalesCoordinatorEmail:t.SalesCoordinator,Role:t.role};this._utilityService.postEventSettlementDetails(n).pipe((0,_.R)(this._ngUnSubscribe.asObservable())).subscribe(i=>{"Data added successfully."==i.message&&(this.loadingIndicator=!1,this._snackBarService.showSnackBar(s.D.MESSAGE.SUCCESS.ADD_POST_SETTLEMENT,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.SUCCESS),this.showEventSettlementContent=!1)},i=>{this.loadingIndicator=!1,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.SERVER_ERR,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)})}}_filterBTEBTE(t){this.BTESummary=[],this.BTCSummary=[],this.BTESummaryTotal=0,this.BTCSummaryTotal=0,console.log(t),t.length>0&&(t.forEach(n=>{if("BTC"==n["BTC/BTE"].trim()){let i={expense:n.Expense,amount:n.Amount,invoiceFile:""};this.BTCSummary.push(i),this.BTCSummaryTotal+=+i.amount}if("BTE"==n["BTC/BTE"].trim()){let i={expense:n.Expense,amount:n.Amount};this.BTESummary.push(i),this.BTESummaryTotal+=+i.amount}}),console.log(this.BTCSummary),console.log(this.BTESummary),console.log(this.BTESummaryTotal),console.log(this.BTCSummaryTotal))}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(g.t),e.Y36(v.gz),e.Y36(S.c),e.Y36(C.e))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-medical-utility-post-event-settlement"]],decls:15,vars:3,consts:[[1,"main-content"],[1,"container-fluid"],[1,"row"],[1,"col-md-12"],[1,"card"],[1,"card-header","card-header-danger"],[1,"card-title"],[1,"card-body"],["class","card-body",4,"ngIf"],[3,"isLoading"],[1,"container","table-responsive"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"col-6"],["color","accent","appearance","outline"],[3,"ngModelOptions","ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"formGroup"],["class","row",4,"ngIf"],["scope","row"],[3,"value"],[1,"text-danger","text-secondary","m-2"],["class","container table-responsive",4,"ngIf"],[1,"container","d-flex","justify-content-center"],["type","button",1,"btn","btn-sm","btn-primary"],["type","submit",1,"btn","btn-sm","btn-warning",3,"click"],["type","number",3,"ngModelOptions","ngModel","ngModelChange"],["type","file",3,"accept","disabled","change"],[1,"text-danger"],[1,"col","d-flex","justify-content-center","text-danger"],[1,"table","text-center","table-bordered"],["colspan","2",1,"text-right"],["type","file",3,"accept","ngModelOptions","ngModel","change","ngModelChange"],[2,"color","red"],["type","file",3,"accept","change"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h4",6),e._uU(7,"Post Event Settlement request"),e.qZA()(),e.TgZ(8,"div",7)(9,"div",2)(10,"div",3)(11,"div",4),e.YNc(12,ct,35,7,"div",8),e.YNc(13,ut,3,0,"div",8),e.qZA()()()()()()()()(),e._UZ(14,"app-spinner-loader",9)),2&t&&(e.xp6(12),e.Q6J("ngIf",!n.showNoData),e.xp6(1),e.Q6J("ngIf",n.showNoData),e.xp6(1),e.Q6J("isLoading",n.loadingIndicator))},dependencies:[h.sg,h.O5,r._Y,r.Fj,r.wV,r.JJ,r.JL,r.On,r.sg,p.KE,p.hX,A.gD,E.ey,f.r],styles:["table.table-bordered[_ngcontent-%COMP%]    > thead[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%] {\r\n    border:1px solid black;\r\n  }\r\n  table.table-bordered[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\r\n    border:1px solid rgb(209, 162, 162);\r\n  }\r\n  table.table-striped[_ngcontent-%COMP%]    > thead[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%] {\r\n    border:1px solid black;\r\n  }\r\n  table.table-striped[_ngcontent-%COMP%]    > tbody[_ngcontent-%COMP%]    > tr[_ngcontent-%COMP%]    > th[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\r\n    border:1px solid rgb(209, 162, 162);\r\n  }"]}),a})();function ht(a,l){if(1&a&&(e.TgZ(0,"tbody")(1,"tr")(2,"th",17),e._uU(3),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.qZA(),e.TgZ(10,"td"),e._uU(11),e.qZA()()()),2&a){const t=l.$implicit,n=l.index;e.xp6(3),e.Oqu(n+1),e.xp6(2),e.Oqu(t["EventId/EventRequestId"]),e.xp6(2),e.Oqu(t["Event Topic"]),e.xp6(2),e.Oqu(t.EventType),e.xp6(2),e.Oqu(t.EventDate)}}function pt(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",18)(1,"form",19)(2,"mat-label")(3,"b"),e._uU(4,"Upload Deviation"),e.TgZ(5,"span",20),e._uU(6,"*"),e.qZA()()(),e._UZ(7,"br"),e.TgZ(8,"div",21)(9,"input",22),e.NdJ("change",function(i){e.CHM(t);const o=e.oxw(2);return e.KtG(o.onFileSelected(i,"deviation","thirtyDaysUpload"))}),e.qZA(),e._UZ(10,"br"),e.TgZ(11,"span",23)(12,"small"),e._uU(13,"Allowed File Types (.png, .jpg, .txt , .doc)"),e.qZA()(),e._UZ(14,"br"),e.TgZ(15,"span",23)(16,"small"),e._uU(17,"Size Should be greater than 0 KB and less than 30MB"),e.qZA()()()()()}if(2&a){const t=e.oxw(2);e.xp6(1),e.Q6J("formGroup",t.deviationForm),e.xp6(8),e.Q6J("accept",t.allowedTypesForHTML)}}function _t(a,l){if(1&a&&(e.TgZ(0,"mat-option",27),e._uU(1),e.qZA()),2&a){const t=l.$implicit;e.s9C("value",t["EventId/EventRequestId"]),e.xp6(1),e.Oqu(t["EventId/EventRequestId"])}}const vt=function(){return{standalone:!0}};function gt(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"mat-form-field",24)(1,"mat-label"),e._uU(2,"Select Event ID"),e.qZA(),e.TgZ(3,"mat-select",25),e.NdJ("ngModelChange",function(i){e.CHM(t);const o=e.oxw(2);return e.KtG(o.onEventSelect(i))})("ngModelChange",function(i){e.CHM(t);const o=e.oxw(2);return e.KtG(o.selectedEvent=i)}),e.YNc(4,_t,2,2,"mat-option",26),e.qZA()()}if(2&a){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModelOptions",e.DdM(3,vt))("ngModel",t.selectedEvent),e.xp6(1),e.Q6J("ngForOf",t.after30DaysList)}}function Tt(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",28)(1,"div",29)(2,"h4")(3,"b"),e._uU(4,"Invitees Participation"),e.qZA(),e._uU(5," ("),e.TgZ(6,"button",30),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.openAddInviteeModal())}),e._uU(7,"Add Invitee"),e.qZA(),e._uU(8,")"),e.qZA()(),e._UZ(9,"app-post-event-settlement-invitees-summary"),e.TgZ(10,"div",29)(11,"h4")(12,"b"),e._uU(13,"Expense Details"),e.qZA()()(),e._UZ(14,"app-post-event-settlement-expense-summary"),e.TgZ(15,"div",31)(16,"button",32),e._uU(17,"Reset"),e.qZA(),e.TgZ(18,"button",33),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.postEventSubmit())}),e._uU(19,"Submit"),e.qZA()()()}}function At(a,l){if(1&a&&(e.TgZ(0,"div",7)(1,"div",2)(2,"div",10)(3,"table",11)(4,"thead")(5,"tr")(6,"th")(7,"small"),e._uU(8,"S.no"),e.qZA()(),e.TgZ(9,"th")(10,"small"),e._uU(11,"Event ID"),e.qZA()(),e.TgZ(12,"th")(13,"small"),e._uU(14,"Event Name"),e.qZA()(),e.TgZ(15,"th")(16,"small"),e._uU(17,"Event Type"),e.qZA()(),e.TgZ(18,"th")(19,"small"),e._uU(20,"Event Date"),e.qZA()()()(),e.YNc(21,ht,12,5,"tbody",12),e.qZA()(),e.YNc(22,pt,18,2,"div",13),e.TgZ(23,"div",14),e.YNc(24,gt,5,4,"mat-form-field",15),e.qZA(),e.YNc(25,Tt,20,0,"div",16),e.qZA()()),2&a){const t=e.oxw();e.xp6(21),e.Q6J("ngForOf",t.after30DaysList),e.xp6(1),e.Q6J("ngIf",t.show30DaysUpload),e.xp6(2),e.Q6J("ngIf",t.showEventSelect),e.xp6(1),e.Q6J("ngIf",t.showPostEventContent)}}function Et(a,l){1&a&&(e.TgZ(0,"div",7)(1,"span",23),e._uU(2,"Sorry, this event type has no events for Event Settlement submission"),e.qZA()())}const St=[{path:"",pathMatch:"full",component:ne},{path:"event-settlement",component:Ne},{path:"event-settlement-webinar",component:(()=>{class a{constructor(t,n,i,o,d,c){this.utilityService=t,this._snackBarService=n,this._router=i,this._authService=o,this._dialog=d,this.activatedRoute=c,this.loadingIndicator=!1,this.isUploadShows=!1,this.isUploadGST=!1,this.show30DaysUpload=!1,this.inviteeTableIsPresentCheckBox=[],this.totalAttendance=0,this.showInviteeDeviation=!1,this.showEventSelect=!1,this.showPostEventContent=!1,this.inviteeTableDetails=[],this.expenseTabelDetails=[],this.expenseTableDetailCopy=[],this.inviteeTableDetailsCopy=[],this.panelSelectionFinalAmount=0,this.inviteesFinalAmount=0,this.expenseFinalAmount=0,this.amountTableFinalAmount=0,this.advancedUtilized=0,this.amountToPayForInitiator=0,this.amountToPayForCompany=0,this.showGstTextBox=!1,this.showNoData=!1,this.expenseTableActualAmountInput=[],this.changedExpenseActualAmount=0,this.changesExpenseTableExpenses=[],this.changedInviteeLC=0,this.changedInviteeExpenses=[],this.showAddExpense=!1,this.expenseTabelDetails2=[],this.after30DaysList=[],this.deviationFiles=[],this._otherFiles=[],this.totalExpenseCount=0,this._btcSummaryCount=0,this._bteSummaryCount=0,this._btcInvoiceFiles=[]}ngOnInit(){this._authService.getUserDetails$.subscribe(t=>this._userDetails=t),this._getPayloadData(),this.utilityService.getInviteesFast().subscribe(t=>{this.invitees=t}),this.utilityService.getExpenseType().subscribe(t=>this.expenseType=t),this.utilityService.getPostEventExpense().subscribe(t=>{this.expense=t}),this.activatedRoute.queryParams.subscribe(t=>{t.eventId&&t.eventType?(this.loadingIndicator=!0,this.utilityService.getInviteesFast().subscribe(n=>{this.invitees=n,this.utilityService.getPostEventExpense().subscribe(i=>{this.expense=i,this.utilityService.getEventListFromProcess().subscribe(o=>{this.allEventList=o,this.after30DaysList.push(o.find(d=>d["EventId/EventRequestId"]==t.eventId)),this.show30DaysUpload=this.isAfter30Days(this.after30DaysList[0].EventDate),this.loadingIndicator=!1,this.onEventSelect(t.eventId)})})})):(this.showEventSelect=!0,this.loadingIndicator=!0,this.utilityService.getEventListFromProcess().subscribe(n=>{this.loadingIndicator=!1,this.allEventList=n,this.after30Days(this.allEventList)}))}),this.uploadForm=new r.cw({attendanceUpload:new r.NI(""),inviteeDeviation:new r.NI("")}),this.deviationForm=new r.cw({thirtyDaysUpload:new r.NI("")}),this.addExpenseForm=new r.cw({expenseType:new r.NI("",r.kI.required),expenseAmountWithoutGST:new r.NI(0),gstAmount:new r.NI(0),expenseBTC:new r.NI("",r.kI.required)}),this.addExpenseFormPrePopulate(),this._allowedTypes=s.D.FILE.ALLOWED,this._allowedTypes.forEach(t=>{this.allowedTypesForHTML+="."+t+", "})}inviteePresent(t){t?this.totalAttendance++:this.totalAttendance--,this.showInviteeDeviation=this.totalAttendance<5}onExpenseActualAmountChanges(t,n){this.advancedUtilized=0!==this.changedInviteeLC?this.changedInviteeLC:this.amountTableFinalAmount,console.log("before",this.advancedUtilized);let i=this.changesExpenseTableExpenses.find(o=>o.index==n);i?i.amount=t:this.changesExpenseTableExpenses.push({index:n,amount:t});for(let o=0;o<this.changesExpenseTableExpenses.length;o++)this.advancedUtilized-=this.expenseTabelDetails[o].Amount,this.advancedUtilized+=this.changesExpenseTableExpenses[o].amount;console.log("after",this.advancedUtilized),this.changedExpenseActualAmount=this.advancedUtilized,this.calculateAdvanceTableDetails()}onInviteeLcAmountChanges(t,n){this.advancedUtilized=0!==this.changedExpenseActualAmount?this.changedExpenseActualAmount:this.amountTableFinalAmount;let i=this.changedInviteeExpenses.find(o=>o.index==n);i?i.amount=t:this.changedInviteeExpenses.push({index:n,amount:t});for(let o=0;o<this.changedInviteeExpenses.length;o++)this.advancedUtilized-=this.inviteeTableDetails[o].LcAmount,this.advancedUtilized+=this.changedInviteeExpenses[o].amount;this.changedInviteeLC=this.advancedUtilized,this.calculateAdvanceTableDetails()}onEventSelect(t){this.selectedEventId=t,this.inviteeTableDetails=[],this.expenseTabelDetails=[],this.inviteeTableDetailsCopy=[],this.expenseTableDetailCopy=[],this.amountTableFinalAmount=0,this.advancedUtilized=0,this.amountToPayForCompany=0,this.amountToPayForInitiator=0,this.panelSelectionFinalAmount=0,this.expenseFinalAmount=0,this.inviteesFinalAmount=0,this.selectedEventDetails=this.allEventList.find(n=>n["EventId/EventRequestId"]==t),Boolean(this.invitees)&&this.invitees.forEach(n=>{n["EventId/EventRequestId"]==t&&this.inviteeTableDetails.push({EventIdOrEventRequestId:n["EventId/EventRequestId"],INV:n.INV||" ",InviteeName:n.HCPName||" ",MisCode:n.MISCode+" ",LocalConveyance:n.LocalConveyance||"0",BtcorBte:n["BTC/BTE"]+" "||0,LcAmount:n.LcAmount+" "||0,actualExpense:n.LcAmount,inviteeSource:n["Invitee Source"],isPresent:!1,speciality:n.Speciality||" ",hcpType:n["HCP Type"]||" "})}),Boolean(this.expense)&&this.expense.forEach(n=>{n["EventId/EventRequestID"]==t&&this.expenseTabelDetails.push({Amount:n.Amount+"",Expense:n.Expense+"",AmountExcludingTax:n["AmountExcludingTax?"],BtcorBte:n["BTC/BTE"],actualExpense:n.Amount,EventId:" ",BtcAmount:" ",BteAmount:" ",BudgetAmount:" "})}),this.inviteeTableDetails.length>0||this.expenseTabelDetails.length>0?(this.showPostEventContent=!0,this._sendExpense(this.expenseTabelDetails),this._sendInvitees(this.inviteeTableDetails)):(this.showPostEventContent=!1,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.NO_DATA,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR))}onAddExpenseRadioChange(t){console.log(t),this.showAddExpense="Yes"==t}addExpenseFormPrePopulate(){this.addExpenseForm.valueChanges.subscribe(t=>{Boolean(t.expenseType)&&(this.showGstTextBox=t.expenseType.indexOf("Food & Beverages")>-1||"Honorarium"==t.expenseType)})}addToExpenseTable(){if(this.addExpenseForm.valid&&this.addExpenseForm.value.expenseAmountWithoutGST>0){const t={Amount:this.addExpenseForm.value.expenseAmountWithoutGST+this.addExpenseForm.value.gstAmount+"0",Expense:this.addExpenseForm.value.expenseType+" ",AmountExcludingTax:this.addExpenseForm.value.gstAmount>0?"No":"Yes",BtcorBte:this.addExpenseForm.value.expenseBTC||" ",actualExpense:this.addExpenseForm.value.expenseAmountWithoutGST+this.addExpenseForm.value.gstAmount+""||"0",EventId:" ",BtcAmount:" ",BteAmount:" ",BudgetAmount:" "};this.amountTableFinalAmount+=+t.Amount,this.advancedUtilized+=t.actualExpense,this.expenseTabelDetails2.push(t),this.calculateAdvanceTableDetails(),this.addExpenseForm.reset(),this.addExpenseForm.controls.expenseAmountWithoutGST.setValue(0),this.addExpenseForm.controls.gstAmount.setValue(0)}else this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILL_ALL,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)}after30Days(t){console.log("Event List",t),Boolean(t)&&t.forEach(n=>{"Webinar"==n.EventType&&n["Initiator Email"]==this._userDetails.email&&"Honorarium approved"==n["Honorarium Request Status"]&&Boolean(n.EventDate)&&(this.after30DaysList.push(n),this.show30DaysUpload=this.isAfter30Days(n.EventDate))}),this.after30DaysList.length>0||(this.show30DaysUpload=!1,this.showNoData=!0,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.NO_DATA,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR))}isAfter30Days(t){let n=new Date,o=new Date(t).getTime()-n.getTime();return Math.round(o/864e5)<-30}calculateAdvanceIfNoChange(){this.advancedUtilized=this.amountTableFinalAmount,this.amountToPayForCompany=0,this.amountToPayForInitiator=0}calculateAdvanceTableDetails(){this.amountTableFinalAmount<this.advancedUtilized&&(this.amountToPayForCompany=0,this.amountToPayForInitiator=this.advancedUtilized-this.amountTableFinalAmount),this.amountTableFinalAmount>this.advancedUtilized&&(this.amountToPayForInitiator=0,this.amountToPayForCompany=this.amountTableFinalAmount-this.advancedUtilized),this.amountTableFinalAmount==this.advancedUtilized&&(this.amountToPayForCompany=0,this.amountToPayForInitiator=0,console.log(this.amountToPayForInitiator))}onFileSelected(t,n,i){const o=t.target.files[0];if(t.target.files.length>0)if(o.size>=s.D.FILE.MIN_SIZE&&o.size<s.D.FILE.MAX_SIZE){const d=o.name.split(".")[1],c=new FileReader;this._allowedTypes.indexOf(d)>-1?(c.readAsDataURL(o),c.onloadend=()=>{const u=c.result;"deviation"==n&&("thirtyDaysUpload"==i&&(this.thirtyDaysUploadFile="30DaysDeviationFile"+d+":"+u.split(",")[1]),"inviteeDeviation"==i&&(this.inviteeDeviationFile=u.split(",")[1])),"other"==n&&"attendanceUpload"==i&&(this.attendanceUploadFile=u.split(",")[1])}):(this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_TYPE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),this._resetControl(i))}else this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_SIZE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR),this._resetControl(i)}_resetControl(t){switch(t){case"thirtyDaysUpload":this.deviationForm.controls.thirtyDaysUpload.reset();break;case"attendanceUpload":this.uploadForm.controls.attendanceUpload.reset();break;case"inviteeDeviation":this.uploadForm.controls.inviteeDeviation.reset()}}postEventSubmit(){let t=0;if(this.show30DaysUpload&&!Boolean(this.deviationForm.value.thirtyDaysUpload)&&(t++,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_UPLOAD,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)),this.totalAttendance>0&&this.totalAttendance<5&&!Boolean(this.inviteeDeviationFile)&&(t++,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_UPLOAD,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)),this._btcInvoiceFiles.length<this._btcSummaryCount&&(t++,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_UPLOAD,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)),this._bteSummaryCount>0&&!Boolean(this._bteInvoiceFile)&&(t++,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.FILE_UPLOAD,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)),0==t){this.loadingIndicator=!0,Boolean(this.thirtyDaysUploadFile)&&this.deviationFiles.push(this.thirtyDaysUploadFile),Boolean(this.inviteeDeviationFile)&&this.deviationFiles.push(this.inviteeDeviationFile),this._btcInvoiceFiles.length>0&&this._btcInvoiceFiles.forEach(o=>this._otherFiles.push(o)),Boolean(this._bteInvoiceFile)&&this._otherFiles.push(this._bteInvoiceFile);let n=this._authService.decodeToken();const i={Invitee:this.inviteeTableDetails,ExpenseSheets:this.expenseTabelDetails,EventId:this.selectedEventDetails["EventId/EventRequestId"],EventTopic:this.selectedEventDetails["Event Topic"],EventType:this.selectedEventDetails.EventType,EventDate:this.selectedEventDetails.EventDate,StartTime:this.selectedEventDetails.StartTime,InitiatorName:this.selectedEventDetails.InitiatorName||n.unique_name,EndTime:this.selectedEventDetails.EndTime,VenueName:this.selectedEventDetails.VenueName||" ",State:this.selectedEventDetails.State||" ",City:this.selectedEventDetails.City||" ",Attended:this.totalAttendance+"",InviteesParticipated:this.inviteeTableDetails.length+"",ExpenseParticipated:this.expenseTabelDetails.length+"",TotalExpense:`Total Panel Selection Final Amount: ${this.panelSelectionFinalAmount} | Total Invitees Final Amount : ${this.inviteesFinalAmount} | Total Expense :${this.expenseFinalAmount} | Total Budget For The Event : ${this.amountTableFinalAmount}`,Advance:`Advance Provided : ${this.amountTableFinalAmount} | Advance Utilized For Event : ${this.advancedUtilized} | Pay Back Amount To Company  : ${this.amountToPayForCompany} | Additional Amount Needed To Pay For Initiator : ${this.amountToPayForInitiator}`,Brands:this.selectedEventDetails.Brands,SlideKits:this.selectedEventDetails.SlideKits,Panalists:this.selectedEventDetails.Panelists,InitiatorEmail:n.email||" ",RbMorBM:n.RBM_BM||" ",SalesHead:n.SalesHead||" ",MarkeringHead:n.MarketingHead||" ",Compliance:n.ComplianceHead||"sabri.s@vsaasglobal.com",FinanceAccounts:n.FinanceAccounts||" ",FinanceTreasury:n.FinanceTreasury||" ",MedicalAffairsHead:n.MedicalAffairsHead||"sabri.s@vsaasglobal.com",FinanceHead:n.FinanceAccounts||"sabri.s@vsaasglobal.com",EventOpen30Days:this.show30DaysUpload?"Yes":"No",EventLessThan5Days:this.showInviteeDeviation?"Yes":"No",PostEventSubmitted:"Yes",IsAdvanceRequired:this.selectedEventDetails.IsAdvanceRequired||"No",TotalInvitees:this.inviteeTableDetails.length+""||"0",TotalAttendees:this.totalAttendance+""||"0",TotalTravelAndAccomodationSpend:this.selectedEventDetails["Total Travel & Accommodation Amount"]+""||"0",TotalHonorariumSpend:this.selectedEventDetails["Total Honorarium Amount"]+""||"0",TotalSpend:this.selectedEventDetails["Total Budget"]+""||"0",TotalLocalConveyance:this.selectedEventDetails["Total Local Conveyance"]+""||"0",TotalTravelSpend:this.selectedEventDetails["Total Travel Amount"]+""||"0",TotalAccomodationSpend:this.selectedEventDetails["Total Accomodation Amount"]+""||"0",TotalExpenses:this.selectedEventDetails["Total Expense"]+""||"0",TotalActuals:this.advancedUtilized+"",AdvanceUtilizedForEvents:this.advancedUtilized+"",PayBackAmountToCompany:this.amountToPayForCompany+"",AdditionalAmountNeededToPayForInitiator:this.amountToPayForInitiator+"",IsDeviationUpload:Boolean(this.inviteeDeviationFile)?"Yes":"No",DeviationFiles:this.deviationFiles,Files:this._otherFiles,MedicalAffairsEmail:n.MedicalAffairsHead,ReportingManagerEmail:n.reportingmanager,FirstLevelEmail:n.firstLevelManager,ComplianceEmail:n.ComplianceHead,FinanceAccountsEmail:n.FinanceAccounts,SalesCoordinatorEmail:n.SalesCoordinator,Role:n.role};this.utilityService.postEventSettlementDetails(i).subscribe(o=>{"Data added successfully."==o.message&&(this.loadingIndicator=!1,this._snackBarService.showSnackBar(s.D.MESSAGE.SUCCESS.ADD_POST_SETTLEMENT,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.SUCCESS),this.showPostEventContent=!1,this._router.navigate(["view-event-list"]))},o=>{this.loadingIndicator=!1,this._snackBarService.showSnackBar(s.D.MESSAGE.ERROR.SERVER_ERR,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.ERROR)}),console.log(i)}}openAddInviteeModal(){this._dialog.open(R,{width:"80%",data:{eventId:this.selectedEventDetails["EventId/EventRequestId"]}}).afterClosed().subscribe(n=>{this.reloadInvitees()})}openDeleteInviteeConfirmationModal(t){this._dialog.open(M,{width:"300px"}).afterClosed().subscribe(i=>{i&&this.deleteInvitee(t)})}deleteInvitee(t){this.loadingIndicator=!0,this.utilityService.deleteInvitees(t.INV).subscribe(n=>{this.loadingIndicator=!1,this._snackBarService.showSnackBar(s.D.MESSAGE.SUCCESS.DELETE_INVITEE,s.D.SNACK_BAR.DELAY,s.D.SNACK_BAR.SUCCESS),this.reloadInvitees()})}reloadInvitees(){this.loadingIndicator=!0,this.utilityService.getInviteesFast().subscribe(t=>{this.invitees=t,this.onEventSelect(this.selectedEventDetails["EventId/EventRequestId"]),this.loadingIndicator=!1})}_sendInvitees(t){this.utilityService.sendData({from:"eventSettlementInvitees",data:t,eventId:this.selectedEventId})}_sendExpense(t){this.utilityService.sendExpenseData({from:"eventSettlementExpense",data:t,invitees:this.inviteeTableDetails,eventId:this.selectedEventId,eventType:this.selectedEventDetails.EventType,totalInviteesCount:this.inviteeTableDetails.length})}_getPayloadData(){this.utilityService.data.subscribe(t=>{"inviteeSummary"==t.from&&"apiPayload"==t.for&&(this.totalAttendance=t.attendedInviteesCount,Boolean(t.attendanceDeviation)&&(this.inviteeDeviationFile=t.attendanceDeviation)),"expenseSummary"==t.from&&"apiPayload"==t.for&&(this.expenseTabelDetails=t.expenseDetails,this.panelSelectionFinalAmount=t.panelTotalAmount,this.inviteesFinalAmount=t.inviteeTotalAmount,this.expenseFinalAmount=t.expenseTotalAmount,this.amountTableFinalAmount=t.advanceProvided,this.advancedUtilized=t.advanceUtilized,this.amountToPayForInitiator=t.paybackToInitiator,this.amountToPayForCompany=t.paybackToCompany,this._btcSummaryCount=t.btcSummaryCount,this._btcInvoiceFiles=t.btcInvoiceFiles,this._bteInvoiceFile=t.bteInvoiceFile,this._bteSummaryCount=t.bteSummaryCount)})}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(g.t),e.Y36(S.c),e.Y36(v.F0),e.Y36(C.e),e.Y36(T.uw),e.Y36(v.gz))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-webinar-post-event-settlement"]],decls:15,vars:3,consts:[[1,"main-content"],[1,"container-fluid"],[1,"row"],[1,"col-md-12"],[1,"card"],[1,"card-header","card-header-danger"],[1,"card-title"],[1,"card-body"],["class","card-body",4,"ngIf"],[3,"isLoading"],[1,"container","table-responsive"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],["class","col mt-2",4,"ngIf"],[1,"col-6"],["color","accent","appearance","outline",4,"ngIf"],["class","container",4,"ngIf"],["scope","row"],[1,"col","mt-2"],[3,"formGroup"],[2,"color","red"],[1,"m-2"],["type","file","id","thirtyDaysUpload","formControlName","thirtyDaysUpload",3,"accept","change"],[1,"text-danger"],["color","accent","appearance","outline"],[3,"ngModelOptions","ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"container"],[1,"col","text-danger"],["mat-button","",3,"click"],[1,"col-12","d-flex","justify-content-center"],[1,"btn","btn-primary","btn-sm"],[1,"btn","btn-success","btn-sm",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h4",6),e._uU(7,"Post Event Settlement request"),e.qZA()(),e.TgZ(8,"div",7)(9,"div",2)(10,"div",3)(11,"div",4),e.YNc(12,At,26,4,"div",8),e.YNc(13,Et,3,0,"div",8),e.qZA()()()()()()()()(),e._UZ(14,"app-spinner-loader",9)),2&t&&(e.xp6(12),e.Q6J("ngIf",!n.showNoData),e.xp6(1),e.Q6J("ngIf",n.showNoData),e.xp6(1),e.Q6J("isLoading",n.loadingIndicator))},dependencies:[h.sg,h.O5,r._Y,r.Fj,r.JJ,r.JL,r.On,r.sg,r.u,y.lW,p.KE,p.hX,A.gD,E.ey,f.r,O,w]}),a})()},{path:"event-settlement-hcp-consultants",component:Xe},{path:"event-settlement-medical-utility",component:mt}];let ft=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[v.Bz.forChild(St),v.Bz]}),a})(),Ct=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[h.ez,ft]}),a})()}}]);